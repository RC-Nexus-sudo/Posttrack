((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)})(this,function(yd,vd){try{!function(){function n(r){var n=[];let i=0;for(let t=0;t<r.length;t++){let e=r.charCodeAt(t);e<128?n[i++]=e:(e<2048?n[i++]=e>>6|192:(55296==(64512&e)&&t+1<r.length&&56320==(64512&r.charCodeAt(t+1))?(e=65536+((1023&e)<<10)+(1023&r.charCodeAt(++t)),n[i++]=e>>18|240,n[i++]=e>>12&63|128):n[i++]=e>>12|224,n[i++]=e>>6&63|128),n[i++]=63&e|128)}return n}let i=(t=yd)&&"object"==typeof t&&"default"in t?t:{default:t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){var a=n[r],o=r+1<n.length,u=o?n[r+1]:0,h=r+2<n.length,l=h?n[r+2]:0;let e=(15&u)<<2|l>>6,t=63&l;h||(t=64,o)||(e=64),s.push(i[a>>2],i[(3&a)<<4|u>>4],i[e],i[t])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(r,n){if(this.HAS_NATIVE_SUPPORT&&!n)return atob(r);{var i=this.decodeStringToByteArray(r,n),s=[];let e=0,t=0;for(;e<i.length;){var a,o,u,h=i[e++];h<128?s[t++]=String.fromCharCode(h):191<h&&h<224?(a=i[e++],s[t++]=String.fromCharCode((31&h)<<6|63&a)):239<h&&h<365?(a=((7&h)<<18|(63&i[e++])<<12|(63&i[e++])<<6|63&i[e++])-65536,s[t++]=String.fromCharCode(55296+(a>>10)),s[t++]=String.fromCharCode(56320+(1023&a))):(o=i[e++],u=i[e++],s[t++]=String.fromCharCode((15&h)<<12|(63&o)<<6|63&u))}return s.join("")}},decodeStringToByteArray(t,e){this.init_();var r=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let e=0;e<t.length;){var i=r[t.charAt(e++)],s=e<t.length?r[t.charAt(e)]:0,a=++e<t.length?r[t.charAt(e)]:64,o=++e<t.length?r[t.charAt(e)]:64;if(++e,null==i||null==s||null==a||null==o)throw new h;n.push(i<<2|s>>4),64!==a&&(n.push(s<<4&240|a>>2),64!==o)&&n.push(a<<6&192|o)}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};var c;class h extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}function B(e){return q(e).replace(/\./g,"")}let q=function(e){e=n(e);return s.encodeByteArray(e,!0)};function j(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}let z=()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(e[1]);return t&&JSON.parse(t)}},G=()=>{try{return j().__FIREBASE_DEFAULTS__||("undefined"!=typeof process&&void 0!==process.env&&(e=process.env.__FIREBASE_DEFAULTS__)?JSON.parse(e):void 0)||z()}catch(e){console.info("Unable to get __FIREBASE_DEFAULTS__ due to: "+e)}var e};function K(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}let Q={},$=!1;function H(e,t){if("undefined"!=typeof window&&"undefined"!=typeof document&&K(window.location.host)&&Q[e]!==t&&!Q[e]&&!$){Q[e]=t;let h="__firebase__banner",l=0<(()=>{var e,t={prod:[],emulator:[]};for(e of Object.keys(Q))(Q[e]?t.emulator:t.prod).push(e);return t})().prod.length;function c(e){return"__firebase__banner__"+e}function r(){var e,t,r=(e=>{let t=document.getElementById(e),r=!1;return t||((t=document.createElement("div")).setAttribute("id",e),r=!0),{created:r,element:t}})(h),n=c("text"),i=document.getElementById(n)||document.createElement("span"),s=c("learnmore"),a=document.getElementById(s)||document.createElement("a"),o=c("preprendIcon"),u=document.getElementById(o)||document.createElementNS("http://www.w3.org/2000/svg","svg");r.created&&((e=r=r.element).style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center",(e=a).setAttribute("id",s),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline",(t=document.createElement("span")).style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{var e;$=!0,(e=document.getElementById(h))&&e.remove()},s=t,e=o,(t=u).setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px",r.append(u,i,a,s),document.body.appendChild(r)),l?(i.innerText="Preview backend disconnected.",u.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(u.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,i.innerText="Preview backend running in this workspace."),i.setAttribute("id",n)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",r):r()}}function W(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Y(){var e=G()?.forceEnvironment;if("node"===e)return 1;if("browser"!==e)try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){}}function J(){return!Y()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function X(){return!Y()&&navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}class Z extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,Z.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ee.prototype.create)}}class ee{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var n,t=t[0]||{},r=this.service+"/"+e,e=(e=this.errors[e])?(n=t,e.replace(te,(e,t)=>{var r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",e=this.serviceName+`: ${e} (${r}).`;return new Z(r,e,t)}}let te=/\{\$([^}]+)}/g;function re(e,t){if(e!==t){var r,n,i=Object.keys(e),s=Object.keys(t);for(r of i){if(!s.includes(r))return!1;var a=e[r],o=t[r];if(ne(a)&&ne(o)){if(!re(a,o))return!1}else if(a!==o)return!1}for(n of s)if(!i.includes(n))return!1}return!0}function ne(e){return null!==e&&"object"==typeof e}function I(e){return e&&e._delegate?e._delegate:e}class ie{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}(t=c=c||{})[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT";let se={debug:c.DEBUG,verbose:c.VERBOSE,info:c.INFO,warn:c.WARN,error:c.ERROR,silent:c.SILENT},ae=c.INFO,oe={[c.DEBUG]:"log",[c.VERBOSE]:"log",[c.INFO]:"info",[c.WARN]:"warn",[c.ERROR]:"error"},ue=(e,t,...r)=>{if(!(t<e.logLevel)){var n=(new Date).toISOString(),i=oe[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${n}]  ${e.name}:`,...r)}};var he,le,ir,sr,ar,or,ur,hr,lr,cr,g,ce,de="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},dr=(function(){var e,s;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function r(){}function a(e,t,r){r=r||0;var n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1];var i=e.g[2],s=e.g[3],a=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=(r=(i=(s=(t=r+((a=t+(s^r&(i^s))+n[0]+3614090360&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(r^i))+n[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(r^s&(t^r))+n[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=r+(t^i&(s^t))+n[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^r&(i^s))+n[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(r^i))+n[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(r^s&(t^r))+n[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=r+(t^i&(s^t))+n[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^r&(i^s))+n[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(r^i))+n[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(r^s&(t^r))+n[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=r+(t^i&(s^t))+n[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^r&(i^s))+n[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(r^i))+n[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(r^s&(t^r))+n[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=r+(t^i&(s^t))+n[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(r^i))+n[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(r^i&(t^r))+n[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^r&(s^t))+n[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=r+(s^t&(i^s))+n[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(r^i))+n[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(r^i&(t^r))+n[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^r&(s^t))+n[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=r+(s^t&(i^s))+n[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(r^i))+n[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(r^i&(t^r))+n[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^r&(s^t))+n[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=r+(s^t&(i^s))+n[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(r^i))+n[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(r^i&(t^r))+n[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^r&(s^t))+n[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=r+(s^t&(i^s))+n[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(r^i^s)+n[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^r^i)+n[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^r)+n[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=r+(i^s^t)+n[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(r^i^s)+n[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^r^i)+n[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^r)+n[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=r+(i^s^t)+n[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(r^i^s)+n[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^r^i)+n[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^r)+n[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=r+(i^s^t)+n[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(r^i^s)+n[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^r^i)+n[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^r)+n[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=r+(i^s^t)+n[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(i^(r|~s))+n[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(r^(t|~i))+n[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~r))+n[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=r+(s^(i|~t))+n[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(r|~s))+n[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(r^(t|~i))+n[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~r))+n[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=r+(s^(i|~t))+n[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(r|~s))+n[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(r^(t|~i))+n[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~r))+n[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=r+(s^(i|~t))+n[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(t=r+((a=t+(i^(r|~s))+n[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(r^(t|~i))+n[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(t^(s|~r))+n[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+n[9]+3951481745&4294967295;e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function u(t,r){this.h=r;var n=[];let i=!0;for(let e=t.length-1;0<=e;e--){var s=0|t[e];i&&s==r||(n[e]=s,i=!1)}this.g=n}e=t,r.prototype=(s=function(){this.blockSize=-1}).prototype,e.F=s.prototype,e.prototype=new r,(e.prototype.constructor=e).D=function(e,t,r){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return s.prototype[t].apply(e,n)},t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){var r=(t=void 0===t?e.length:t)-this.blockSize,n=this.C;let i=this.h,s=0;for(;s<t;){if(0==i)for(;s<=r;)a(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(n[i++]=e.charCodeAt(s++),i==this.blockSize){a(this,n),i=0;break}}else for(;s<t;)if(n[i++]=e[s++],i==this.blockSize){a(this,n),i=0;break}}this.h=i,this.o+=t},t.prototype.A=function(){var t=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var r=1;r<t.length-8;++r)t[r]=0;for(var r=8*this.o,n=t.length-8;n<t.length;++n)t[n]=255&r,r/=256;for(this.v(t),t=Array(16),n=r=0;n<4;++n)for(let e=0;e<32;e+=8)t[r++]=this.g[n]>>>e&255;return t};var i={};function n(e){return-128<=e&&e<128?(t=e,r=function(e){return new u([0|e],e<0?-1:0)},n=i,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=r(t)):new u([0|e],e<0?-1:0);var t,r,n}function h(t){if(isNaN(t)||!isFinite(t))return l;if(t<0)return g(h(-t));var r=[];let n=1;for(let e=0;t>=n;e++)r[e]=t/n|0,n*=4294967296;return new u(r,0)}var l=n(0),o=n(1),c=n(16777216);function d(t){if(0==t.h){for(let e=0;e<t.g.length;e++)if(0!=t.g[e])return;return 1}}function f(e){return-1==e.h}function g(t){var r=t.g.length,n=[];for(let e=0;e<r;e++)n[e]=~t.g[e];return new u(n,~t.h).add(o)}function m(e,t){return e.add(g(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function v(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(l,l);if(f(e))return t=v(g(e),t),new y(g(t.g),g(t.h));if(f(t))return t=v(e,g(t)),new y(g(t.g),t.h);if(30<e.g.length){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var r=o,n=t;n.l(e)<=0;)r=w(r),n=w(n);for(var i=_(r,1),s=_(n,1),n=_(n,2),r=_(r,2);!d(n);){var a=s.add(n);a.l(e)<=0&&(i=i.add(r),s=a),n=_(n,1),r=_(r,1)}return t=m(e,i.j(t)),new y(i,t)}for(i=l;0<=e.l(t);){for(r=Math.max(1,Math.floor(e.m()/t.m())),n=(n=Math.ceil(Math.log(r)/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=h(r)).j(t);f(a)||0<a.l(e);)a=(s=h(r-=n)).j(t);d(s)&&(s=o),i=i.add(s),e=m(e,a)}return new y(i,e)}function w(t){var r=t.g.length+1,n=[];for(let e=0;e<r;e++)n[e]=t.i(e)<<1|t.i(e-1)>>>31;return new u(n,t.h)}function _(t,r){var n=r>>5,i=(r%=32,t.g.length-n),s=[];for(let e=0;e<i;e++)s[e]=0<r?t.i(e+n)>>>r|t.i(e+n+1)<<32-r:t.i(e+n);return new u(s,t.h)}(e=u.prototype).m=function(){if(f(this))return-g(this).m();let t=0,r=1;for(let e=0;e<this.g.length;e++){var n=this.i(e);t+=(0<=n?n:4294967296+n)*r,r*=4294967296}return t},e.toString=function(t){if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if(d(this))return"0";if(f(this))return"-"+g(this).toString(t);var r=h(Math.pow(t,6)),n=this;let i="";for(;;){var s=v(n,r).g;let e=((0<(n=m(n,s.j(r))).g.length?n.g[0]:n.h)>>>0).toString(t);if(d(n=s))return e+i;for(;e.length<6;)e="0"+e;i=e+i}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return f(e=m(this,e))?-1:d(e)?0:1},e.abs=function(){return f(this)?g(this):this},e.add=function(t){var r=Math.max(this.g.length,t.g.length),n=[];let i=0;for(let e=0;e<=r;e++){var s=i+(65535&this.i(e))+(65535&t.i(e)),a=(s>>>16)+(this.i(e)>>>16)+(t.i(e)>>>16);i=a>>>16,s&=65535,a&=65535,n[e]=a<<16|s}return new u(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(t){if(d(this)||d(t))return l;if(f(this))return f(t)?g(this).j(g(t)):g(g(this).j(t));if(f(t))return g(this.j(g(t)));if(this.l(c)<0&&t.l(c)<0)return h(this.m()*t.m());for(var e=this.g.length+t.g.length,r=[],n=0;n<2*e;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let e=0;e<t.g.length;e++){var i=this.i(n)>>>16,s=65535&this.i(n),a=t.i(e)>>>16,o=65535&t.i(e);r[2*n+2*e]+=s*o,p(r,2*n+2*e),r[2*n+2*e+1]+=i*o,p(r,2*n+2*e+1),r[2*n+2*e+1]+=s*a,p(r,2*n+2*e+1),r[2*n+2*e+2]+=i*a,p(r,2*n+2*e+2)}for(t=0;t<e;t++)r[t]=r[2*t+1]<<16|r[2*t];for(t=e;t<2*e;t++)r[t]=0;return new u(r,0)},e.B=function(e){return v(this,e).h},e.and=function(t){var r=Math.max(this.g.length,t.g.length),n=[];for(let e=0;e<r;e++)n[e]=this.i(e)&t.i(e);return new u(n,this.h&t.h)},e.or=function(t){var r=Math.max(this.g.length,t.g.length),n=[];for(let e=0;e<r;e++)n[e]=this.i(e)|t.i(e);return new u(n,this.h|t.h)},e.xor=function(t){var r=Math.max(this.g.length,t.g.length),n=[];for(let e=0;e<r;e++)n[e]=this.i(e)^t.i(e);return new u(n,this.h^t.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,le=t,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.B,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.getBits=u.prototype.i,u.fromNumber=h,u.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return g(e(t.substring(1),r));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');var n=h(Math.pow(r,8));let i=l;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e),a=parseInt(t.substring(e,e+s),r);i=(s<8?(s=h(Math.pow(r,s)),i.j(s)):i=i.j(n)).add(h(a))}return i},he=u}.apply(void 0!==de?de:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{}),fe=(!function(){var e,P=Object.defineProperty,V=(e=>{e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof dr&&dr];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")})(this);function F(e,t){if(t)e:{var r=V;e=e.split(".");for(var n=0;n<e.length-1;n++){var i=e[n];if(!(i in r))break e;r=r[i]}(t=t(n=r[e=e[e.length-1]]))!=n&&null!=t&&P(r,e,{configurable:!0,writable:!0,value:t})}}F("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),F("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),F("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var U=U||{},A=this||self;function f(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function B(e,t,r){return e.call.apply(e.bind,arguments)}function y(e,t,r){return(y=B).apply(null,arguments)}function q(t){var r=Array.prototype.slice.call(arguments,1);return function(){var e=r.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function t(e,s){function t(){}t.prototype=s.prototype,e.Z=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Ob=function(e,t,r){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return s.prototype[t].apply(e,n)}}var j="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function z(t){var r=t.length;if(0<r){var n=Array(r);for(let e=0;e<r;e++)n[e]=t[e];return n}return[]}function G(t){for(let e=1;e<arguments.length;e++){var r=arguments[e];if("array"==(n="object"!=(n=typeof r)?n:r?Array.isArray(r)?"array":n:"null")||"object"==n&&"number"==typeof r.length){var n=t.length||0,i=r.length||0;t.length=n+i;for(let e=0;e<i;e++)t[n+e]=r[e]}else t.push(r)}}var K=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Q,e=>e.reset());class Q{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let r,n=!1,$=new class{constructor(){this.h=this.g=null}add(e,t){var r=K.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},H=()=>{let e=Promise.resolve(void 0);r=()=>{e.then(W)}};function W(){for(var e;e=(()=>{let e=$,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t})();){try{e.h.call(e.g)}catch(e){(e=>{A.setTimeout(()=>{throw e},0)})(e)}var t=K;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}n=!1}function i(){this.u=this.u,this.C=this.C}function o(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}i.prototype.u=!1,i.prototype.dispose=function(){this.u||(this.u=!0,this.N())},i.prototype[Symbol.dispose]=function(){this.dispose()},i.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},o.prototype.h=function(){this.defaultPrevented=!0};var Y=(()=>{if(!A.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{var r=()=>{};A.addEventListener("test",r,t),A.removeEventListener("test",r,t)}catch(e){}return e})();function D(e){return/^[\s\xa0]*$/.test(e)}function s(e,t){o.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}t(s,o),s.prototype.init=function(e,t){var r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,(this.i=e).defaultPrevented&&s.Z.h.call(this)},s.prototype.h=function(){s.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var d="closure_listenable_"+(1e6*Math.random()|0),J=0;function X(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++J,this.da=this.fa=!1}function Z(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function ee(e,t,r){for(var n in e)t.call(r,e[n],n,e)}function te(e){var t,r={};for(t in e)r[t]=e[t];return r}let re="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ne(t){let r,n;for(let e=1;e<arguments.length;e++){for(r in n=arguments[e])t[r]=n[r];for(let e=0;e<re.length;e++)r=re[e],Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}}function ie(e){this.src=e,this.g={},this.h=0}function se(e,t){var r,n,i,s=t.type;s in e.g&&(r=e.g[s],(i=0<=(n=Array.prototype.indexOf.call(r,t,void 0)))&&Array.prototype.splice.call(r,n,1),i)&&(Z(t),0==e.g[s].length)&&(delete e.g[s],e.h--)}function ae(t,r,n,i){for(let e=0;e<t.length;++e){var s=t[e];if(!s.da&&s.listener==r&&s.capture==!!n&&s.ha==i)return e}return-1}ie.prototype.add=function(e,t,r,n,i){var s=e.toString(),a=((e=this.g[s])||(e=this.g[s]=[],this.h++),ae(e,t,n,i));return-1<a?(t=e[a],r||(t.fa=!1)):((t=new X(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var oe="closure_lm_"+(1e6*Math.random()|0),ue={};function he(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");var a=f(i)?!!i.capture:!!i;let o=fe(e);if(o||(e[oe]=o=new ie(e)),!(r=o.add(t,r,n,a,s)).proxy)if(n=(()=>{let r=de;return function e(t){return r.call(e.src,e.listener,t)}})(),(r.proxy=n).src=e,n.listener=r,e.addEventListener)void 0===(i=Y?i:a)&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(ce(t.toString()),n);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(n)}return r}function le(e){var t,r,n;"number"!=typeof e&&e&&!e.da&&((t=e.src)&&t[d]?se(t.i,e):(r=e.type,n=e.proxy,t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(ce(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=fe(t))?(se(r,e),0==r.h&&(r.src=null,t[oe]=null)):Z(e)))}function ce(e){return e in ue?ue[e]:ue[e]="on"+e}function de(e,t){var r,n;return!!e.da||(t=new s(t,this),r=e.listener,n=e.ha||e.src,e.fa&&le(e),r.call(n,t))}function fe(e){return(e=e[oe])instanceof ie?e:null}var ge="__closure_events_fn_"+(1e9*Math.random()>>>0);function me(t){return"function"==typeof t?t:(t[ge]||(t[ge]=function(e){return t.handleEvent(e)}),t[ge])}function a(){i.call(this),this.i=new ie(this),(this.M=this).G=null}function u(e,t){var r,n,i=e.G;if(i)for(r=[];i;i=i.G)r.push(i);e=e.M,i=t.type||t,"string"==typeof t?t=new o(t,e):t instanceof o?t.target=t.target||e:(n=t,ne(t=new o(i,e),n)),n=!0;let s,a;if(r)for(a=r.length-1;0<=a;a--)n=pe(s=t.g=r[a],i,!0,t)&&n;if(n=pe(s=t.g=e,i,!0,t)&&n,n=pe(s,i,!1,t)&&n,r)for(a=0;a<r.length;a++)n=pe(s=t.g=r[a],i,!1,t)&&n}function pe(t,r,n,i){if(!(r=t.i.g[String(r)]))return!0;r=r.concat();let s=!0;for(let e=0;e<r.length;++e){var a,o,u=r[e];u&&!u.da&&u.capture==n&&(a=u.listener,o=u.ha||u.src,u.fa&&se(t.i,u),s=!1!==a.call(o,i)&&s)}return s&&!i.defaultPrevented}t(a,i),a.prototype[d]=!0,a.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else i=f(i)?!!i.capture:!!i,n=me(n),t&&t[d]?(t=t.i,(a=String(r).toString())in t.g&&-1<(n=ae(r=t.g[a],n,i,s))&&(Z(r[n]),Array.prototype.splice.call(r,n,1),0==r.length)&&(delete t.g[a],t.h--)):(t=t&&fe(t))&&(r=t.g[r.toString()],n=(t=-1)<(t=r?ae(r,n,i,s):t)?r[t]:null)&&le(n)}(this,e,t,r,n)},a.prototype.N=function(){if(a.Z.N.call(this),this.i){var e,t=this.i;for(e in t.g){var r=t.g[e];for(let e=0;e<r.length;e++)Z(r[e]);delete t.g[e],t.h--}}this.G=null},a.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},a.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ye extends i{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=((e,t)=>{if("function"!=typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=y(e.handleEvent,e)}return 2147483647<Number(t)?-1:A.setTimeout(e,t||0)})(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);var r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(A.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function h(e){i.call(this),this.h=e,this.g={}}t(h,i);var ve=[];function we(e){ee(e.g,function(e,t){this.g.hasOwnProperty(t)&&le(e)},e),e.g={}}h.prototype.N=function(){h.Z.N.call(this),we(this)},h.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var _e=A.JSON.stringify,be=A.JSON.parse,Ie=class{stringify(e){return A.JSON.stringify(e,void 0)}parse(e){return A.JSON.parse(e,void 0)}};function Te(){}function Ee(){}var Se={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function xe(){o.call(this,"d")}function Ce(){o.call(this,"c")}t(xe,o),t(Ce,o);var l={},Ae=null;function De(){return Ae=Ae||new a}function Ne(e){o.call(this,l.Ia,e)}function ke(){var e=De();u(e,new Ne(e))}function Re(e,t){o.call(this,l.STAT_EVENT,e),this.stat=t}function N(e){var t=De();u(t,new Re(t,e))}function Me(e,t){o.call(this,l.Ja,e),this.size=t}function v(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){e()},t)}function c(){this.g=!0}function k(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+((e,t)=>{if(!e.g)return t;if(!t)return null;try{var r=JSON.parse(t);if(r)for(e=0;e<r.length;e++)if(Array.isArray(r[e])){var n=r[e];if(!(n.length<2)){var i=n[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(let e=1;e<i.length;e++)i[e]=""}}}return _e(r)}catch(e){return t}})(e,r)+(n?" "+n:"")})}l.Ia="serverreachability",t(Ne,o),l.STAT_EVENT="statevent",t(Re,o),l.Ja="timingevent",t(Me,o),c.prototype.ua=function(){this.g=!1},c.prototype.info=function(){};var Oe={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Le={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Pe(){}function g(e){return encodeURIComponent(String(e))}function m(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new h(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ve}function Ve(){this.i=null,this.g="",this.h=!1}t(Pe,Te),Pe.prototype.g=function(){return new XMLHttpRequest};var Fe=new Pe,Ue={},Be={};function qe(e,t,r){e.M=1,e.A=st(w(t)),e.u=r,e.R=!0,je(e,null)}function je(e,t){e.F=Date.now(),Ge(e),e.B=w(e.A);var a,o,u,h,l,c,r=e.B,n=e.S,i=(Array.isArray(n)||(n=[String(n)]),vt(r.i,"t",n),e.C=0,r=e.j.L,e.h=new Ve,e.g=Zt(e.j,r?t:null,!e.u),0<e.P&&(e.O=new ye(y(e.Y,e,e.g),e.P)),t=e.V,r=e.g,n=e.ba,"readystatechange");Array.isArray(i)||(i&&(ve[0]=i.toString()),i=ve);for(let e=0;e<i.length;e++){var s=function t(r,n,i,s,a){if(s&&s.once)return function t(r,n,i,s,a){if(Array.isArray(n)){for(let e=0;e<n.length;e++)t(r,n[e],i,s,a);return null}return i=me(i),r&&r[d]?r.K(n,i,f(s)?!!s.capture:!!s,a):he(r,n,i,!0,s,a)}(r,n,i,s,a);if(Array.isArray(n)){for(let e=0;e<n.length;e++)t(r,n[e],i,s,a);return null}return i=me(i),r&&r[d]?r.J(n,i,f(s)?!!s.capture:!!s,a):he(r,n,i,!1,s,a)}(r,i[e],n||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}t=e.J?te(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ke(),a=e.i,o=e.v,u=e.B,h=e.l,l=e.S,c=e.u,a.info(function(){if(a.g)if(c){var t="",r=c.split("&");for(let e=0;e<r.length;e++){var n,i,s=r[e].split("=");1<s.length&&(n=s[0],s=s[1],t=2<=(i=n.split("_")).length&&"type"==i[1]?t+(n+"=")+s+"&":t+(n+"=redacted&"))}}else t=null;else t=c;return"XMLHTTP REQ ("+h+") [attempt "+l+"]: "+o+"\n"+u+"\n"+t})}function ze(e){return e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function Ge(e){e.T=Date.now()+e.H,Ke(e,e.H)}function Ke(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=v(y(e.aa,e),t)}function Qe(e){e.D&&(A.clearTimeout(e.D),e.D=null)}function R(e){0==e.j.I||e.K||Wt(e.j,e)}function M(e){Qe(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,we(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function $e(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||Xe(r.h,e)))if(!e.L&&Xe(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g){if(!(r.g.F+3e3<e.F))break e;Ht(r),Ft(r)}Kt(r),N(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=v(y(r.Va,r),6e3));Je(r.h)<=1&&r.ta&&(r.ta=void 0)}else x(r,11)}else if(!e.L&&r.g!=e||Ht(r),!D(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){var s,a,o,u,h,l,c,d,f,g,m=i[t],p=m[0];p<=r.K||(r.K=p,m=m[1],2==r.I?"c"==m[0]?(r.M=m[1],r.ba=m[2],null!=(s=m[3])&&(r.ka=s,r.j.info("VER="+r.ka)),null!=(a=m[4])&&(r.za=a,r.j.info("SVER="+r.za)),null!=(o=m[5])&&"number"==typeof o&&0<o&&(n=1.5*o,r.O=n,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r,(u=e.g)&&(!(h=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null)||(l=n.h).g||-1==h.indexOf("spdy")&&-1==h.indexOf("quic")&&-1==h.indexOf("h2")||(l.j=l.l,l.g=new Set,l.h&&(Ze(l,l.h),l.h=null)),n.G)&&(c=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.wa=c,b(n.J,n.G,c)),r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),d=e,(n=r).na=Xt(n,n.L?n.ba:null,n.W),d.L?(et(n.h,d),f=d,(g=n.O)&&(f.H=g),f.D&&(Qe(f),Ge(f)),n.g=d):Gt(n),0<r.i.length&&Bt(r)):"stop"!=m[0]&&"close"!=m[0]||x(r,7):3==r.I&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?x(r,7):Vt(r):"noop"!=m[0]&&r.l&&r.l.qa(m),r.A=0))}ke()}catch(e){}}m.prototype.ba=function(e){e=e.target;var t=this.O;t&&3==O(e)?t.j():this.Y(e)},m.prototype.Y=function(e){try{if(e==this.g)e:{var t=O(this.g),r=this.g.ya();if(this.g.ca(),!(t<3)&&(3!=t||this.g&&(this.h.h||this.g.la()||Ot(this.g)))){this.K||4!=t||7==r||ke(),Qe(this);var n,i,s=this.g.ca(),a=(this.X=s,(t=>{if(!ze(t))return t.g.la();var r=Ot(t.g);if(""===r)return"";let n="",i=r.length,s=4==O(t.g);if(!t.h.i){if("undefined"==typeof TextDecoder)return M(t),R(t),"";t.h.i=new A.TextDecoder}for(let e=0;e<i;e++)t.h.h=!0,n+=t.h.i.decode(r[e],{stream:!(s&&e==i-1)});return r.length=0,t.h.g+=n,t.C=0,t.h.g})(this));if(this.o=200==s,b=this.i,I=this.v,T=this.B,E=this.l,S=this.S,x=t,C=s,b.info(function(){return"XMLHTTP RESP ("+E+") [ attempt "+S+"]: "+I+"\n"+T+"\n"+x+" "+C}),this.o){if(this.U&&!this.L){t:{if(this.g){var o,u=this.g;if((o=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(o)){var h=o;break t}}h=null}if(!(e=h)){this.o=!1,this.m=3,N(12),M(this),R(this);break e}k(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,$e(this,e)}if(this.R){for(e=!0;!this.K&&this.C<a.length;){if(v=a,_=void 0,w=this.C,(n=-1==(_=v.indexOf("\n",w))?Be:(w=Number(v.substring(w,_)),isNaN(w)?Ue:(_+=1)+w>v.length?Be:(v=v.slice(_,_+w),this.C=_+w,v)))==Be){4==t&&(this.m=4,N(14),e=!1),k(this.i,this.l,null,"[Incomplete Response]");break}if(n==Ue){this.m=4,N(15),k(this.i,this.l,a,"[Invalid Chunk]"),e=!1;break}k(this.i,this.l,n,null),$e(this,n)}ze(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=t||0!=a.length||this.h.h||(this.m=1,N(16),e=!1),this.o=this.o&&e,e?0<a.length&&!this.W&&(this.W=!0,(i=this.j).g==this)&&i.aa&&!i.P&&(i.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),Qt(i),i.P=!0,N(11)):(k(this.i,this.l,a,"[Invalid Chunked Response]"),M(this),R(this))}else k(this.i,this.l,a,null),$e(this,a);4==t&&M(this),this.o&&!this.K&&(4==t?Wt(this.j,this):(this.o=!1,Ge(this)))}else{var l,c,d,f=this.g,g={},f=(f.g&&2<=O(f)&&f.g.getAllResponseHeaders()||"").split("\r\n");for(let e=0;e<f.length;e++)D(f[e])||(c=(l=(e=>{for(var t=1,r=(e=e.split(":"),[]);0<t&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r})(f[e]))[0],"string"==typeof(l=l[1])&&(l=l.trim(),d=g[c]||[],(g[c]=d).push(l)));function m(e){return e.join(", ")}var p,y=g;for(p in y)m.call(void 0,y[p],p,y);400==s&&0<a.indexOf("Unknown SID")?(this.m=3,N(12)):(this.m=0,N(13)),M(this),R(this)}}}}catch(e){}var v,w,_,b,I,T,E,S,x,C},m.prototype.cancel=function(){this.K=!0,M(this)},m.prototype.aa=function(){this.D=null;var e,t,r=Date.now();0<=r-this.T?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(ke(),N(17)),M(this),this.m=2,R(this)):Ke(this,this.T-r)};var He=class{constructor(e,t){this.g=e,this.map=t}};function We(e){this.l=e||10,e=A.PerformanceNavigationTiming?0<(e=A.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(A.chrome&&A.chrome.loadTimes&&A.chrome.loadTimes()&&A.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ye(e){return e.h||e.g&&e.g.size>=e.j}function Je(e){return e.h?1:e.g?e.g.size:0}function Xe(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function Ze(e,t){e.g?e.g.add(t):e.h=t}function et(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function tt(t){if(null!=t.h)return t.i.concat(t.h.G);if(null==t.g||0===t.g.size)return z(t.i);{let e=t.i;for(var r of t.g.values())e=e.concat(r.G);return e}}We.prototype.cancel=function(){if(this.i=tt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(var e of this.g.values())e.cancel();this.g.clear()}};var rt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function p(e){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let t;e instanceof p?(this.l=e.l,_(this,e.j),this.o=e.o,this.g=e.g,nt(this,e.u),this.h=e.h,it(this,wt(e.i)),this.m=e.m):e&&(t=String(e).match(rt))?(this.l=!1,_(this,t[1]||"",!0),this.o=at(t[2]||""),this.g=at(t[3]||"",!0),nt(this,t[4]),this.h=at(t[5]||"",!0),it(this,t[6]||"",!0),this.m=at(t[7]||"")):(this.l=!1,this.i=new gt(null,this.l))}function w(e){return new p(e)}function _(e,t,r){e.j=r?at(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function nt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function it(e,t,r){var n,i;t instanceof gt?(e.i=t,n=e.i,(i=e.l)&&!n.j&&(I(n),n.i=null,n.g.forEach(function(e,t){var r=t.toLowerCase();t!=r&&(mt(this,t),vt(this,r,e))},n)),n.j=i):(r||(t=ot(t,dt)),e.i=new gt(t,e.l))}function b(e,t,r){e.i.set(t,r)}function st(e){return b(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function at(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ot(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,ut),r?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function ut(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}p.prototype.toString=function(){var e=[],t=this.j,r=(t&&e.push(ot(t,ht,!0),":"),this.g);return!r&&"file"!=t||(e.push("//"),(t=this.o)&&e.push(ot(t,ht,!0),"@"),e.push(g(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null==(r=this.u))||e.push(":",String(r)),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(ot(r,"/"==r.charAt(0)?ct:lt,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",ot(r,ft)),e.join("")},p.prototype.resolve=function(e){var t=w(this);let r=!!e.j;r?_(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)nt(t,e.u);else if(r=!!e.h)if("/"!=n.charAt(0)&&(this.g&&!this.h?n="/"+n:-1!=(i=t.h.lastIndexOf("/"))&&(n=t.h.slice(0,i+1)+n)),".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){var n=0==i.lastIndexOf("/",0),i=i.split("/"),s=[];for(let e=0;e<i.length;){var a=i[e++];"."==a?n&&e==i.length&&s.push(""):".."==a?((1<s.length||1==s.length&&""!=s[0])&&s.pop(),n&&e==i.length&&s.push("")):(s.push(a),n=!0)}n=s.join("/")}else n=i;return r?t.h=n:r=""!==e.i.toString(),r?it(t,wt(e.i)):r=!!e.m,r&&(t.m=e.m),t};var ht=/[#\/\?@]/g,lt=/[#\?:]/g,ct=/[#\?]/g,dt=/[#\?@]/g,ft=/#/g;function gt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function I(n){if(!n.g&&(n.g=new Map,n.h=0,n.i)){var i=n.i;if(i){i=i.split("&");for(let r=0;r<i.length;r++){var s=i[r].indexOf("=");let e,t=null;0<=s?(e=i[r].substring(0,s),t=i[r].substring(s+1)):e=i[r],s=e,a=t?decodeURIComponent(t.replace(/\+/g," ")):"",n.add(decodeURIComponent(s.replace(/\+/g," ")),a)}}}var a}function mt(e,t){I(e),t=T(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function pt(e,t){return I(e),t=T(e,t),e.g.has(t)}function yt(e,t){I(e);let r=[];if("string"==typeof t)pt(e,t)&&(r=r.concat(e.g.get(T(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function vt(e,t,r){mt(e,t),0<r.length&&(e.i=null,e.g.set(T(e,t),z(r)),e.h+=r.length)}function wt(e){var t=new gt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function T(e,t){return t=String(t),e.j?t.toLowerCase():t}function E(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function _t(){this.g=new Ie}function bt(e){this.i=e.Sb||null,this.h=e.ab||!1}function It(e,t){a.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Tt(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function Et(e){e.readyState=4,e.l=null,e.j=null,e.B=null,St(e)}function St(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function xt(e){let r="";return ee(e,function(e,t){r=(r=r+t+":")+e+"\r\n"}),r}function Ct(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=xt(r),"string"==typeof e?null!=r&&g(r):b(e,t,r))}function S(e){a.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=gt.prototype).add=function(e,t){I(this),this.i=null,e=T(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},e.forEach=function(r,n){I(this),this.g.forEach(function(e,t){e.forEach(function(e){r.call(n,e,t,this)},this)},this)},e.set=function(e,t){return I(this),this.i=null,pt(this,e=T(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=yt(this,e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";var r=[],t=Array.from(this.g.keys());for(let e=0;e<t.length;e++){var n=g(i=t[e]),i=yt(this,i);for(let t=0;t<i.length;t++){let e=n;""!==i[t]&&(e+="="+g(i[t])),r.push(e)}}return this.i=r.join("&")},t(bt,Te),bt.prototype.g=function(){return new It(this.i,this.h)},t(It,a),(e=It.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,St(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;var t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||A).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Et(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,St(this)),this.g)&&(this.readyState=3,St(this),this.g))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==A.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Tt(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){var t;this.g&&(this.o&&e.value?this.response.push(e.value):!this.o&&(t=e.value||new Uint8Array(0),t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t),(e.done?Et:St)(this),3==this.readyState)&&Tt(this)},e.Oa=function(e){this.g&&(this.response=this.responseText=e,Et(this))},e.Na=function(e){this.g&&(this.response=e,Et(this))},e.ga=function(){this.g&&Et(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),r=t.next();!r.done;)r=r.value,e.push(r[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(It.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),t(S,a);var At=/^https?$/i,Dt=["POST","PUT"];function Nt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,kt(e),Mt(e)}function kt(e){e.A||(e.A=!0,u(e,"complete"),u(e,"error"))}function Rt(t){if(t.h&&void 0!==U)if(t.v&&4==O(t))setTimeout(t.Ca.bind(t),0);else if(u(t,"readystatechange"),4==O(t)){t.h=!1;try{var e,r,n=t.ca();switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var i=!0;break;default:i=!1}if(!(e=i)){if(r=0===n){let e=String(t.D).match(rt)[1]||null;!e&&A.self&&A.self.location&&(e=A.self.location.protocol.slice(0,-1)),r=!At.test(e?e.toLowerCase():"")}e=r}if(e)u(t,"complete"),u(t,"success");else{t.o=6;try{var s=2<O(t)?t.g.statusText:""}catch(e){s=""}t.l=s+" ["+t.ca()+"]",kt(t)}}finally{Mt(t)}}}function Mt(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);var r=e.g;e.g=null,t||u(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function O(e){return e.g?e.g.readyState:0}function Ot(e){try{if(e.g){if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}}return null}catch(e){return null}}function Lt(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function Pt(e){this.za=0,this.i=[],this.j=new c,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Lt("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Lt("baseRetryDelayMs",5e3,e),this.Za=Lt("retryDelaySeedMs",1e4,e),this.Ta=Lt("forwardChannelMaxRetries",2,e),this.va=Lt("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new We(e&&e.concurrentRequestLimit),this.Ba=new _t,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Vt(e){if(Ut(e),3==e.I){var t=e.V++,r=w(e.J);if(b(r,"SID",e.M),b(r,"RID",t),b(r,"TYPE","terminate"),jt(e,r),(t=new m(e,e.j,t)).M=2,t.A=st(w(r)),r=!1,A.navigator&&A.navigator.sendBeacon)try{r=A.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&A.Image&&((new Image).src=t.A,r=!0),r||(t.g=Zt(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Ge(t)}Jt(e)}function Ft(e){e.g&&(Qt(e),e.g.cancel(),e.g=null)}function Ut(e){Ft(e),e.v&&(A.clearTimeout(e.v),e.v=null),Ht(e),e.h.cancel(),e.m&&("number"==typeof e.m&&A.clearTimeout(e.m),e.m=null)}function Bt(e){var t;Ye(e.h)||e.m||(e.m=!0,t=e.Ea,r||H(),n||(r(),n=!0),$.add(t,e),e.D=0)}function qt(e,t){var r=t?t.l:e.V++,n=w(e.J);b(n,"SID",e.M),b(n,"RID",r),b(n,"AID",e.K),jt(e,n),e.u&&e.o&&Ct(n,e.u,e.o),r=new m(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=zt(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),Ze(e.h,r),qe(r,n,t)}function jt(e,r){e.H&&ee(e.H,function(e,t){b(r,t,e)}),e.l&&ee({},function(e,t){b(r,t,e)})}function zt(i,e,s){s=Math.min(i.i.length,s);var a=i.l?y(i.l.Ka,i.l,i):null;e:{let r=i.i,n=-1;for(;;){var o=["count="+s];-1==n?0<s?(n=r[0].g,o.push("ofs="+n)):n=0:o.push("ofs="+n);let t=!0;for(let e=0;e<s;e++){var u=r[e].g,h=r[e].map;if((u-=n)<0)n=Math.max(0,r[e].g-100),t=!1;else try{u="req"+u+"_"||"";try{var l,c,d=h instanceof Map?h:Object.entries(h);for([l,c]of d){let e=c;f(c)&&(e=_e(c)),o.push(u+l+"="+encodeURIComponent(e))}}catch(i){throw o.push(u+"type="+encodeURIComponent("_badmap")),i}}catch(i){a&&a(h)}}if(t){d=o.join("&");break e}}d=void 0}return i=i.i.splice(0,s),e.G=i,d}function Gt(e){var t;e.g||e.v||(e.Y=1,t=e.Da,r||H(),n||(r(),n=!0),$.add(t,e),e.A=0)}function Kt(e){return!(e.g||e.v||3<=e.A)&&(e.Y++,e.v=v(y(e.Da,e),Yt(e,e.A)),e.A++,1)}function Qt(e){null!=e.B&&(A.clearTimeout(e.B),e.B=null)}function $t(e){e.g=new m(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=w(e.na),r=(b(t,"RID","rpc"),b(t,"SID",e.M),b(t,"AID",e.K),b(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&b(t,"TO",e.ia),b(t,"TYPE","xmlhttp"),jt(e,t),e.u&&e.o&&Ct(t,e.u,e.o),e.O&&(e.g.H=e.O),e.g);e=e.ba,r.M=1,r.A=st(w(t)),r.u=null,r.R=!0,je(r,e)}function Ht(e){null!=e.C&&(A.clearTimeout(e.C),e.C=null)}function Wt(e,t){var r,n,i,s=null;if(e.g==t){Ht(e),Qt(e),e.g=null;var a=2}else{if(!Xe(e.h,t))return;s=t.G,et(e.h,t),a=1}if(0!=e.I)if(t.o)(1==a?(s=t.u?t.u.length:0,t=Date.now()-t.F,r=e.D,u(a=De(),new Me(a,s)),Bt):Gt)(e);else if(3==(r=t.m)||0==r&&0<t.X||(1!=a||(i=t,Je((n=e).h)>=n.h.j-(n.m?1:0))||(n.m?(n.i=i.G.concat(n.i),0):1==n.I||2==n.I||n.D>=(n.Sa?0:n.Ta)||(n.m=v(y(n.Ea,n,i),Yt(n,n.D)),n.D++,0)))&&(2!=a||!Kt(e)))switch(s&&0<s.length&&(t=e.h,t.i=t.i.concat(s)),r){case 1:x(e,5);break;case 4:x(e,10);break;case 3:x(e,6);break;default:x(e,2)}}function Yt(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function x(e,t){var r,n,i;e.j.info("Error code "+t),2==t?(r=y(e.bb,e),n=!(i=e.Ua),i=new p(i||"//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||_(i,"https"),st(i),(n?(t,r)=>{var n=new c;if(A.Image){let e=new Image;e.onload=q(E,n,"TestLoadImage: loaded",!0,r,e),e.onerror=q(E,n,"TestLoadImage: error",!1,r,e),e.onabort=q(E,n,"TestLoadImage: abort",!1,r,e),e.ontimeout=q(E,n,"TestLoadImage: timeout",!1,r,e),A.setTimeout(function(){e.ontimeout&&e.ontimeout()},1e4),e.src=t}else r(!1)}:(e,t)=>{let r=new c,n=new AbortController,i=setTimeout(()=>{n.abort(),E(r,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(i),e.ok?E(r,0,!0,t):E(r,0,!1,t)}).catch(()=>{clearTimeout(i),E(r,0,!1,t)})})(i.toString(),r)):N(2),e.I=0,e.l&&e.l.pa(t),Jt(e),Ut(e)}function Jt(e){var t;e.I=0,e.ja=[],e.l&&(0==(t=tt(e.h)).length&&0==e.i.length||(G(e.ja,t),G(e.ja,e.i),e.h.i.length=0,z(e.i),e.i.length=0),e.l.oa())}function Xt(e,t,r){var n,i,s=r instanceof p?w(r):new p(r);return""!=s.g?(t&&(s.g=t+"."+s.g),nt(s,s.u)):(s=(n=A.location).protocol,t=t?t+"."+n.hostname:n.hostname,n=+n.port,i=new p(null),s&&_(i,s),t&&(i.g=t),n&&nt(i,n),r&&(i.h=r),s=i),r=e.G,t=e.wa,r&&t&&b(s,r,t),b(s,"VER",e.ka),jt(e,s),s}function Zt(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new S(new bt({ab:r})):new S(e.ma)).Fa(e.L),t}function er(){}function tr(){}function C(e,t){a.call(this),this.g=new Pt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!D(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!D(t)&&(this.g.G=t,null!==(e=this.h))&&t in e&&t in(e=this.h)&&delete e[t],this.j=new L(this)}function rr(e){xe.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(var r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function nr(){Ce.call(this),this.status=1}function L(e){this.g=e}(e=S.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,r,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=(this.L||Fe).g(),this.g.onreadystatechange=j(y(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Nt(this,e)}if(e=r||"",r=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var i in n)r.set(i,n[i]);else{if("function"!=typeof n.keys||"function"!=typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(var s of n.keys())r.set(s,n.get(s))}n=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),i=A.FormData&&e instanceof A.FormData,0<=Array.prototype.indexOf.call(Dt,t,void 0)&&!n&&!i&&r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[a,o]of r)this.g.setRequestHeader(a,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(e){Nt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,u(this,"complete"),u(this,"abort"),Mt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Mt(this,!0)),S.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Rt(this):this.Xa())},e.Xa=function(){Rt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return 2<O(this)?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){var t;if(this.g)return t=this.g.responseText,e&&0==t.indexOf(e)&&(t=t.substring(e.length)),be(t)},e.ya=function(){return this.o},e.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Pt.prototype).ka=8,e.I=1,e.connect=function(e,t,r,n){N(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=Xt(this,null,this.W),Bt(this)},e.Ea=function(t){if(this.m)if(this.m=null,1==this.I){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var r=new m(this,this.j,t);let e=this.o;if(this.U&&(e?ne(e=te(e),this.U):e=this.U),null!==this.u||this.R||(r.J=e,e=null),this.S)e:{for(var n=0,i=0;i<this.i.length;i++){var s=this.i[i];if(void 0===(s="__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s.length:void 0))break;if(4096<(n+=s)){n=i;break e}if(4096===n||i===this.i.length-1){n=i+1;break e}}n=1e3}else n=1e3;n=zt(this,r,n),b(i=w(this.J),"RID",t),b(i,"CVER",22),this.G&&b(i,"X-HTTP-Session-Id",this.G),jt(this,i),e&&(this.R?n="headers="+g(xt(e))+"&"+n:this.u&&Ct(i,this.u,e)),Ze(this.h,r),this.Ra&&b(i,"TYPE","init"),this.S?(b(i,"$req",n),b(i,"SID","null"),r.U=!0,qe(r,i,null)):qe(r,i,n),this.I=2}}else 3==this.I&&(t?qt(this,t):0==this.i.length||Ye(this.h)||qt(this))},e.Da=function(){var e;this.v=null,$t(this),this.aa&&!(this.P||null==this.g||this.T<=0)&&(e=4*this.T,this.j.info("BP detection timer enabled: "+e),this.B=v(y(this.Wa,this),e))},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,N(10),Ft(this),$t(this))},e.Va=function(){null!=this.C&&(this.C=null,Ft(this),Kt(this),N(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),N(2)):(this.j.info("Failed to ping google.com"),N(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=er.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},tr.prototype.g=function(e,t){return new C(e,t)},t(C,a),C.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},C.prototype.close=function(){Vt(this.g)},C.prototype.o=function(e){var t,r=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.v&&((t={}).__data__=_e(e),e=t),r.i.push(new He(r.Ya++,e)),3==r.I&&Bt(r)},C.prototype.N=function(){this.g.l=null,delete this.j,Vt(this.g),delete this.g,C.Z.N.call(this)},t(rr,xe),t(nr,Ce),t(L,er),L.prototype.ra=function(){u(this.g,"a")},L.prototype.qa=function(e){u(this.g,new rr(e))},L.prototype.pa=function(e){u(this.g,new nr)},L.prototype.oa=function(){u(this.g,"b")},tr.prototype.createWebChannel=tr.prototype.g,C.prototype.send=C.prototype.o,C.prototype.open=C.prototype.m,cr=function(){return new tr},lr=De,hr=l,ur={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Oe.NO_ERROR=0,Oe.TIMEOUT=8,Oe.HTTP_ERROR=6,or=Oe,Le.COMPLETE="complete",ar=Le,(Ee.EventType=Se).OPEN="a",Se.CLOSE="b",Se.ERROR="c",Se.MESSAGE="d",a.prototype.listen=a.prototype.J,sr=Ee,S.prototype.listenOnce=S.prototype.K,S.prototype.getLastError=S.prototype.Ha,S.prototype.getLastErrorCode=S.prototype.ya,S.prototype.getStatus=S.prototype.ca,S.prototype.getResponseJson=S.prototype.La,S.prototype.getResponseText=S.prototype.la,S.prototype.send=S.prototype.ea,S.prototype.setWithCredentials=S.prototype.Fa,ir=S}.apply(dr),"@firebase/firestore");class u{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}u.UNAUTHENTICATED=new u(null),u.GOOGLE_CREDENTIALS=new u("google-credentials-uid"),u.FIRST_PARTY=new u("first-party-uid"),u.MOCK_USER=new u("mock-user");let ge="12.3.0",me=new class{constructor(e){this.name=e,this._logLevel=ae,this._logHandler=ue,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in c))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?se[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,c.DEBUG,...e),this._logHandler(this,c.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,c.VERBOSE,...e),this._logHandler(this,c.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,c.INFO,...e),this._logHandler(this,c.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,c.WARN,...e),this._logHandler(this,c.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,c.ERROR,...e),this._logHandler(this,c.ERROR,...e)}}("@firebase/firestore");function pe(){return me.logLevel}function m(e,...t){me.logLevel<=c.DEBUG&&(t=t.map(ve),me.debug(`Firestore (${ge}): `+e,...t))}function d(e,...t){me.logLevel<=c.ERROR&&(t=t.map(ve),me.error(`Firestore (${ge}): `+e,...t))}function ye(e,...t){me.logLevel<=c.WARN&&(t=t.map(ve),me.warn(`Firestore (${ge}): `+e,...t))}function ve(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function _(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,we(e,n,r)}function we(e,t,r){let n=`FIRESTORE (${ge}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw d(n),new Error(n)}function v(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||we(t,i,n)}let T={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class E extends Z{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: `+this.message}}class f{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class _e{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer "+e)}}class be{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(u.UNAUTHENTICATED))}shutdown(){}}class Ie{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Te{constructor(e){this.t=e,this.currentUser=u.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,r){v(void 0===this.o,42304);let n=this.i,i=e=>this.i!==n?(n=this.i,r(e)):Promise.resolve(),s=new f,a=(this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new f,t.enqueueRetryable(()=>i(this.currentUser))},()=>{let e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})}),o=e=>{m("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(m("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new f))},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(m("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(v("string"==typeof e.accessToken,31837,{l:e}),new _e(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){var e=this.auth&&this.auth.getUid();return v(null===e||"string"==typeof e,2055,{h:e}),new u(e)}}class Ee{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=u.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);var e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Se{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Ee(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(u.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class xe{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class Ce{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,vd._isFirebaseServerApp(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(t,r){v(void 0===this.o,3512);let n=e=>{null!=e.error&&m("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: "+e.error.message);var t=e.token!==this.m;return this.m=e.token,m("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?r(e.token):Promise.resolve()},i=(this.o=e=>{t.enqueueRetryable(()=>n(e))},e=>{m("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)});this.V.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.V.getImmediate({optional:!0}))?i(e):m("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e;return this.p?Promise.resolve(new xe(this.p)):(e=this.forceRefresh,this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(v("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new xe(e.token)):null):Promise.resolve(null))}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class Ae{static newId(){var t=62*Math.floor(256/62);let r="";for(;r.length<20;){var n=(()=>{var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(40);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let e=0;e<40;e++)t[e]=Math.floor(256*Math.random());return t})();for(let e=0;e<n.length;++e)r.length<20&&n[e]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[e]%62))}return r}}function b(e,t){return e<t?-1:t<e?1:0}function De(t,r){var n=Math.min(t.length,r.length);for(let e=0;e<n;e++){var i=t.charAt(e),s=r.charAt(e);if(i!==s)return Re(i)===Re(s)?b(i,s):Re(i)?1:-1}return b(t.length,r.length)}let Ne=55296,ke=57343;function Re(e){e=e.charCodeAt(0);return e>=Ne&&e<=ke}function Me(e,r,n){return e.length===r.length&&e.every((e,t)=>n(e,r[t]))}function Oe(e){return e+"\0"}let Le="__name__";class Pe{constructor(e,t,r){void 0===t?t=0:t>e.length&&_(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&_(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Pe.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof Pe?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(r){for(let e=this.offset,t=this.limit();e<t;e++)r(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,r){var n=Math.min(t.length,r.length);for(let e=0;e<n;e++){var i=Pe.compareSegments(t.get(e),r.get(e));if(0!==i)return i}return b(t.length,r.length)}static compareSegments(e,t){var r=Pe.isNumericId(e),n=Pe.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?Pe.extractNumericId(e).compare(Pe.extractNumericId(t)):De(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return he.fromString(e.substring(4,e.length-2))}}class S extends Pe{construct(e,t,r){return new S(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){var t,r=[];for(t of e){if(0<=t.indexOf("//"))throw new E(T.INVALID_ARGUMENT,`Invalid segment (${t}). Paths must not contain // in them.`);r.push(...t.split("/").filter(e=>0<e.length))}return new S(r)}static emptyPath(){return new S([])}}let Ve=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class l extends Pe{construct(e,t,r){return new l(e,t,r)}static isValidIdentifier(e){return Ve.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=l.isValidIdentifier(e)?e:"`"+e+"`")).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Le}static keyField(){return new l([Le])}static fromServerFormat(e){let t=[],r="",n=0;var i=()=>{if(0===r.length)throw new E(T.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let s=!1;for(;n<e.length;){var a=e[n];if("\\"===a){if(n+1===e.length)throw new E(T.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var o=e[n+1];if("\\"!==o&&"."!==o&&"`"!==o)throw new E(T.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=o,n+=2}else"`"===a?s=!s:"."!==a||s?r+=a:i(),n++}if(i(),s)throw new E(T.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new l(t)}static emptyPath(){return new l([])}}class x{constructor(e){this.path=e}static fromPath(e){return new x(S.fromString(e))}static fromName(e){return new x(S.fromString(e).popFirst(5))}static empty(){return new x(S.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===S.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return S.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new x(new S(e.slice()))}}function Fe(e,t,r){if(!r)throw new E(T.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Ue(e,t,r,n){if(!0===t&&!0===n)throw new E(T.INVALID_ARGUMENT,e+` and ${r} cannot be used together.`)}function Be(e){if(!x.isDocumentKey(e))throw new E(T.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function qe(e){if(x.isDocumentKey(e))throw new E(T.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function je(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ze(e){var t;return void 0===e?"undefined":null===e?"null":"string"==typeof e?(20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e)):"number"==typeof e||"boolean"==typeof e?""+e:"object"==typeof e?e instanceof Array?"an array":(t=e.constructor?e.constructor.name:null)?`a custom ${t} object`:"an object":"function"==typeof e?"a function":_(12329,{type:typeof e})}function p(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new E(T.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");e=ze(e);throw new E(T.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: `+e)}function Ge(e,t){if(t<=0)throw new E(T.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function e(e,t){e={typeString:e};return t&&(e.value=t),e}function Ke(e,t){if(!je(e))throw new E(T.INVALID_ARGUMENT,"JSON must be an object");let r;for(var n in t)if(t[n]){var i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}var a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new E(T.INVALID_ARGUMENT,r);return 1}let Qe=-62135596800;class y{static now(){return y.fromMillis(Date.now())}static fromDate(e){return y.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),e=Math.floor(1e6*(e-1e3*t));return new y(t,e)}constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new E(T.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new E(T.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Qe)throw new E(T.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new E(T.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?b(this.nanoseconds,e.nanoseconds):b(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:y._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ke(e,y._jsonSchema))return new y(e.seconds,e.nanoseconds)}valueOf(){var e=this.seconds-Qe;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}y._jsonSchemaVersion="firestore/timestamp/1.0",y._jsonSchema={type:e("string",y._jsonSchemaVersion),seconds:e("number"),nanoseconds:e("number")};class w{static fromTimestamp(e){return new w(e)}static min(){return new w(new y(0,0))}static max(){return new w(new y(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class $e{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function He(e){return e.fields.find(e=>2===e.kind)}function We(e){return e.fields.filter(e=>2!==e.kind)}$e.UNKNOWN_ID=-1;class Ye{constructor(e,t){this.fieldPath=e,this.kind=t}}class Je{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Je(0,et.min())}}function Xe(e,t){var r=e.toTimestamp().seconds,e=e.toTimestamp().nanoseconds+1,r=w.fromTimestamp(1e9===e?new y(r+1,0):new y(r,e));return new et(r,x.empty(),t)}function Ze(e){return new et(e.readTime,e.key,-1)}class et{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new et(w.min(),x.empty(),-1)}static max(){return new et(w.max(),x.empty(),-1)}}function tt(e,t){var r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=x.comparator(e.documentKey,t.documentKey))?r:b(e.largestBatchId,t.largestBatchId)}let rt="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class nt{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function it(e){if(e.code!==T.FAILED_PRECONDITION||e.message!==rt)throw e;m("LocalStore","Unexpectedly lost primary lease")}class C{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(n,i){return this.callbackAttached&&_(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(n,this.result):new C((t,r)=>{this.nextCallback=e=>{this.wrapSuccess(n,e).next(t,r)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof C?t:C.resolve(t)}catch(e){return C.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):C.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):C.reject(t)}static resolve(r){return new C((e,t)=>{e(r)})}static reject(r){return new C((e,t)=>{t(r)})}static waitFor(e){return new C((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let r=C.resolve(!1);for(let t of e)r=r.next(e=>e?C.resolve(e):t());return r}static forEach(e,r){let n=[];return e.forEach((e,t)=>{n.push(r.call(this,e,t))}),this.waitFor(n)}static mapArray(o,u){return new C((r,n)=>{let i=o.length,s=new Array(i),a=0;for(let e=0;e<i;e++){let t=e;u(o[t]).next(e=>{s[t]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(n,i){return new C((e,t)=>{let r=()=>{!0===n()?i().next(()=>{r()},t):e()};r()})}}let st="SimpleDb";class at{static open(e,t,r,n){try{return new at(t,e.transaction(n,r))}catch(e){throw new lt(t,e)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new f,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new lt(t,e.error)):this.S.resolve()},this.transaction.onerror=e=>{e=mt(e.target.error);this.S.reject(new lt(t,e))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(m(st,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){var e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){e=this.transaction.objectStore(e);return new dt(e)}}class ot{static delete(e){return m(st,"Removing database:",e),ft(j().indexedDB.deleteDatabase(e)).toPromise()}static v(){var e,t,r;return!(!(()=>{try{return"object"==typeof indexedDB}catch(e){}})()||!ot.F()&&(e=W(),t=0<(t=ot.M(e))&&t<10,r=0<(r=ut(e))&&r<4.5,0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||t||r))}static F(){return"undefined"!=typeof process&&"YES"===process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){e=(e=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i))?e[1].split("_").slice(0,2).join("."):"-1";return Number(e)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,12.2===ot.M(W())&&d("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(i){return this.db||(m(st,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{e=e.target.result;t(e)},n.onblocked=()=>{r(new lt(i,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=e=>{e=e.target.error;"VersionError"===e.name?r(new E(T.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===e.name?r(new E(T.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+e)):r(new lt(i,e))},n.onupgradeneeded=e=>{m(st,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.N.k(t,n.transaction,e.oldVersion,this.version).next(()=>{m(st,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db}$(t){this.q=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(r,e,n,i){var s="readonly"===e;let t=0;for(;;){++t;try{this.db=await this.L(r);let t=at.open(this.db,r,s?"readonly":"readwrite",n),e=i(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),C.reject(e))).toPromise();return e.catch(()=>{}),await t.D,e}catch(r){var a=r,o="FirebaseError"!==a.name&&t<3;if(m(st,"Transaction failed with error:",a.message,"Retrying:",o),this.close(),!o)return Promise.reject(a)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ut(e){e=(e=e.match(/Android ([\d.]+)/i))?e[1].split(".").slice(0,2).join("."):"-1";return Number(e)}class ht{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return ft(this.U.delete())}}class lt extends E{constructor(e,t){super(T.UNAVAILABLE,`IndexedDB transaction '${e}' failed: `+t),this.name="IndexedDbTransactionError"}}function ct(e){return"IndexedDbTransactionError"===e.name}class dt{constructor(e){this.store=e}put(e,t){return ft(void 0!==t?(m(st,"PUT",this.store.name,e,t),this.store.put(t,e)):(m(st,"PUT",this.store.name,"<auto-key>",e),this.store.put(e)))}add(e){return m(st,"ADD",this.store.name,e,e),ft(this.store.add(e))}get(t){return ft(this.store.get(t)).next(e=>(void 0===e&&(e=null),m(st,"GET",this.store.name,t,e),e))}delete(e){return m(st,"DELETE",this.store.name,e),ft(this.store.delete(e))}count(){return m(st,"COUNT",this.store.name),ft(this.store.count())}J(t,r){t=this.options(t,r),r=t.index?this.store.index(t.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(t.range);return new C((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(t),r=[];return this.H(e,(e,t)=>{r.push(t)}).next(()=>r)}}Y(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new C((t,r)=>{n.onerror=e=>{r(e.target.error)},n.onsuccess=e=>{t(e.target.result)}})}Z(e,t){m(st,"DELETE ALL",this.store.name);(e=this.options(e,t)).X=!1;e=this.cursor(e);return this.H(e,(e,t,r)=>r.delete())}ee(e,t){let r;t?r=e:(r={},t=e);e=this.cursor(r);return this.H(e,t)}te(n){let e=this.cursor({});return new C((r,t)=>{e.onerror=e=>{e=mt(e.target.error);t(e)},e.onsuccess=e=>{let t=e.target.result;t?n(t.primaryKey,t.value).next(e=>{e?t.continue():r()}):r()}})}H(e,s){let a=[];return new C((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=r=>{var n,r=r.target.result;if(r){let t=new ht(r),e=s(r.primaryKey,r.value,t);e instanceof C&&(n=e.catch(e=>(t.done(),C.reject(e))),a.push(n)),t.isDone?i():null===t.G?r.continue():r.continue(t.G)}else i()}}).next(()=>C.waitFor(a))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";var r;return e.reverse&&(t="prev"),e.index?(r=this.store.index(e.index),e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)):this.store.openCursor(e.range,t)}}function ft(e){return new C((t,r)=>{e.onsuccess=e=>{e=e.target.result;t(e)},e.onerror=e=>{e=mt(e.target.error);r(e)}})}let gt=!1;function mt(e){var t=ot.M(W());if(12.2<=t&&t<13){t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){let e=new E("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return gt||(gt=!0,setTimeout(()=>{throw e},0)),e}}return e}let pt="IndexBackfiller";class yt{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){m(pt,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{var e=await this.ne.ie();m(pt,"Documents written: "+e)}catch(e){ct(e)?m(pt,"Ignoring IndexedDB error during index backfill: ",e):await it(e)}await this.re(6e4)})}}class vt{constructor(e,t){this.localStore=e,this.persistence=t}async ie(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.se(e,t))}se(e,t){let r=new Set,n=t,i=!0;return C.doWhile(()=>!0===i&&0<n,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return m(pt,"Processing collection: "+t),this.oe(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}oe(n,i,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(n,i).next(r=>this.localStore.localDocuments.getNextDocuments(n,i,r,e).next(e=>{let t=e.changes;return this.localStore.indexManager.updateIndexEntries(n,t).next(()=>this._e(r,e)).next(e=>(m(pt,"Updating offset: "+e),this.localStore.indexManager.updateCollectionGroup(n,i,e))).next(()=>t.size)}))}_e(e,t){let r=e;return t.changes.forEach((e,t)=>{t=Ze(t);0<tt(t,r)&&(r=t)}),new et(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class wt{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.ue&&this.ue(e),e}}let _t=wt.ce=-1;function bt(e){return null==e}function It(e){return 0===e&&1/e==-1/0}function Tt(e){return"number"==typeof e&&Number.isInteger(e)&&!It(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}let Et="";function o(t){let s="";for(let e=0;e<t.length;e++)0<s.length&&(s=St(s)),s=(t=>{let r=s,n=t.length;for(let e=0;e<n;e++){var i=t.charAt(e);switch(i){case"\0":r+="";break;case Et:r+="";break;default:r+=i}}return r})(t.get(e));return St(s)}function St(e){return e+Et+""}function xt(r){var e=r.length;if(v(2<=e,64408,{path:r}),2===e)return v(r.charAt(0)===Et&&""===r.charAt(1),56145,{path:r}),S.emptyPath();var n=e-2,i=[];let s="";for(let t=0;t<e;){var a=r.indexOf(Et,t);switch((a<0||n<a)&&_(50515,{path:r}),r.charAt(a+1)){case"":var o=r.substring(t,a);let e;0===s.length?e=o:(s+=o,e=s,s=""),i.push(e);break;case"":s=s+r.substring(t,a)+"\0";break;case"":s+=r.substring(t,a+1);break;default:_(61167,{path:r})}t=a+2}return new S(i)}let Ct="remoteDocuments",At="owner",Dt="owner",Nt="mutationQueues",kt="mutations",Rt="batchId",Mt="userMutationsIndex",Ot=["userId","batchId"];function Lt(e,t){return[e,o(t)]}function Pt(e,t,r){return[e,o(t),r]}let Vt={},Ft="documentMutations",Ut="remoteDocumentsV14",Bt=["prefixPath","collectionGroup","readTime","documentId"],qt="documentKeyIndex",jt=["prefixPath","collectionGroup","documentId"],zt="collectionGroupIndex",Gt=["collectionGroup","readTime","prefixPath","documentId"],Kt="remoteDocumentGlobal",Qt="remoteDocumentGlobalKey",$t="targets",Ht="queryTargetsIndex",Wt=["canonicalId","targetId"],Yt="targetDocuments",Jt=["targetId","path"],Xt="documentTargetsIndex",Zt=["path","targetId"],er="targetGlobalKey",tr="targetGlobal",rr="collectionParents",nr=["collectionId","parent"],fr="clientMetadata",gr="bundles",mr="namedQueries",pr="indexConfiguration",yr="collectionGroupIndex",vr="indexState",wr=["indexId","uid"],_r="sequenceNumberIndex",br=["uid","sequenceNumber"],Ir="indexEntries",Tr=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Er="documentKeyIndex",Sr=["indexId","uid","orderedDocumentKey"],xr="documentOverlays",Cr=["userId","collectionPath","documentId"],Ar="collectionPathOverlayIndex",Dr=["userId","collectionPath","largestBatchId"],Nr="collectionGroupOverlayIndex",kr=["userId","collectionGroup","largestBatchId"],Rr="globals",Mr=[Nt,kt,Ft,Ct,$t,At,tr,Yt,fr,Kt,rr,gr,mr],Or=[...Mr,xr],Lr=[Nt,kt,Ft,Ut,$t,At,tr,Yt,fr,Kt,rr,gr,mr,xr],Pr=Lr,Vr=[...Pr,pr,vr,Ir],Fr=Vr,Ur=[...Vr,Rr],Br=Ur;class qr extends nt{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function r(e,t){return ot.O(e.le,t)}function jr(e){let t=0;for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function zr(e,t){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function Gr(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class A{constructor(e,t){this.comparator=e,this.root=t||Qr.EMPTY}insert(e,t){return new A(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Qr.BLACK,null,null))}remove(e){return new A(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Qr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:0<r&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){var n=this.comparator(e,r.key);if(0===n)return t+r.left.size;r=n<0?r.left:(t+=r.left.size+1,r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(r){this.inorderTraversal((e,t)=>(r(e,t),!1))}toString(){let r=[];return this.inorderTraversal((e,t)=>(r.push(e+":"+t),!1)),`{${r.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Kr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Kr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Kr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Kr(this.root,e,this.comparator,!0)}}class Kr{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){var e;return 0===this.nodeStack.length?null:{key:(e=this.nodeStack[this.nodeStack.length-1]).key,value:e.value}}}class Qr{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:Qr.RED,this.left=null!=n?n:Qr.EMPTY,this.right=null!=i?i:Qr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new Qr(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){var n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return Qr.EMPTY;let e=this;return(e=(e=e.left.isRed()||e.left.left.isRed()?e:e.moveRedLeft()).copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(t(e,n.key)<0)n=(n=n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()?n:n.moveRedLeft()).copy(null,null,null,n.left.remove(e,t),null);else{if(0===t(e,(n=(n=n.left.isRed()?n.rotateRight():n).right.isEmpty()||n.right.isRed()||n.right.left.isRed()?n:n.moveRedRight()).key)){if(n.right.isEmpty())return Qr.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e=(e=(e=e.right.isRed()&&!e.left.isRed()?e.rotateLeft():e).left.isRed()&&e.left.left.isRed()?e.rotateRight():e).left.isRed()&&e.right.isRed()?e.colorFlip():e}moveRedLeft(){let e=this.colorFlip();return e=e.right.left.isRed()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip():e}moveRedRight(){let e=this.colorFlip();return e=e.left.left.isRed()?(e=e.rotateRight()).colorFlip():e}rotateLeft(){var e=this.copy(null,null,Qr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,Qr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw _(43730,{key:this.key,value:this.value});if(this.right.isRed())throw _(14113,{key:this.key,value:this.value});var e=this.left.check();if(e!==this.right.check())throw _(27949);return e+(this.isRed()?0:1)}}Qr.EMPTY=null,Qr.RED=!0,Qr.BLACK=!1,Qr.EMPTY=new class{constructor(){this.size=0}get key(){throw _(57766)}get value(){throw _(16141)}get color(){throw _(16727)}get left(){throw _(29726)}get right(){throw _(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new Qr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class D{constructor(e){this.comparator=e,this.data=new A(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(r){this.data.inorderTraversal((e,t)=>(r(e),!1))}forEachInRange(e,t){for(var r=this.data.getIteratorFrom(e[0]);r.hasNext();){var n=r.getNext();if(0<=this.comparator(n.key,e[1]))return;t(n.key)}}forEachWhile(e,t){for(var r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){e=this.data.getIteratorFrom(e);return e.hasNext()?e.getNext().key:null}getIterator(){return new $r(this.data.getIterator())}getIteratorFrom(e){return new $r(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof D))return!1;if(this.size!==e.size)return!1;for(var t=this.data.getIterator(),r=e.data.getIterator();t.hasNext();){var n=t.getNext().key,i=r.getNext().key;if(0!==this.comparator(n,i))return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){var t=new D(this.comparator);return t.data=e,t}}class $r{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Hr(e){return e.hasNext()?e.getNext():void 0}class Wr{constructor(e){(this.fields=e).sort(l.comparator)}static empty(){return new Wr([])}unionWith(e){let t=new D(l.comparator);for(var r of this.fields)t=t.add(r);for(var n of e)t=t.add(n);return new Wr(t.toArray())}covers(e){for(var t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Me(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Yr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class N{constructor(e){this.binaryString=e}static fromBase64String(e){e=(e=>{try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Yr("Invalid base64 string: "+e):e}})(e);return new N(e)}static fromUint8Array(e){e=(t=>{let r="";for(let e=0;e<t.length;++e)r+=String.fromCharCode(t[e]);return r})(e);return new N(e)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){var t=this.binaryString,r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return b(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}N.EMPTY_BYTE_STRING=new N("");let Jr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Xr(t){if(v(!!t,39018),"string"!=typeof t)return{seconds:k(t.seconds),nanos:k(t.nanos)};{let e=0;v(!!(r=Jr.exec(t)),46558,{timestamp:t}),r[1]&&(r=((r=r[1])+"000000000").substr(0,9),e=Number(r));var r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function k(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Zr(e){return"string"==typeof e?N.fromBase64String(e):N.fromUint8Array(e)}let en="server_timestamp",tn="__type__",rn="__previous_value__",nn="__local_write_time__";function sn(e){return(e?.mapValue?.fields||{})[tn]?.stringValue===en}function an(e){e=e.mapValue.fields[rn];return sn(e)?an(e):e}function on(e){e=Xr(e.mapValue.fields[nn].timestampValue);return new y(e.seconds,e.nanos)}class un{constructor(e,t,r,n,i,s,a,o,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=u,this.isUsingEmulator=h}}let hn="(default)";class ln{constructor(e,t){this.projectId=e,this.database=t||hn}static empty(){return new ln("","")}get isDefaultDatabase(){return this.database===hn}isEqual(e){return e instanceof ln&&e.projectId===this.projectId&&e.database===this.database}}let cn="__type__",dn="__max__",fn={mapValue:{fields:{__type__:{stringValue:dn}}}},gn="__vector__",mn="value",pn={nullValue:"NULL_VALUE"};function yn(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?sn(e)?4:Rn(e)?9007199254740991:Nn(e)?10:11:_(28295,{value:e})}function vn(e,t){if(e===t)return!0;var r,n,i,s,a,o=yn(e);if(o!==yn(t))return!1;switch(o){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return on(e).isEqual(on(t));case 3:return i=t,"string"==typeof(n=e).timestampValue&&"string"==typeof i.timestampValue&&n.timestampValue.length===i.timestampValue.length?n.timestampValue===i.timestampValue:(s=Xr(n.timestampValue),a=Xr(i.timestampValue),s.seconds===a.seconds&&s.nanos===a.nanos);case 5:return e.stringValue===t.stringValue;case 6:return n=t,Zr(e.bytesValue).isEqual(Zr(n.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return i=t,k((r=e).geoPointValue.latitude)===k(i.geoPointValue.latitude)&&k(r.geoPointValue.longitude)===k(i.geoPointValue.longitude);case 2:return r=t,"integerValue"in(h=e)&&"integerValue"in r?k(h.integerValue)===k(r.integerValue):"doubleValue"in h&&"doubleValue"in r&&((s=k(h.doubleValue))===(a=k(r.doubleValue))?It(s)===It(a):isNaN(s)&&isNaN(a));case 9:return Me(e.arrayValue.values||[],t.arrayValue.values||[],vn);case 10:case 11:var u,h=t,l=e.mapValue.fields||{},c=h.mapValue.fields||{};if(jr(l)!==jr(c))return!1;for(u in l)if(l.hasOwnProperty(u)&&(void 0===c[u]||!vn(l[u],c[u])))return!1;return!0;default:return _(52216,{left:e})}}function wn(e,t){return void 0!==(e.values||[]).find(e=>vn(e,t))}function _n(e,t){if(e===t)return 0;var r,n,i,s,a=yn(e),o=yn(t);if(a!==o)return b(a,o);switch(a){case 0:case 9007199254740991:return 0;case 1:return b(e.booleanValue,t.booleanValue);case 2:return i=t,(s=k((n=e).integerValue||n.doubleValue))<(g=k(i.integerValue||i.doubleValue))?-1:g<s?1:s===g?0:isNaN(s)?isNaN(g)?0:-1:1;case 3:return bn(e.timestampValue,t.timestampValue);case 4:return bn(on(e),on(t));case 5:return De(e.stringValue,t.stringValue);case 6:return n=e.bytesValue,i=t.bytesValue,s=Zr(n),g=Zr(i),s.compareTo(g);case 7:var u=e.referenceValue,h=t.referenceValue,l=u.split("/"),c=h.split("/");for(let e=0;e<l.length&&e<c.length;e++){var d=b(l[e],c[e]);if(0!==d)return d}return b(l.length,c.length);case 8:return u=e.geoPointValue,h=t.geoPointValue,0!==(r=b(k(u.latitude),k(h.latitude)))?r:b(k(u.longitude),k(h.longitude));case 9:return In(e.arrayValue,t.arrayValue);case 10:return f=e.mapValue,n=t.mapValue,r=f.fields||{},i=n.fields||{},r=r[mn]?.arrayValue,i=i[mn]?.arrayValue,0!==(s=b(r?.values?.length||0,i?.values?.length||0))?s:In(r,i);case 11:var f=e.mapValue,g=t.mapValue;if(f===fn.mapValue&&g===fn.mapValue)return 0;if(f===fn.mapValue)return 1;if(g===fn.mapValue)return-1;var m=f.fields||{},p=Object.keys(m),y=g.fields||{},v=Object.keys(y);p.sort(),v.sort();for(let e=0;e<p.length&&e<v.length;++e){var w=De(p[e],v[e]);if(0!==w)return w;w=_n(m[p[e]],y[v[e]]);if(0!==w)return w}return b(p.length,v.length);default:throw _(23264,{he:a})}}function bn(e,t){var r;return"string"==typeof e&&"string"==typeof t&&e.length===t.length?b(e,t):(e=Xr(e),t=Xr(t),0!==(r=b(e.seconds,t.seconds))?r:b(e.nanos,t.nanos))}function In(e,t){var r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){var i=_n(r[e],n[e]);if(i)return i}return b(r.length,n.length)}function Tn(e){return function n(i){{if("nullValue"in i)return"null";if("booleanValue"in i)return""+i.booleanValue;if("integerValue"in i)return""+i.integerValue;if("doubleValue"in i)return""+i.doubleValue;if("timestampValue"in i)return`time(${(t=Xr(i.timestampValue)).seconds},${t.nanos})`;if("stringValue"in i)return i.stringValue;if("bytesValue"in i)return Zr(i.bytesValue).toBase64();if("referenceValue"in i)return t=i.referenceValue,x.fromName(t).toString();if("geoPointValue"in i)return`geo(${(e=i.geoPointValue).latitude},${e.longitude})`;if("arrayValue"in i){let e="[",t=!0;for(var r of i.arrayValue.values||[])t?t=!1:e+=",",e+=n(r);return e+"]"}if("mapValue"in i){var s=i.mapValue,a;let e=Object.keys(s.fields||{}).sort(),t="{",r=!0;for(a of e)r?r=!1:t+=",",t+=a+":"+n(s.fields[a]);return t+"}"}return _(61005,{value:i})}var e,t}(e)}function En(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/`+t.path.canonicalString()}}function Sn(e){return e&&"integerValue"in e}function xn(e){return!!e&&"arrayValue"in e}function Cn(e){return e&&"nullValue"in e}function An(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Dn(e){return e&&"mapValue"in e}function Nn(e){return(e?.mapValue?.fields||{})[cn]?.stringValue===gn}function kn(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:{...t.timestampValue}};if(t.mapValue){let r={mapValue:{fields:{}}};return zr(t.mapValue.fields,(e,t)=>r.mapValue.fields[e]=kn(t)),r}if(t.arrayValue){var r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=kn(t.arrayValue.values[e]);return r}return{...t}}function Rn(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===dn}let Mn={mapValue:{fields:{[cn]:{stringValue:gn},[mn]:{arrayValue:{}}}}};function On(e,t){var r=_n(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Ln(e,t){var r=_n(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Pn{constructor(e){this.value=e}static empty(){return new Pn({mapValue:{}})}field(r){if(r.isEmpty())return this.value;{let t=this.value;for(let e=0;e<r.length-1;++e)if(!Dn(t=(t.mapValue.fields||{})[r.get(e)]))return null;return(t=(t.mapValue.fields||{})[r.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=kn(t)}setAll(e){let n=l.emptyPath(),i={},s=[];e.forEach((e,t)=>{var r;n.isImmediateParentOf(t)||(r=this.getFieldsMap(n),this.applyChanges(r,i,s),i={},s=[],n=t.popLast()),e?i[t.lastSegment()]=kn(e):s.push(t.lastSegment())});e=this.getFieldsMap(n);this.applyChanges(e,i,s)}delete(e){var t=this.field(e.popLast());Dn(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return vn(this.value,e.value)}getFieldsMap(r){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let t=0;t<r.length;++t){let e=n.mapValue.fields[r.get(t)];Dn(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[r.get(t)]=e),n=e}return n.mapValue.fields}applyChanges(r,e,t){zr(e,(e,t)=>r[e]=t);for(var n of t)delete r[n]}clone(){return new Pn(kn(this.value))}}class R{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new R(e,0,w.min(),w.min(),w.min(),Pn.empty(),0)}static newFoundDocument(e,t,r,n){return new R(e,1,t,w.min(),r,n,0)}static newNoDocument(e,t){return new R(e,2,t,w.min(),w.min(),Pn.empty(),0)}static newUnknownDocument(e,t){return new R(e,3,t,w.min(),w.min(),Pn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(w.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=w.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof R&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new R(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Vn{constructor(e,t){this.position=e,this.inclusive=t}}function Fn(t,r,n){let i=0;for(let e=0;e<t.position.length;e++){var s=r[e],a=t.position[e];if(i=s.field.isKeyField()?x.comparator(x.fromName(a.referenceValue),n.key):_n(a,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function Un(t,r){if(null===t)return null===r;if(null===r)return!1;if(t.inclusive!==r.inclusive||t.position.length!==r.position.length)return!1;for(let e=0;e<t.position.length;e++)if(!vn(t.position[e],r.position[e]))return!1;return!0}class Bn{constructor(e,t="asc"){this.field=e,this.dir=t}}class qn{}class M extends qn{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new Hn(e,t,r):"array-contains"===t?new Xn(e,r):"in"===t?new Zn(e,r):"not-in"===t?new ei(e,r):"array-contains-any"===t?new ti(e,r):new M(e,t,r)}static createKeyFieldInFilter(e,t,r){return new("in"===t?Wn:Yn)(e,r)}matches(e){e=e.data.field(this.field);return"!="===this.op?null!==e&&void 0===e.nullValue&&this.matchesComparison(_n(e,this.value)):null!==e&&yn(this.value)===yn(e)&&this.matchesComparison(_n(e,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return _(47266,{operator:this.op})}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class O extends qn{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new O(e,t)}matches(t){return jn(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null===this.Pe&&(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function jn(e){return"and"===e.op}function zn(e){return"or"===e.op}function Gn(e){return Kn(e)&&jn(e)}function Kn(e){for(var t of e.filters)if(t instanceof O)return!1;return!0}function Qn(e,t){t=e.filters.concat(t);return O.create(t,e.op)}function $n(e){return e instanceof M?`${(t=e).field.canonicalString()} ${t.op} `+Tn(t.value):e instanceof O?(t=e).op.toString()+" {"+t.getFilters().map($n).join(" ,")+"}":"Filter";var t}class Hn extends M{constructor(e,t,r){super(e,t,r),this.key=x.fromName(r.referenceValue)}matches(e){e=x.comparator(e.key,this.key);return this.matchesComparison(e)}}class Wn extends M{constructor(e,t){super(e,"in",t),this.keys=Jn(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Yn extends M{constructor(e,t){super(e,"not-in",t),this.keys=Jn(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Jn(e,t){return(t.arrayValue?.values||[]).map(e=>x.fromName(e.referenceValue))}class Xn extends M{constructor(e,t){super(e,"array-contains",t)}matches(e){e=e.data.field(this.field);return xn(e)&&wn(e.arrayValue,this.value)}}class Zn extends M{constructor(e,t){super(e,"in",t)}matches(e){e=e.data.field(this.field);return null!==e&&wn(this.value.arrayValue,e)}}class ei extends M{constructor(e,t){super(e,"not-in",t)}matches(e){return!wn(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&null!==(e=e.data.field(this.field))&&void 0===e.nullValue&&!wn(this.value.arrayValue,e)}}class ti extends M{constructor(e,t){super(e,"array-contains-any",t)}matches(e){e=e.data.field(this.field);return!(!xn(e)||!e.arrayValue.values)&&e.arrayValue.values.some(e=>wn(this.value.arrayValue,e))}}class ri{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function ni(e,t=null,r=[],n=[],i=null,s=null,a=null){return new ri(e,t,r,n,i,s,a)}function ii(t){if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e=(e=(e+="|f:")+t.filters.map(e=>function t(e){var r;return e instanceof M?e.field.canonicalString()+e.op.toString()+Tn(e.value):Gn(e)?e.filters.map(e=>t(e)).join(","):(r=e.filters.map(e=>t(e)).join(","),e.op+`(${r})`)}(e)).join(",")+"|ob:")+t.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),bt(t.limit)||(e=(e+="|l:")+t.limit),t.startAt&&(e=(e=(e+="|lb:")+(t.startAt.inclusive?"b:":"a:"))+t.startAt.position.map(e=>Tn(e)).join(",")),t.endAt&&(e=(e=(e+="|ub:")+(t.endAt.inclusive?"a:":"b:"))+t.endAt.position.map(e=>Tn(e)).join(",")),t.Te=e}return t.Te}function si(t,r){if(t.limit!==r.limit)return!1;if(t.orderBy.length!==r.orderBy.length)return!1;for(let e=0;e<t.orderBy.length;e++)if(n=t.orderBy[e],i=r.orderBy[e],n.dir!==i.dir||!n.field.isEqual(i.field))return!1;var n,i;if(t.filters.length!==r.filters.length)return!1;for(let e=0;e<t.filters.length;e++)if(!function n(e,t){return e instanceof M?(r=e,(s=t)instanceof M&&r.op===s.op&&r.field.isEqual(s.field)&&vn(r.value,s.value)):e instanceof O?(r=e,(i=t)instanceof O&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((e,t,r)=>e&&n(t,i.filters[r]),!0)):void _(19439);var i,r,s}(t.filters[e],r.filters[e]))return!1;return t.collectionGroup===r.collectionGroup&&!!t.path.isEqual(r.path)&&!!Un(t.startAt,r.startAt)&&Un(t.endAt,r.endAt)}function ai(e){return x.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function oi(e,t){return e.filters.filter(e=>e instanceof M&&e.field.isEqual(t))}function ui(t,r,n){let i=pn,s=!0;for(var a of oi(t,r)){let e=pn,t=!0;switch(a.op){case"<":case"<=":e="nullValue"in(o=a.value)?pn:"booleanValue"in o?{booleanValue:!1}:"integerValue"in o||"doubleValue"in o?{doubleValue:NaN}:"timestampValue"in o?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in o?{stringValue:""}:"bytesValue"in o?{bytesValue:""}:"referenceValue"in o?En(ln.empty(),x.empty()):"geoPointValue"in o?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in o?{arrayValue:{}}:"mapValue"in o?Nn(o)?Mn:{mapValue:{}}:_(35942,{value:o});break;case"==":case"in":case">=":e=a.value;break;case">":e=a.value,t=!1;break;case"!=":case"not-in":e=pn}On({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}var o;if(null!==n)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(r)){var u=n.position[e];On({value:i,inclusive:s},{value:u,inclusive:n.inclusive})<0&&(i=u,s=n.inclusive);break}return{value:i,inclusive:s}}function hi(t,r,n){let i=fn,s=!0;for(var a of oi(t,r)){let e=fn,t=!0;switch(a.op){case">=":case">":e="nullValue"in(o=a.value)?{booleanValue:!1}:"booleanValue"in o?{doubleValue:NaN}:"integerValue"in o||"doubleValue"in o?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in o?{stringValue:""}:"stringValue"in o?{bytesValue:""}:"bytesValue"in o?En(ln.empty(),x.empty()):"referenceValue"in o?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in o?{arrayValue:{}}:"arrayValue"in o?Mn:"mapValue"in o?Nn(o)?{mapValue:{}}:fn:_(61959,{value:o}),t=!1;break;case"==":case"in":case"<=":e=a.value;break;case"<":e=a.value,t=!1;break;case"!=":case"not-in":e=fn}0<Ln({value:i,inclusive:s},{value:e,inclusive:t})&&(i=e,s=t)}var o;if(null!==n)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(r)){var u=n.position[e];0<Ln({value:i,inclusive:s},{value:u,inclusive:n.inclusive})&&(i=u,s=n.inclusive);break}return{value:i,inclusive:s}}class li{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function ci(e,t,r,n,i,s,a,o){return new li(e,t,r,n,i,s,a,o)}function di(e){return new li(e)}function fi(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function gi(e){return null!==e.collectionGroup}function mi(e){let n=e;if(null===n.Ie){n.Ie=[];let t=new Set;for(var i of n.explicitOrderBy)n.Ie.push(i),t.add(i.field.canonicalString());let r=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc",e=(e=>{let t=new D(l.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(n);e.forEach(e=>{t.has(e.canonicalString())||e.isKeyField()||n.Ie.push(new Bn(e,r))}),t.has(l.keyField().canonicalString())||n.Ie.push(new Bn(l.keyField(),r))}return n.Ie}function pi(e){var t=e;return t.Ee||(t.Ee=((e,t)=>{if("F"===e.limitType)return ni(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);t=t.map(e=>{var t="desc"===e.dir?"asc":"desc";return new Bn(e.field,t)});var r=e.endAt?new Vn(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new Vn(e.startAt.position,e.startAt.inclusive):null;return ni(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)})(t,mi(e))),t.Ee}function yi(e,t,r){return new li(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function vi(e,t){return si(pi(e),pi(t))&&e.limitType===t.limitType}function wi(e){return ii(pi(e))+"|lt:"+e.limitType}function _i(e){return`Query(target=${(e=>{let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>$n(e)).join(", ")}]`),bt(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),e.startAt&&(t=(t=(t+=", startAt: ")+(e.startAt.inclusive?"b:":"a:"))+e.startAt.position.map(e=>Tn(e)).join(",")),`Target(${t=e.endAt?(t=(t+=", endAt: ")+(e.endAt.inclusive?"a:":"b:"))+e.endAt.position.map(e=>Tn(e)).join(","):t})`})(pi(e))}; limitType=${e.limitType})`}function bi(r,e){return e.isFoundDocument()&&(o=(a=e).key.path,null!==(s=r).collectionGroup?a.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(o):x.isDocumentKey(s.path)?s.path.isEqual(o):s.path.isImmediateParentOf(o))&&(e=>{for(var t of mi(r))if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1})(e)&&(e=>{for(var t of r.filters)if(!t.matches(e))return;return 1})(e)&&(a=e,!(s=r).startAt||(i=Fn(n=s.startAt,t=mi(s),a),n.inclusive?i<=0:i<0))&&(!s.endAt||(i=Fn(t=s.endAt,n=mi(s),a),t.inclusive?0<=i:0<i));var t,n,i,s,a,o}function Ii(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Ti(s){return(e,t)=>{let r=!1;for(var n of mi(s)){var i=((e,t,r)=>{var n,i=e.field.isKeyField()?x.comparator(t.key,r.key):(n=e.field,r=r,t=t.data.field(n),r=r.data.field(n),null!==t&&null!==r?_n(t,r):_(42886));switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return _(19790,{direction:e.dir})}})(n,e,t);if(0!==i)return i;r=r||n.field.isKeyField()}return 0}}class Ei{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){var t=this.mapKeyFn(e),t=this.inner[t];if(void 0!==t)for(var[r,n]of t)if(this.equalsFn(r,e))return n}has(e){return void 0!==this.get(e)}set(t,r){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)this.inner[e]=[[t,r]];else{for(let e=0;e<n.length;e++)if(this.equalsFn(n[e][0],t))return void(n[e]=[t,r]);n.push([t,r])}this.innerSize++}delete(t){var r=this.mapKeyFn(t),n=this.inner[r];if(void 0!==n)for(let e=0;e<n.length;e++)if(this.equalsFn(n[e][0],t))return 1===n.length?delete this.inner[r]:n.splice(e,1),this.innerSize--,!0;return!1}forEach(i){zr(this.inner,(e,t)=>{for(var[r,n]of t)i(r,n)})}isEmpty(){return Gr(this.inner)}size(){return this.innerSize}}let Si=new A(x.comparator),xi=new A(x.comparator);function Ci(...e){let t=xi;for(var r of e)t=t.insert(r.key,r);return t}function Ai(e){let r=xi;return e.forEach((e,t)=>r=r.insert(e,t.overlayedDocument)),r}function Di(){return new Ei(e=>e.toString(),(e,t)=>e.isEqual(t))}let Ni=new A(x.comparator),ki=new D(x.comparator);function L(...e){let t=ki;for(var r of e)t=t.add(r);return t}let Ri=new D(b);function Mi(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:It(t)?"-0":t}}function Oi(e){return{integerValue:""+e}}function Li(e,t){return Tt(t)?Oi(t):Mi(e,t)}class Pi{constructor(){this._=void 0}}function Vi(e,t){return e instanceof zi?Sn(e=t)||e&&"doubleValue"in e?t:{integerValue:0}:null}class Fi extends Pi{}class Ui extends Pi{constructor(e){super(),this.elements=e}}function Bi(e,t){var r=Ki(t);for(let t of e.elements)r.some(e=>vn(e,t))||r.push(t);return{arrayValue:{values:r}}}class qi extends Pi{constructor(e){super(),this.elements=e}}function ji(e,t){let r=Ki(t);for(let t of e.elements)r=r.filter(e=>!vn(e,t));return{arrayValue:{values:r}}}class zi extends Pi{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Gi(e){return k(e.integerValue||e.doubleValue)}function Ki(e){return xn(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Qi{constructor(e,t){this.field=e,this.transform=t}}class $i{constructor(e,t){this.version=e,this.transformResults=t}}class P{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new P}static exists(e){return new P(void 0,e)}static updateTime(e){return new P(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Hi(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Wi{}function Yi(e,r){if(!e.hasLocalMutations||r&&0===r.fields.length)return null;if(null===r)return e.isNoDocument()?new is(e.key,P.none()):new Zi(e.key,e.data,P.none());{var n,i=e.data,s=Pn.empty();let t=new D(l.comparator);for(n of r.fields)if(!t.has(n)){let e=i.field(n);null===e&&1<n.length&&(n=n.popLast(),e=i.field(n)),null===e?s.delete(n):s.set(n,e),t=t.add(n)}return new es(e.key,s,new Wr(t.toArray()),P.none())}}function Ji(e,t,r,n){return e instanceof Zi?(s=t,a=r,o=n,Hi((i=e).precondition,s)?(u=i.value.clone(),h=ns(i.fieldTransforms,o,s),u.setAll(h),s.convertToFoundDocument(s.version,u).setHasLocalMutations(),null):a):e instanceof es?(i=t,o=r,s=n,Hi((a=e).precondition,i)?(h=ns(a.fieldTransforms,s,i),(u=i.data).setAll(ts(a)),u.setAll(h),i.convertToFoundDocument(i.version,u).setHasLocalMutations(),null===o?null:o.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(e=>e.field))):o):(n=t,t=r,Hi(e.precondition,n)?(n.convertToNoDocument(n.version).setHasLocalMutations(),null):t);var i,s,a,o,u,h}function Xi(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||r&&n&&Me(r,n,(e,t)=>e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof Ui&&t instanceof Ui||e instanceof qi&&t instanceof qi?Me(e.elements,t.elements,vn):e instanceof zi&&t instanceof zi?vn(e.Ae,t.Ae):e instanceof Fi&&t instanceof Fi))))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask));var r,n}class Zi extends Wi{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class es extends Wi{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ts(r){let n=new Map;return r.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=r.data.field(e),n.set(e,t))}),n}function rs(t,r,n){var i=new Map;v(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let e=0;e<n.length;e++){var s=t[e],a=s.transform,o=r.data.field(s.field);i.set(s.field,(s=a,a=o,o=n[e],s instanceof Ui?Bi(s,a):s instanceof qi?ji(s,a):o))}return i}function ns(e,t,r){var n,i,s,a,o=new Map;for(n of e){var u=n.transform,h=r.data.field(n.field);o.set(n.field,(h=h,i=t,a=s=void 0,(u=u)instanceof Fi?(s=h,a={fields:{[tn]:{stringValue:en},[nn]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}},(s=s&&sn(s)?an(s):s)&&(a.fields[rn]=s),{mapValue:a}):u instanceof Ui?Bi(u,h):u instanceof qi?ji(u,h):(s=Gi(a=Vi(i=u,h))+Gi(i.Ae),Sn(a)&&Sn(i.Ae)?Oi(s):Mi(i.serializer,s))))}return o}class is extends Wi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ss extends Wi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class as{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(t,e){var r,n,i,s,a,o,u,h=e.mutationResults;for(let e=0;e<this.mutations.length;e++){var l=this.mutations[e];l.key.isEqual(t.key)&&(r=l,n=t,i=h[e],u=l=o=a=s=void 0,r instanceof Zi?(a=n,o=i,l=(s=r).value.clone(),u=rs(s.fieldTransforms,a,o.transformResults),l.setAll(u),a.convertToFoundDocument(o.version,l).setHasCommittedMutations()):r instanceof es?(s=n,a=i,Hi((o=r).precondition,s)?(u=rs(o.fieldTransforms,s,a.transformResults),(l=s.data).setAll(ts(o)),l.setAll(u),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()):s.convertToUnknownDocument(a.version)):n.convertToNoDocument(i.version).setHasCommittedMutations())}}applyToLocalView(e,t){for(var r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ji(r,e,t,this.localWriteTime));for(var n of this.mutations)n.key.isEqual(e.key)&&(t=Ji(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(n,i){let s=Di();return this.mutations.forEach(e=>{var t=(r=n.get(e.key)).overlayedDocument,r=this.applyToLocalView(t,r.mutatedFields);null!==(r=Yi(t,i.has(e.key)?null:r))&&s.set(e.key,r),t.isValidDocument()||t.convertToNoDocument(w.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),L())}isEqual(e){return this.batchId===e.batchId&&Me(this.mutations,e.mutations,(e,t)=>Xi(e,t))&&Me(this.baseMutations,e.baseMutations,(e,t)=>Xi(e,t))}}class os{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){v(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=Ni;var i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new os(e,t,r,n)}}class us{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class hs{constructor(e,t){this.count=e,this.unchangedNames=t}}function ls(e){switch(e){case T.OK:return _(64938),0;case T.CANCELLED:case T.UNKNOWN:case T.DEADLINE_EXCEEDED:case T.RESOURCE_EXHAUSTED:case T.INTERNAL:case T.UNAVAILABLE:case T.UNAUTHENTICATED:return;case T.INVALID_ARGUMENT:case T.NOT_FOUND:case T.ALREADY_EXISTS:case T.PERMISSION_DENIED:case T.FAILED_PRECONDITION:case T.ABORTED:case T.OUT_OF_RANGE:case T.UNIMPLEMENTED:case T.DATA_LOSS:return 1;default:return _(15467,{code:e}),0}}function cs(e){if(void 0===e)return d("GRPC error has no .code"),T.UNKNOWN;switch(e){case g.OK:return T.OK;case g.CANCELLED:return T.CANCELLED;case g.UNKNOWN:return T.UNKNOWN;case g.DEADLINE_EXCEEDED:return T.DEADLINE_EXCEEDED;case g.RESOURCE_EXHAUSTED:return T.RESOURCE_EXHAUSTED;case g.INTERNAL:return T.INTERNAL;case g.UNAVAILABLE:return T.UNAVAILABLE;case g.UNAUTHENTICATED:return T.UNAUTHENTICATED;case g.INVALID_ARGUMENT:return T.INVALID_ARGUMENT;case g.NOT_FOUND:return T.NOT_FOUND;case g.ALREADY_EXISTS:return T.ALREADY_EXISTS;case g.PERMISSION_DENIED:return T.PERMISSION_DENIED;case g.FAILED_PRECONDITION:return T.FAILED_PRECONDITION;case g.ABORTED:return T.ABORTED;case g.OUT_OF_RANGE:return T.OUT_OF_RANGE;case g.UNIMPLEMENTED:return T.UNIMPLEMENTED;case g.DATA_LOSS:return T.DATA_LOSS;default:return _(39323,{code:e})}}function ds(){return new TextEncoder}de=g={OK:0,0:"OK",CANCELLED:1,1:"CANCELLED",UNKNOWN:2,2:"UNKNOWN",INVALID_ARGUMENT:3,3:"INVALID_ARGUMENT",DEADLINE_EXCEEDED:4,4:"DEADLINE_EXCEEDED",NOT_FOUND:5,5:"NOT_FOUND",ALREADY_EXISTS:6,6:"ALREADY_EXISTS",PERMISSION_DENIED:7,7:"PERMISSION_DENIED",UNAUTHENTICATED:16,16:"UNAUTHENTICATED",RESOURCE_EXHAUSTED:8,8:"RESOURCE_EXHAUSTED",FAILED_PRECONDITION:9,9:"FAILED_PRECONDITION",ABORTED:10,10:"ABORTED",OUT_OF_RANGE:11,11:"OUT_OF_RANGE",UNIMPLEMENTED:12,12:"UNIMPLEMENTED",INTERNAL:13,13:"INTERNAL",UNAVAILABLE:14,14:"UNAVAILABLE",DATA_LOSS:15,15:"DATA_LOSS"};let fs=new he([4294967295,4294967295],0);function gs(e){var e=ds().encode(e),t=new le;return t.update(e),new Uint8Array(t.digest())}function ms(e){var t=(e=new DataView(e.buffer)).getUint32(0,!0),r=e.getUint32(4,!0),n=e.getUint32(8,!0),e=e.getUint32(12,!0);return[new he([t,r],0),new he([n,e],0)]}class ps{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||8<=t)throw new ys("Invalid padding: "+t);if(r<0)throw new ys("Invalid hash count: "+r);if(0<e.length&&0===this.hashCount)throw new ys("Invalid hash count: "+r);if(0===e.length&&0!==t)throw new ys("Invalid padding when bitmap length is 0: "+t);this.ge=8*e.length-t,this.pe=he.fromNumber(this.ge)}ye(e,t,r){let n=e.add(t.multiply(he.fromNumber(r)));return(n=1===n.compare(fs)?new he([n.getBits(0),n.getBits(1)],0):n).modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;var[t,r]=ms(gs(e));for(let e=0;e<this.hashCount;e++){var n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new ps(i,n,t);return r.forEach(e=>s.insert(e)),s}insert(e){if(0!==this.ge){var[t,r]=ms(gs(e));for(let e=0;e<this.hashCount;e++){var n=this.ye(t,r,e);this.Se(n)}}}Se(e){var t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class ys extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class vs{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){var n=new Map;return n.set(e,ws.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new vs(w.min(),n,new A(b),Si,L())}}class ws{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new ws(r,t,L(),L(),L())}}class _s{constructor(e,t,r,n){this.be=e,this.removedTargetIds=t,this.key=r,this.De=n}}class bs{constructor(e,t){this.targetId=e,this.Ce=t}}class Is{constructor(e,t,r=N.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class Ts{constructor(){this.ve=0,this.Fe=xs(),this.Me=N.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){0<e.approximateByteSize()&&(this.Oe=!0,this.Me=e)}ke(){let r=L(),n=L(),i=L();return this.Fe.forEach((e,t)=>{switch(t){case 0:r=r.add(e);break;case 2:n=n.add(e);break;case 1:i=i.add(e);break;default:_(38017,{changeType:t})}}),new ws(this.Me,this.xe,r,n,i)}qe(){this.Oe=!1,this.Fe=xs()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){--this.ve,v(0<=this.ve,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Es{constructor(e){this.Ge=e,this.ze=new Map,this.je=Si,this.Je=Ss(),this.He=Ss(),this.Ye=new A(b)}Ze(e){for(var t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(var r of e.removedTargetIds)this.et(r,e.key,e.De)}tt(r){this.forEachTarget(r,e=>{var t=this.nt(e);switch(r.state){case 0:this.rt(e)&&t.Le(r.resumeToken);break;case 1:t.Ke(),t.Ne||t.qe(),t.Le(r.resumeToken);break;case 2:t.Ke(),t.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(t.We(),t.Le(r.resumeToken));break;case 4:this.rt(e)&&(this.it(e),t.Le(r.resumeToken));break;default:_(56790,{state:r.state})}})}forEachTarget(e,r){0<e.targetIds.length?e.targetIds.forEach(r):this.ze.forEach((e,t)=>{this.rt(t)&&r(t)})}st(e){var t=e.targetId,r=e.Ce.count,n=this.ot(t);n&&(ai(n=n.target)?0===r?(n=new x(n.path),this.et(t,n,R.newNoDocument(n,w.min()))):v(1===r,20013,{expectedCount:r}):(n=this._t(t))!==r&&0!==(r=(r=this.ut(e))?this.ct(r,e,n):1)&&(this.it(t),this.Ye=this.Ye.insert(t,2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")))}ut(e){if(!(t=e.Ce.unchangedNames)||!t.bits)return null;var{bits:{bitmap:t="",padding:r=0},hashCount:n=0}=t;let i,s;try{i=Zr(t).toUint8Array()}catch(e){if(e instanceof Yr)return ye("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{s=new ps(i,r,n)}catch(e){return ye(e instanceof ys?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===s.ge?null:s}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(r,n){var e=this.Ge.getRemoteKeysForTarget(n);let i=0;return e.forEach(e=>{var t=`projects/${(t=this.Ge.ht()).projectId}/databases/${t.database}/documents/`+e.path.canonicalString();r.mightContain(t)||(this.et(n,e,null),i++)}),i}Tt(n){let i=new Map,s=(this.ze.forEach((e,t)=>{var r=this.ot(t);r&&(e.current&&ai(r.target)&&(r=new x(r.target.path),this.It(r).has(t)||this.Et(t,r)||this.et(t,r,R.newNoDocument(r,n))),e.Be&&(i.set(t,e.ke()),e.qe()))}),L());this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{e=this.ot(e);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1)}),r&&(s=s.add(e))}),this.je.forEach((e,t)=>t.setReadTime(n));var e=new vs(n,i,this.Ye,this.je,s);return this.je=Si,this.Je=Ss(),this.He=Ss(),this.Ye=new A(b),e}Xe(e,t){var r;this.rt(e)&&(r=this.Et(e,t.key)?2:0,this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e)))}et(e,t,r){var n;this.rt(e)&&(n=this.nt(e),this.Et(e,t)?n.Qe(t,1):n.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r)&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){var t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Ts,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new D(b),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new D(b),this.Je=this.Je.insert(e,t)),t}rt(e){var t=null!==this.ot(e);return t||m("WatchChangeAggregator","Detected inactive target",e),t}ot(e){var t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(t){this.ze.set(t,new Ts),this.Ge.getRemoteKeysForTarget(t).forEach(e=>{this.et(t,e,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ss(){return new A(x.comparator)}function xs(){return new A(x.comparator)}let Cs={asc:"ASCENDING",desc:"DESCENDING"},As={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ds={and:"AND",or:"OR"};class Ns{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ks(e,t){return e.useProto3Json||bt(t)?t:{value:t}}function Rs(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ms(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function V(e){return v(!!e,49232),w.fromTimestamp((e=Xr(e),new y(e.seconds,e.nanos)))}function Os(e,t){return Ls(e,t).canonicalString()}function Ls(e,t){e=new S(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?e:e.child(t)}function Ps(e){e=S.fromString(e);return v(Xs(e),10190,{key:e.toString()}),e}function Vs(e,t){return Os(e.databaseId,t.path)}function Fs(e,t){t=Ps(t);if(t.get(1)!==e.databaseId.projectId)throw new E(T.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+e.databaseId.projectId);if(t.get(3)!==e.databaseId.database)throw new E(T.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+e.databaseId.database);return new x(js(t))}function Us(e,t){return Os(e.databaseId,t)}function Bs(e){e=Ps(e);return 4===e.length?S.emptyPath():js(e)}function qs(e){return new S(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function js(e){return v(4<e.length&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function zs(e,t,r){return{name:Vs(e,t),fields:r.value.mapValue.fields}}function Gs(e,t,r){var e=Fs(e,t.name),n=V(t.updateTime),i=t.createTime?V(t.createTime):w.min(),t=new Pn({mapValue:{fields:t.fields}}),e=R.newFoundDocument(e,n,i,t);return r&&e.setHasCommittedMutations(),r?e.setHasCommittedMutations():e}function Ks(e,t){let r;if(t instanceof Zi)r={update:zs(e,t.key,t.value)};else if(t instanceof is)r={delete:Vs(e,t.key)};else if(t instanceof es)r={update:zs(e,t.key,t.data),updateMask:(e=>{let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}})(t.fieldMask)};else{if(!(t instanceof ss))return _(16599,{Vt:t.type});r={verify:Vs(e,t.key)}}return 0<t.fieldTransforms.length&&(r.updateTransforms=t.fieldTransforms.map(e=>{var t=e.transform;if(t instanceof Fi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Ui)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof qi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof zi)return{fieldPath:e.field.canonicalString(),increment:t.Ae};throw _(20930,{transform:e.transform})})),t.precondition.isNone||(r.currentDocument=void 0!==(t=t.precondition).updateTime?{updateTime:Rs(e,t.updateTime.toTimestamp())}:void 0!==t.exists?{exists:t.exists}:_(27497)),r}function Qs(i,e){var t,r,n,s=e.currentDocument?void 0!==(r=e.currentDocument).updateTime?P.updateTime(V(r.updateTime)):void 0!==r.exists?P.exists(r.exists):P.none():P.none(),a=e.updateTransforms?e.updateTransforms.map(t=>{{var r=i;let e=null;"setToServerValue"in t?(v("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),e=new Fi):"appendMissingElements"in t?(n=t.appendMissingElements.values||[],e=new Ui(n)):"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],e=new qi(n)):"increment"in t?e=new zi(r,t.increment):_(16584,{proto:t});var n=l.fromServerFormat(t.fieldPath);return new Qi(n,e)}}):[];return e.update?(e.update.name,n=Fs(i,e.update.name),t=new Pn({mapValue:{fields:e.update.fields}}),e.updateMask?(r=(r=e.updateMask).fieldPaths||[],r=new Wr(r.map(e=>l.fromServerFormat(e))),new es(n,t,r,s,a)):new Zi(n,t,s,a)):e.delete?(r=Fs(i,e.delete),new is(r,s)):e.verify?(n=Fs(i,e.verify),new ss(n,s)):_(1463,{proto:e})}function $s(e,t){return{documents:[Us(e,t.path)]}}function Hs(e,t){var r={structuredQuery:{}},n=t.path;let i;return null!==t.collectionGroup?(i=n,r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),r.structuredQuery.from=[{collectionId:n.lastSegment()}]),r.parent=Us(e,i),(n=(e=>{if(0!==e.length)return function t(e){if(e instanceof M){var r=e;if("=="===r.op){if(An(r.value))return{unaryFilter:{field:Ys(r.field),op:"IS_NAN"}};if(Cn(r.value))return{unaryFilter:{field:Ys(r.field),op:"IS_NULL"}}}else if("!="===r.op){if(An(r.value))return{unaryFilter:{field:Ys(r.field),op:"IS_NOT_NAN"}};if(Cn(r.value))return{unaryFilter:{field:Ys(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ys(r.field),op:(n=r.op,As[n]),value:r.value}}}return e instanceof O?1===(r=(n=e).getFilters().map(e=>t(e))).length?r[0]:{compositeFilter:{op:(n=n.op,Ds[n]),filters:r}}:_(54877,{filter:e});var n}(O.create(e,"and"))})(t.filters))&&(r.structuredQuery.where=n),(n=(e=>{if(0!==e.length)return e.map(e=>({field:Ys(e.field),direction:(e=e.dir,Cs[e])}))})(t.orderBy))&&(r.structuredQuery.orderBy=n),null!==(n=ks(e,t.limit))&&(r.structuredQuery.limit=n),t.startAt&&(r.structuredQuery.startAt={before:(e=t.startAt).inclusive,values:e.position}),t.endAt&&(r.structuredQuery.endAt={before:!(e=t.endAt).inclusive,values:e.position}),{ft:r,parent:i}}function Ws(e){let t=Bs(e.parent);var r,n,i=e.structuredQuery,s=i.from?i.from.length:0;let a=null,o=(0<s&&(v(1===s,65062),(n=i.from[0]).allDescendants?a=n.collectionId:t=t.child(n.collectionId)),[]),u=(i.where&&(o=(s=function t(e){if(void 0!==e.unaryFilter){var r=e;switch(r.unaryFilter.op){case"IS_NAN":var n=Js(r.unaryFilter.field);return M.create(n,"==",{doubleValue:NaN});case"IS_NULL":n=Js(r.unaryFilter.field);return M.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":n=Js(r.unaryFilter.field);return M.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=Js(r.unaryFilter.field);return M.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return _(61313);default:return _(60726)}}else{return void 0!==e.fieldFilter?(s=e,M.create(Js(s.fieldFilter.field),(()=>{switch(s.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return _(58110);default:return _(50506)}})(),s.fieldFilter.value)):void 0!==e.compositeFilter?(i=e,O.create(i.compositeFilter.filters.map(e=>t(e)),(()=>{switch(i.compositeFilter.op){case"AND":return"and";case"OR":return"or";default:return _(1026)}})())):_(30097,{filter:e});var i,s}}(e=i.where))instanceof O&&Gn(s)?s.getFilters():[s]),[]),h=(i.orderBy&&(u=i.orderBy.map(e=>new Bn(Js(e.field),(()=>{switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})()))),null),l=(i.limit&&(h=bt(s="object"==typeof(e=i.limit)?e.value:e)?null:s),null),c=(i.startAt&&(l=(s=!!(e=i.startAt).before,r=e.values||[],new Vn(r,s))),null);return i.endAt&&(c=(r=!(e=i.endAt).before,s=e.values||[],new Vn(s,r))),ci(t,a,u,o,h,"F",l,c)}function Ys(e){return{fieldPath:e.canonicalString()}}function Js(e){return l.fromServerFormat(e.fieldPath)}function Xs(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}class Zs{constructor(e,t,r,n,i=w.min(),s=w.min(),a=N.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new Zs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Zs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Zs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Zs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ea{constructor(e){this.yt=e}}function ta(e,t){var r,n=t.key,i={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:ra(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())i.document={name:Vs(e=e.yt,(r=t).key),fields:r.data.value.mapValue.fields,updateTime:Rs(e,r.version.toTimestamp()),createTime:Rs(e,r.createTime.toTimestamp())};else if(t.isNoDocument())i.noDocument={path:n.path.toArray(),readTime:na(t.version)};else{if(!t.isUnknownDocument())return _(57904,{document:t});i.unknownDocument={path:n.path.toArray(),version:na(t.version)}}return i}function ra(e){e=e.toTimestamp();return[e.seconds,e.nanoseconds]}function na(e){e=e.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ia(e){e=new y(e.seconds,e.nanoseconds);return w.fromTimestamp(e)}function sa(t,r){var n,e=(r.baseMutations||[]).map(e=>Qs(t.yt,e));for(let t=0;t<r.mutations.length-1;++t){let e=r.mutations[t];t+1<r.mutations.length&&void 0!==r.mutations[t+1].transform&&(n=r.mutations[t+1],e.updateTransforms=n.transform.fieldTransforms,r.mutations.splice(t+1,1),++t)}var i=r.mutations.map(e=>Qs(t.yt,e)),s=y.fromMillis(r.localWriteTimeMs);return new as(r.batchId,s,e,i)}function aa(e){var t,r=ia(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?ia(e.lastLimboFreeSnapshotVersion):w.min(),i=void 0!==e.query.documents?(v(1===(i=(t=e.query).documents.length),1966,{count:i}),pi(di(Bs(t.documents[0])))):pi(Ws(e.query));return new Zs(i,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,N.fromBase64String(e.resumeToken))}function oa(e,t){var r=na(t.snapshotVersion),n=na(t.lastLimboFreeSnapshotVersion),e=ai(t.target)?$s(e.yt,t.target):Hs(e.yt,t.target).ft,i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:ii(t.target),readTime:r,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:e}}function ua(e){var t=Ws({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?yi(t,t.limit,"L"):t}function ha(e,t){return new us(t.largestBatchId,Qs(e.yt,t.overlayMutation))}function la(e,t){var r=t.path.lastSegment();return[e,o(t.path.popLast()),r]}function ca(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:na(n.readTime),documentKey:o(n.documentKey.path),largestBatchId:n.largestBatchId}}class da{getBundleMetadata(e,t){return fa(e).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:ia(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return fa(e).put({bundleId:(e=t).id,createTime:na(V(e.createTime)),version:e.version})}getNamedQuery(e,t){return ga(e).get(t).next(e=>{if(e)return{name:e.name,query:ua(e.bundledQuery),readTime:ia(e.readTime)}})}saveNamedQuery(e,t){return ga(e).put({name:(e=t).name,readTime:na(V(e.readTime)),bundledQuery:e.bundledQuery})}}function fa(e){return r(e,gr)}function ga(e){return r(e,mr)}class ma{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){t=t.uid||"";return new ma(e,t)}getOverlay(e,t){return pa(e).get(la(this.userId,t)).next(e=>e?ha(this.serializer,e):null)}getOverlays(e,t){let r=Di();return C.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(r,n,e){let i=[];return e.forEach((e,t)=>{t=new us(n,t);i.push(this.St(r,t))}),C.waitFor(i)}removeOverlaysForBatchId(t,e,r){let n=new Set,i=(e.forEach(e=>n.add(o(e.getCollectionPath()))),[]);return n.forEach(e=>{e=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,r+1],!1,!0);i.push(pa(t).Z(Ar,e))}),C.waitFor(i)}getOverlaysForCollection(e,t,r){let n=Di(),i=o(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return pa(e).J(Ar,s).next(e=>{for(var t of e){let e=ha(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i=Di(),s;r=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return pa(e).ee({index:Nr,range:r},(e,t,r)=>{t=ha(this.serializer,t);i.size()<n||t.largestBatchId===s?(i.set(t.getKey(),t),s=t.largestBatchId):r.done()}).next(()=>i)}St(e,t){return pa(e).put(((e,t,r)=>{var[,n,i]=la(t,r.mutation.key);return{userId:t,collectionPath:n,documentId:i,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:Ks(e.yt,r.mutation)}})(this.serializer,this.userId,t))}}function pa(e){return r(e,xr)}class ya{bt(e){return r(e,Rr)}getSessionToken(e){return this.bt(e).get("sessionToken").next(e=>{e=e?.value;return e?N.fromUint8Array(e):N.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class va{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(t,r){if("nullValue"in t)this.Ft(r,5);else if("booleanValue"in t)this.Ft(r,10),r.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(r,15),r.Mt(k(t.integerValue));else if("doubleValue"in t){var e=k(t.doubleValue);isNaN(e)?this.Ft(r,13):(this.Ft(r,15),It(e)?r.Mt(0):r.Mt(e))}else if("timestampValue"in t){let e=t.timestampValue;this.Ft(r,20),"string"==typeof e&&(e=Xr(e)),r.xt(""+(e.seconds||"")),r.Mt(e.nanos||0)}else"stringValue"in t?(this.Ot(t.stringValue,r),this.Nt(r)):"bytesValue"in t?(this.Ft(r,30),r.Bt(Zr(t.bytesValue)),this.Nt(r)):"referenceValue"in t?this.Lt(t.referenceValue,r):"geoPointValue"in t?(e=t.geoPointValue,this.Ft(r,45),r.Mt(e.latitude||0),r.Mt(e.longitude||0)):"mapValue"in t?Rn(t)?this.Ft(r,Number.MAX_SAFE_INTEGER):Nn(t)?this.kt(t.mapValue,r):(this.qt(t.mapValue,r),this.Nt(r)):"arrayValue"in t?(this.Qt(t.arrayValue,r),this.Nt(r)):_(19022,{$t:t})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){var r,n=e.fields||{};this.Ft(t,55);for(r of Object.keys(n))this.Ot(r,t),this.Ct(n[r],t)}kt(e,t){var e=e.fields||{},r=(this.Ft(t,53),mn),n=e[r].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(k(n)),this.Ot(r,t),this.Ct(e[r],t)}Qt(e,t){var r,e=e.values||[];this.Ft(t,50);for(r of e)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),x.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function wa(e){e=64-(t=>{let r=0;for(let e=0;e<8;++e){var n=(e=>{if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t})(255&t[e]);if(r+=n,8!==n)break}return r})(e);return Math.ceil(e/8)}va.Kt=new va;class _a{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){var t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){var t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(var t of e){var r=t.charCodeAt(0);r<128?this.Gt(r):r<2048?(this.Gt(960|r>>>6),this.Gt(128|63&r)):t<"\ud800"||"\udbff"<t?(this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r)):(r=t.codePointAt(0),this.Gt(240|r>>>18),this.Gt(128|63&r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r))}this.zt()}Zt(e){for(var t of e){var r=t.charCodeAt(0);r<128?this.Jt(r):r<2048?(this.Jt(960|r>>>6),this.Jt(128|63&r)):t<"\ud800"||"\udbff"<t?(this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r)):(r=t.codePointAt(0),this.Jt(240|r>>>18),this.Jt(128|63&r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r))}this.Ht()}Xt(t){var r=this.en(t),t=wa(r);this.tn(1+t),this.buffer[this.position++]=255&t;for(let e=r.length-t;e<r.length;++e)this.buffer[this.position++]=255&r[e]}nn(t){var r=this.en(t),t=wa(r);this.tn(1+t),this.buffer[this.position++]=~(255&t);for(let e=r.length-t;e<r.length;++e)this.buffer[this.position++]=~(255&r[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){(t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1);var t,r=new Uint8Array(t.buffer),n=!!(128&r[0]);r[0]^=n?255:128;for(let e=1;e<r.length;++e)r[e]^=n?255:0;return r}Gt(e){e&=255;0==e?(this.sn(0),this.sn(255)):255==e?(this.sn(255),this.sn(0)):this.sn(e)}Jt(e){var t=255&e;0==t?(this.an(0),this.an(255)):255==t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(t){t+=this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t),(t=new Uint8Array(e)).set(this.buffer),this.buffer=t}}}class ba{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class Ia{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Ta{constructor(){this.cn=new _a,this.ln=new ba(this.cn),this.hn=new Ia(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return 0===e?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}class Ea{constructor(e,t,r,n){this.Tn=e,this.In=t,this.En=r,this.dn=n}An(){var e=this.dn.length,t=0===e||255===this.dn[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new Ea(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:Ca(this.En),directionalValue:Ca(this.dn),orderedDocumentKey:Ca(t),documentKey:r.path.toArray()}}Vn(e,t,r){e=this.Rn(e,t,r);return[e.indexId,e.uid,e.arrayValue,e.directionalValue,e.orderedDocumentKey,e.documentKey]}}function Sa(e,t){var r=e.Tn-t.Tn;return 0!=r||0!==(r=xa(e.En,t.En))||0!==(r=xa(e.dn,t.dn))?r:x.comparator(e.In,t.In)}function xa(t,r){for(let e=0;e<t.length&&e<r.length;++e){var n=t[e]-r[e];if(0!=n)return n}return t.length-r.length}function Ca(e){if(X()){var r=e;let t="";for(let e=0;e<r.length;e++)t+=String.fromCharCode(r[e]);return t}return e}function Aa(e){if("string"!=typeof e)return e;var t=e,r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}class Da{constructor(e){this.mn=new D((e,t)=>l.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(var t of e.filters){let e=t;e.isInequality()?this.mn=this.mn.add(e):this.gn.push(e)}}get pn(){return 1<this.mn.size}yn(e){if(v(e.collectionGroup===this.collectionId,49279),this.pn)return!1;var t=He(e);if(void 0!==t&&!this.wn(t))return!1;var r=We(e);let n=new Set,i=0,s=0;for(;i<r.length&&this.wn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i!==r.length){if(0<this.mn.size){let e=this.mn.getIterator().getNext();if(!n.has(e.field.canonicalString())){t=r[i];if(!this.Sn(e,t)||!this.bn(this.fn[s++],t))return!1}++i}for(;i<r.length;++i){var a=r[i];if(s>=this.fn.length||!this.bn(this.fn[s++],a))return!1}}return!0}Dn(){if(this.pn)return null;let e=new D(l.comparator);var t,r,n=[];for(t of this.gn)t.field.isKeyField()||("array-contains"===t.op||"array-contains-any"===t.op?n.push(new Ye(t.field,2)):e.has(t.field)||(e=e.add(t.field),n.push(new Ye(t.field,0))));for(r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new Ye(r.field,"asc"===r.dir?0:1)));return new $e($e.UNKNOWN_ID,this.collectionId,n,Je.empty())}wn(e){for(var t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&(e="array-contains"===e.op||"array-contains-any"===e.op,2===t.kind==e)}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Na(e){return e instanceof M}function ka(e){return e instanceof O&&Gn(e)}function Ra(e){return Na(e)||ka(e)||(e=>{if(e instanceof O&&zn(e)){for(var t of e.getFilters())if(!Na(t)&&!ka(t))return!1;return!0}return!1})(e)}function Ma(e,t){var r,n;return v(e instanceof M||e instanceof O,38388),v(t instanceof M||t instanceof O,25473),La(e instanceof M?t instanceof M?(r=e,n=t,O.create([r,n],"and")):Oa(e,t):t instanceof M?Oa(t,e):((e,t)=>{if(v(0<e.filters.length&&0<t.filters.length,48005),jn(e)&&jn(t))return Qn(e,t.getFilters());let r=zn(e)?e:t,n=zn(e)?t:e,i=r.filters.map(e=>Ma(e,n));return O.create(i,"or")})(e,t))}function Oa(t,e){return jn(e)?Qn(e,t.getFilters()):(e=e.filters.map(e=>Ma(t,e)),O.create(e,"or"))}function La(t){if(v(t instanceof M||t instanceof O,11850),t instanceof M)return t;var e=t.getFilters();if(1===e.length)return La(e[0]);if(Kn(t))return t;let r=e.map(e=>La(e)),n=[];return r.forEach(e=>{e instanceof M?n.push(e):e instanceof O&&(e.op===t.op?n.push(...e.filters):n.push(e))}),1===n.length?n[0]:O.create(n,t.op)}class Pa{constructor(){this.Cn=new Va}addToCollectionParentIndex(e,t){return this.Cn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(et.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(et.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}}class Va{constructor(){this.index={}}add(e){var t=e.lastSegment(),e=e.popLast(),r=this.index[t]||new D(S.comparator),n=!r.has(e);return this.index[t]=r.add(e),n}has(e){var t=e.lastSegment(),e=e.popLast();return(t=this.index[t])&&t.has(e)}getEntries(e){return(this.index[e]||new D(S.comparator)).toArray()}}let Fa="IndexedDbIndexManager",Ua=new Uint8Array(0);class Ba{constructor(e,t){this.databaseId=t,this.vn=new Va,this.Fn=new Ei(e=>ii(e),(e,t)=>si(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){var r,n;return this.vn.has(t)?C.resolve():(n=t.lastSegment(),r=t.popLast(),e.addOnCommittedListener(()=>{this.vn.add(t)}),n={collectionId:n,parent:o(r)},qa(e).put(n))}getCollectionParents(e,r){let n=[],t=IDBKeyRange.bound([r,""],[Oe(r),""],!1,!0);return qa(e).J(t).next(e=>{for(var t of e){if(t.collectionId!==r)break;n.push(xt(t.parent))}return n})}addFieldIndex(e,r){let t=za(e),n={indexId:r.indexId,collectionGroup:r.collectionGroup,fields:r.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;var i=t.add(n);if(r.indexState){let t=Ga(e);return i.next(e=>{t.put(ca(e,this.uid,r.indexState.sequenceNumber,r.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=za(e),n=Ga(e),i=ja(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=za(e),r=ja(e),n=Ga(e);return t.Z().next(()=>r.Z()).next(()=>n.Z())}createTargetIndexes(r,e){return C.forEach(this.Mn(e),t=>this.getIndexType(r,t).next(e=>{if(0===e||1===e){e=new Da(t).Dn();if(null!=e)return this.addFieldIndex(r,e)}}))}getDocumentsMatchingTarget(e,l){let c=ja(e),r=!0,n=new Map;return C.forEach(this.Mn(l),t=>this.xn(e,t).next(e=>{r=r&&!!e,n.set(t,e)})).next(()=>{if(r){let u=L(),h=[];return C.forEach(n,(s,e)=>{m(Fa,`Using index ${t=s,`id=${t.indexId}|cg=${t.collectionGroup}|f=`+t.fields.map(e=>e.fieldPath+":"+e.kind).join(",")} to execute `+ii(l));var t=(e=>{var t=He(s);if(void 0!==t)for(var r of oi(e,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null})(e),r=((e,t)=>{var r,n=new Map;for(r of We(t))for(var i of oi(e,r.fieldPath))switch(i.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),i.value),Array.from(n.values())}return null})(e,s),n=(e=>{var t,r=[];let n=!0;for(t of We(s)){var i=(0===t.kind?ui:hi)(e,t.fieldPath,e.startAt);r.push(i.value),n=n&&i.inclusive}return new Vn(r,n)})(e),i=(e=>{var t,r=[];let n=!0;for(t of We(s)){var i=(0===t.kind?hi:ui)(e,t.fieldPath,e.endAt);r.push(i.value),n=n&&i.inclusive}return new Vn(r,n)})(e),a=this.On(s,e,n),o=this.On(s,e,i),r=this.Nn(s,e,r),t=this.Bn(s.indexId,t,a,n.inclusive,o,i.inclusive,r);return C.forEach(t,e=>c.Y(e,l.limit).next(e=>{e.forEach(e=>{e=x.fromSegments(e.documentKey);u.has(e)||(u=u.add(e),h.push(e))})}))}).next(()=>h)}return C.resolve(null)})}Mn(t){let e=this.Fn.get(t);return e||(e=0===t.filters.length?[t]:(0===(r=O.create(t.filters,"and")).getFilters().length?[]:(r=function t(e){if(v(e instanceof M||e instanceof O,34018),e instanceof M)return e;if(1===e.filters.length)return t(e.filters[0]);var r=e.filters.map(e=>t(e));let n=O.create(r,e.op);return Ra(n=La(n))?n:(v(n instanceof O,64498),v(jn(n),40251),v(1<n.filters.length,57927),n.filters.reduce((e,t)=>Ma(e,t)))}(function t(r){if(v(r instanceof M||r instanceof O,20012),r instanceof M)return r instanceof Zn?(e=r.value.arrayValue?.values?.map(e=>M.create(r.field,"==",e))||[],O.create(e,"or")):r;var e=r.filters.map(e=>t(e));return O.create(e,r.op)}(r)),v(Ra(r),7391),Na(r)||ka(r)?[r]:r.getFilters())).map(e=>ni(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt)),this.Fn.set(t,e)),e;var r}Bn(s,a,o,u,h,l,c){let e=(null!=a?a.length:1)*Math.max(o.length,h.length),d=e/(null!=a?a.length:1),f=[];for(let i=0;i<e;++i){let t=a?this.Ln(a[i/d]):Ua,e=this.kn(s,t,o[i%d],u),r=this.qn(s,t,h[i%d],l),n=c.map(e=>this.kn(s,t,e,!0));f.push(...this.createRange(e,r,n))}return f}kn(e,t,r,n){e=new Ea(e,x.empty(),t,r);return n?e:e.An()}qn(e,t,r,n){e=new Ea(e,x.empty(),t,r);return n?e.An():e}xn(e,t){let n=new Da(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(var r of e)n.yn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let r=2,n=this.Mn(t);return C.forEach(n,t=>this.xn(e,t).next(e=>{e?0!==r&&e.fields.length<(e=>{let t=new D(l.comparator),r=!1;for(var n of e.filters)for(var i of n.getFlattenedFilters())i.field.isKeyField()||("array-contains"===i.op||"array-contains-any"===i.op?r=!0:t=t.add(i.field));for(var s of e.orderBy)s.field.isKeyField()||(t=t.add(s.field));return t.size+(r?1:0)})(t)&&(r=1):r=0})).next(()=>null!==t.limit&&1<n.length&&2===r?1:r)}Qn(e,t){var r,n=new Ta;for(r of We(e)){var i=t.data.field(r.fieldPath);if(null==i)return null;var s=n.Pn(r.kind);va.Kt.Dt(i,s)}return n.un()}Ln(e){var t=new Ta;return va.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){var r=new Ta;return va.Kt.Dt(En(this.databaseId,t),r.Pn(0===(t=We(e)).length?0:t[t.length-1].kind)),r.un()}Nn(e,t,r){if(null===r)return[];let n=[],i=(n.push(new Ta),0);for(var s of We(e)){var a,o,u=r[i++];for(a of n)this.Un(t,s.fieldPath)&&xn(u)?n=this.Kn(n,s,u):(o=a.Pn(s.kind),va.Kt.Dt(u,o))}return this.Wn(n)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(t){var r=[];for(let e=0;e<t.length;++e)r[e]=t[e].un();return r}Kn(e,t,r){let n=[...e],i=[];for(var s of r.arrayValue.values||[])for(var a of n){let e=new Ta;e.seed(a.un()),va.Kt.Dt(s,e.Pn(t.kind)),i.push(e)}return i}Un(e,t){return!!e.filters.find(e=>e instanceof M&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=za(e),s=Ga(e);return(t?r.J(yr,IDBKeyRange.bound(t,t)):r.J()).next(e=>{let i=[];return C.forEach(e,n=>s.get([n.indexId,this.uid]).next(e=>{var t,r;i.push((t=n,e=e?new Je(e.sequenceNumber,new et(ia(e.readTime),new x(xt(e.documentKey)),e.largestBatchId)):Je.empty(),r=t.fields.map(([e,t])=>new Ye(l.fromServerFormat(e),t)),new $e(t.indexId,t.collectionGroup,r,e)))})).next(()=>i)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=r?r:b(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,r,n){let i=za(e),s=Ga(e);return this.Gn(e).next(t=>i.J(yr,IDBKeyRange.bound(r,r)).next(e=>C.forEach(e,e=>s.put(ca(e.indexId,this.uid,t,n)))))}updateIndexEntries(i,e){let r=new Map;return C.forEach(e,(t,n)=>{var e=r.get(t.collectionGroup);return(e?C.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(r.set(t.collectionGroup,e),C.forEach(e,r=>this.zn(i,t,r).next(e=>{var t=this.jn(n,r);return e.isEqual(t)?C.resolve():this.Jn(i,n,r,e,t)}))))})}Hn(e,t,r,n){return ja(e).put(n.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,n){return ja(e).delete(n.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,r,n){e=ja(e);let i=new D(Sa);return e.ee({index:Er,range:IDBKeyRange.only([n.indexId,this.uid,Ca(this.$n(n,r))])},(e,t)=>{i=i.add(new Ea(n.indexId,r,Aa(t.arrayValue),Aa(t.directionalValue)))}).next(()=>i)}jn(e,t){let r=new D(Sa);var n=this.Qn(t,e);if(null!=n){var i=He(t);if(null!=i){i=e.data.field(i.fieldPath);if(xn(i))for(var s of i.arrayValue.values||[])r=r.add(new Ea(t.indexId,e.key,this.Ln(s),n))}else r=r.add(new Ea(t.indexId,e.key,Ua,n))}return r}Jn(t,i,s,e,a){m(Fa,"Updating index entries for document '%s'",i.key);let o=[];{var u,h=Sa,l=e=>{o.push(this.Hn(t,i,s,e))},c=e=>{o.push(this.Yn(t,i,s,e))},d=e.getIterator(),f=a.getIterator();let r=Hr(d),n=Hr(f);for(;r||n;){let e=!1,t=!1;r&&n?(u=h(r,n))<0?t=!0:0<u&&(e=!0):null!=r?t=!0:e=!0,e?(l(n),n=Hr(f)):t?(c(r),r=Hr(d)):(r=Hr(d),n=Hr(f))}}return C.waitFor(o)}Gn(e){let n=1;return Ga(e).ee({index:_r,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,r)=>{r.done(),n=t.sequenceNumber+1}).next(()=>n)}createRange(e,t,r){r=r.sort((e,t)=>Sa(e,t)).filter((e,t,r)=>!t||0!==Sa(e,r[t-1]));var n,i=[];i.push(e);for(n of r){var s=Sa(n,e),a=Sa(n,t);if(0===s)i[0]=e.An();else if(0<s&&a<0)i.push(n),i.push(n.An());else if(0<a)break}i.push(t);let o=[];for(let e=0;e<i.length;e+=2){if(this.Zn(i[e],i[e+1]))return[];var u=i[e].Vn(this.uid,Ua,x.empty()),h=i[e+1].Vn(this.uid,Ua,x.empty());o.push(IDBKeyRange.bound(u,h))}return o}Zn(e,t){return 0<Sa(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ka)}getMinOffset(t,e){return C.mapArray(this.Mn(e),e=>this.xn(t,e).next(e=>e||_(44426))).next(Ka)}}function qa(e){return r(e,rr)}function ja(e){return r(e,Ir)}function za(e){return r(e,pr)}function Ga(e){return r(e,vr)}function Ka(t){v(0!==t.length,28825);let r=t[0].indexState.offset,n=r.largestBatchId;for(let e=1;e<t.length;e++){var i=t[e].indexState.offset;tt(i,r)<0&&(r=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new et(r.readTime,r.documentKey,n)}let Qa={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class $a{static withCacheSize(e){return new $a(e,$a.DEFAULT_COLLECTION_PERCENTILE,$a.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function Ha(e,t,r){let n=e.store(kt),i=e.store(Ft),s=[],a=IDBKeyRange.only(r.batchId),o=0;var u,e=n.ee({range:a},(e,t,r)=>(o++,r.delete()));s.push(e.next(()=>{v(1===o,47070,{batchId:r.batchId})}));let h=[];for(u of r.mutations){var l=Pt(t,u.key.path,r.batchId);s.push(i.delete(l)),h.push(u.key)}return C.waitFor(s).next(()=>h)}function Wa(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw _(14731);t=e.noDocument}return JSON.stringify(t).length}$a.DEFAULT_COLLECTION_PERCENTILE=10,$a.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$a.DEFAULT=new $a(41943040,$a.DEFAULT_COLLECTION_PERCENTILE,$a.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$a.DISABLED=new $a(-1,0,0);class Ya{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Xn={}}static wt(e,t,r,n){v(""!==e.uid,64387);e=e.isAuthenticated()?e.uid:"";return new Ya(e,t,r,n)}checkEmpty(e){let n=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Xa(e).ee({index:Mt,range:t},(e,t,r)=>{n=!1,r.done()}).next(()=>n)}addMutationBatch(d,f,g,m){let p=Za(d),y=Xa(d);return y.add({}).next(e=>{v("number"==typeof e,49019);let t=new as(e,f,g,m),r=(i=this.serializer,s=this.userId,o=(a=t).baseMutations.map(e=>Ks(i.yt,e)),u=a.mutations.map(e=>Ks(i.yt,e)),{userId:s,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:u}),n=[];var i,s,a,o,u,h;let l=new D((e,t)=>b(e.canonicalString(),t.canonicalString()));for(h of m){var c=Pt(this.userId,h.key.path,e);l=l.add(h.key.path.popLast()),n.push(y.put(r)),n.push(p.put(c,Vt))}return l.forEach(e=>{n.push(this.indexManager.addToCollectionParentIndex(d,e))}),d.addOnCommittedListener(()=>{this.Xn[e]=t.keys()}),C.waitFor(n).next(()=>t)})}lookupMutationBatch(e,t){return Xa(e).get(t).next(e=>e?(v(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),sa(this.serializer,e)):null)}er(e,t){return this.Xn[t]?C.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(e=>{return e?(e=e.keys(),this.Xn[t]=e):null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return Xa(e).ee({index:Mt,range:r},(e,t,r)=>{t.userId===this.userId&&(v(t.batchId>=n,47524,{tr:n}),i=sa(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=_t;return Xa(e).ee({index:Mt,range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,_t],[this.userId,Number.POSITIVE_INFINITY]);return Xa(e).J(Mt,t).next(e=>e.map(e=>sa(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(o,u){let e=Lt(this.userId,u.path),t=IDBKeyRange.lowerBound(e),h=[];return Za(o).ee({range:t},(t,e,r)=>{let[n,i,s]=t,a=xt(i);if(n===this.userId&&u.path.isEqual(a))return Xa(o).get(s).next(e=>{if(!e)throw _(61480,{nr:t,batchId:s});v(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:s}),h.push(sa(this.serializer,e))});r.done()}).next(()=>h)}getAllMutationBatchesAffectingDocumentKeys(t,e){let a=new D(b),r=[];return e.forEach(s=>{var e=Lt(this.userId,s.path),e=IDBKeyRange.lowerBound(e),e=Za(t).ee({range:e},(e,t,r)=>{var[e,n,i]=e,n=xt(n);e===this.userId&&s.path.isEqual(n)?a=a.add(i):r.done()});r.push(e)}),C.waitFor(r).next(()=>this.rr(t,a))}getAllMutationBatchesAffectingQuery(e,t){let s=t.path,a=s.length+1,r=Lt(this.userId,s),n=IDBKeyRange.lowerBound(r),o=new D(b);return Za(e).ee({range:n},(e,t,r)=>{var[e,n,i]=e,n=xt(n);e===this.userId&&s.isPrefixOf(n)?n.length===a&&(o=o.add(i)):r.done()}).next(()=>this.rr(e,o))}rr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(Xa(e).get(t).next(e=>{if(null===e)throw _(35274,{batchId:t});v(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(sa(this.serializer,e))}))}),C.waitFor(n).next(()=>r)}removeMutationBatch(t,r){return Ha(t.le,this.userId,r).next(e=>(t.addOnCommittedListener(()=>{this.ir(r.batchId)}),C.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}ir(e){delete this.Xn[e]}performConsistencyCheck(r){return this.checkEmpty(r).next(e=>{if(!e)return C.resolve();let t=IDBKeyRange.lowerBound([this.userId]),n=[];return Za(r).ee({range:t},(e,t,r)=>{e[0]===this.userId?(e=xt(e[1]),n.push(e)):r.done()}).next(()=>{v(0===n.length,56720,{sr:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return Ja(e,this.userId,t)}_r(e){return eo(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:_t,lastStreamToken:""})}}function Ja(e,i,t){let r=Lt(i,t.path),s=r[1],n=IDBKeyRange.lowerBound(r),a=!1;return Za(e).ee({range:n,X:!0},(e,t,r)=>{var[e,n]=e;e===i&&n===s&&(a=!0),r.done()}).next(()=>a)}function Xa(e){return r(e,kt)}function Za(e){return r(e,Ft)}function eo(e){return r(e,Nt)}class to{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new to(0)}static cr(){return new to(-1)}}class ro{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(r){return this.lr(r).next(e=>{var t=new to(e.highestTargetId);return e.highestTargetId=t.next(),this.hr(r,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(e=>w.fromTimestamp(new y(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,r,n){return this.lr(t).next(e=>(e.highestListenSequenceNumber=r,n&&(e.lastRemoteSnapshotVersion=n.toTimestamp()),e.highestListenSequenceNumber<r&&(e.highestListenSequenceNumber=r),this.hr(t,e)))}addTargetData(t,r){return this.Pr(t,r).next(()=>this.lr(t).next(e=>(e.targetCount+=1,this.Tr(r,e),this.hr(t,e))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>no(t).delete(e.targetId)).next(()=>this.lr(t)).next(e=>(v(0<e.targetCount,8065),--e.targetCount,this.hr(t,e)))}removeTargets(r,n,i){let s=0,a=[];return no(r).ee((e,t)=>{t=aa(t);t.sequenceNumber<=n&&null===i.get(t.targetId)&&(s++,a.push(this.removeTargetData(r,t)))}).next(()=>C.waitFor(a)).next(()=>s)}forEachTarget(e,r){return no(e).ee((e,t)=>{t=aa(t);r(t)})}lr(e){return io(e).get(er).next(e=>(v(null!==e,2888),e))}hr(e,t){return io(e).put(er,t)}Pr(e,t){return no(e).put(oa(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),t.highestListenSequenceNumber<e.sequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(e=>e.targetCount)}getTargetData(e,n){var t=ii(n),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let i=null;return no(e).ee({range:t,index:Ht},(e,t,r)=>{t=aa(t);si(n,t.target)&&(i=t,r.done())}).next(()=>i)}addMatchingKeys(r,e,n){let i=[],s=so(r);return e.forEach(e=>{var t=o(e.path);i.push(s.put({targetId:n,path:t})),i.push(this.referenceDelegate.addReference(r,n,e))}),C.waitFor(i)}removeMatchingKeys(r,e,n){let i=so(r);return C.forEach(e,e=>{var t=o(e.path);return C.waitFor([i.delete([n,t]),this.referenceDelegate.removeReference(r,n,e)])})}removeMatchingKeysForTargetId(e,t){e=so(e),t=IDBKeyRange.bound([t],[t+1],!1,!0);return e.delete(t)}getMatchingKeysForTargetId(e,t){t=IDBKeyRange.bound([t],[t+1],!1,!0),e=so(e);let n=L();return e.ee({range:t,X:!0},(e,t,r)=>{e=xt(e[1]),e=new x(e);n=n.add(e)}).next(()=>n)}containsKey(e,t){t=o(t.path),t=IDBKeyRange.bound([t],[Oe(t)],!1,!0);let n=0;return so(e).ee({index:Xt,X:!0,range:t},([e],t,r)=>{0!==e&&(n++,r.done())}).next(()=>0<n)}At(e,t){return no(e).get(t).next(e=>e?aa(e):null)}}function no(e){return r(e,$t)}function io(e){return r(e,tr)}function so(e){return r(e,Yt)}let ao="LruGarbageCollector";function oo([e,t],[r,n]){e=b(e,r);return 0===e?b(t,n):e}class uo{constructor(e){this.Ir=e,this.buffer=new D(oo),this.Er=0}dr(){return++this.Er}Ar(e){var t,e=[e,this.dr()];this.buffer.size<this.Ir?this.buffer=this.buffer.add(e):oo(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))}get maxValue(){return this.buffer.last()[0]}}class ho{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){m(ao,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ct(e)?m(ao,"Ignoring IndexedDB error during garbage collection: ",e):await it(e)}await this.Vr(3e5)})}}class lo{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return C.resolve(wt.ce);let r=new uo(t);return this.mr.forEachTarget(e,e=>r.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>r.Ar(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(t,r){return-1===this.params.cacheSizeCollectionThreshold?(m("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(Qa)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(m("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold `+this.params.cacheSizeCollectionThreshold),Qa):this.yr(t,r))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(t,r){let n,i,s,a,o,u,h,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(m("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from `+e),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(n=e,o=Date.now(),this.removeTargets(t,n,r))).next(e=>(s=e,u=Date.now(),this.removeOrphanedDocuments(t,n))).next(e=>(h=Date.now(),pe()<=c.DEBUG&&m("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-l}ms
	Determined least recently used ${i} in `+(o-a)+"ms\n"+`	Removed ${s} targets in `+(u-o)+"ms\n"+`	Removed ${e} documents in `+(h-u)+"ms\n"+`Total Duration: ${h-l}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}function co(e,t){return new lo(e,t)}class fo{constructor(e,t){this.db=e,this.garbageCollector=co(this,t)}gr(e){let r=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(t=>r.next(e=>t+e))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,r){return this.Sr(e,(e,t)=>r(t))}addReference(e,t,r){return go(e,r)}removeReference(e,t,r){return go(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return go(e,t)}br(e,r){{var n=e,i=r;let t=!1;return eo(n).te(e=>Ja(n,e,i).next(e=>(e&&(t=!0),C.resolve(!e)))).next(()=>t)}}removeOrphanedDocuments(r,n){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],a=0;return this.Sr(r,(t,e)=>{e<=n&&(e=this.br(r,t).next(e=>{if(!e)return a++,i.getEntry(r,t).next(()=>(i.removeEntry(t,w.min()),so(r).delete([0,o(t.path)])))}),s.push(e))}).next(()=>C.waitFor(s)).next(()=>i.apply(r)).next(()=>a)}removeTarget(e,t){t=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,t)}updateLimboDocument(e,t){return go(e,t)}Sr(e,n){e=so(e);let i,s=wt.ce;return e.ee({index:Xt},([e],{path:t,sequenceNumber:r})=>{0===e?(s!==wt.ce&&n(new x(xt(i)),s),s=r,i=t):s=wt.ce}).next(()=>{s!==wt.ce&&n(new x(xt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function go(e,t){return so(e).put((e=e.currentSequenceNumber,{targetId:0,path:o(t.path),sequenceNumber:e}))}class mo{constructor(){this.changes=new Ei(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,R.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var r=this.changes.get(t);return void 0!==r?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class po{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return _o(e).put(r)}removeEntry(e,t,r){return _o(e).delete((e=r,[(r=t.path.toArray()).slice(0,r.length-2),r[r.length-2],ra(e),r[r.length-1]]))}updateMetadata(t,r){return this.getMetadata(t).next(e=>(e.byteSize+=r,this.Dr(t,e)))}getEntry(e,r){let n=R.newInvalidDocument(r);return _o(e).ee({index:qt,range:IDBKeyRange.only(bo(r))},(e,t)=>{n=this.Cr(r,t)}).next(()=>n)}vr(e,r){let n={size:0,document:R.newInvalidDocument(r)};return _o(e).ee({index:qt,range:IDBKeyRange.only(bo(r))},(e,t)=>{n={document:this.Cr(r,t),size:Wa(t)}}).next(()=>n)}getEntries(e,t){let r=Si;return this.Fr(e,t,(e,t)=>{t=this.Cr(e,t);r=r.insert(e,t)}).next(()=>r)}Mr(e,t){let n=Si,i=new A(x.comparator);return this.Fr(e,t,(e,t)=>{var r=this.Cr(e,t);n=n.insert(e,r),i=i.insert(e,Wa(t))}).next(()=>({documents:n,Or:i}))}Fr(e,t,i){if(t.isEmpty())return C.resolve();let r=new D(To),n=(t.forEach(e=>r=r.add(e)),IDBKeyRange.bound(bo(r.first()),bo(r.last()))),s=r.getIterator(),a=s.getNext();return _o(e).ee({index:qt,range:n},(e,t,r)=>{for(var n=x.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&To(a,n)<0;)i(a,null),a=s.getNext();a&&a.isEqual(n)&&(i(a,t),a=s.hasNext()?s.getNext():null),a?r.j(bo(a)):r.done()}).next(()=>{for(;a;)i(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,n,t,i,s){var t=[(r=n.path).popLast().toArray(),r.lastSegment(),ra(t.readTime),t.documentKey.path.isEmpty()?"":t.documentKey.path.lastSegment()],r=[r.popLast().toArray(),r.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return _o(e).J(IDBKeyRange.bound(t,r,!0)).next(e=>{s?.incrementDocumentReadCount(e.length);let t=Si;for(var r of e){let e=this.Cr(x.fromSegments(r.prefixPath.concat(r.collectionGroup,r.documentId)),r);e.isFoundDocument()&&(bi(n,e)||i.has(e.key))&&(t=t.insert(e.key,e))}return t})}getAllFromCollectionGroup(e,t,r,n){let i=Si;r=Io(t,r),t=Io(t,et.max());return _o(e).ee({index:zt,range:IDBKeyRange.bound(r,t,!0)},(e,t,r)=>{t=this.Cr(x.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(t.key,t)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new vo(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return wo(e).get(Qt).next(e=>(v(!!e,20021),e))}Dr(e,t){return wo(e).put(Qt,t)}Cr(e,t){if(t){let e=((e,t)=>{let r;if(t.document)r=Gs(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){var n=x.fromSegments(t.noDocument.path),i=ia(t.noDocument.readTime);r=R.newNoDocument(n,i),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return _(56709);n=x.fromSegments(t.unknownDocument.path),i=ia(t.unknownDocument.version);r=R.newUnknownDocument(n,i)}return t.readTime&&r.setReadTime((e=t.readTime,n=new y(e[0],e[1]),w.fromTimestamp(n))),r})(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(w.min()))return e}return R.newInvalidDocument(e)}}function yo(e){return new po(e)}class vo extends mo{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Ei(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){let a=[],o=0,u=new D((e,t)=>b(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var r,n,i=this.Br.get(e);a.push(this.Nr.removeEntry(s,e,i.readTime)),t.isValidDocument()?(r=ta(this.Nr.serializer,t),u=u.add(e.path.popLast()),n=Wa(r),o+=n-i.size,a.push(this.Nr.addEntry(s,e,r))):(o-=i.size,this.trackRemovals&&(n=ta(this.Nr.serializer,t.convertToNoDocument(w.min())),a.push(this.Nr.addEntry(s,e,n))))}),u.forEach(e=>{a.push(this.Nr.indexManager.addToCollectionParentIndex(s,e))}),a.push(this.Nr.updateMetadata(s,o)),C.waitFor(a)}getFromCache(e,t){return this.Nr.vr(e,t).next(e=>(this.Br.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:e})=>(e.forEach((e,t)=>{this.Br.set(e,{size:t,readTime:r.get(e).readTime})}),r))}}function wo(e){return r(e,Kt)}function _o(e){return r(e,Ut)}function bo(e){e=e.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Io(e,t){var r=t.documentKey.path.toArray();return[e,ra(t.readTime),r.slice(0,r.length-2),0<r.length?r[r.length-1]:""]}function To(e,t){var r=e.path.toArray(),n=t.path.toArray();let i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=b(r[e],n[e]))return i;return(i=b(r.length,n.length))||(i=b(r[r.length-2],n[n.length-2]))||b(r[r.length-1],n[n.length-1])}class Eo{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class So{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(t,r){let n=null;return this.documentOverlayCache.getOverlay(t,r).next(e=>(n=e,this.remoteDocumentCache.getEntry(t,r))).next(e=>(null!==n&&Ji(n.mutation,e,Wr.empty(),y.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,L()).next(()=>e))}getLocalViewOfDocuments(e,t,r=L()){let n=Di();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let r=Ci();return e.forEach((e,t)=>{r=r.insert(e,t.overlayedDocument)}),r}))}getOverlayedDocuments(e,t){let r=Di();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,L()))}populateOverlays(e,r,t){let n=[];return t.forEach(e=>{r.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,t)=>{r.set(e,t)})})}computeViews(e,t,n,i){let s=Si,a=Di(),r=Di();return t.forEach((e,t)=>{var r=n.get(t.key);i.has(t.key)&&(void 0===r||r.mutation instanceof es)?s=s.insert(t.key,t):void 0!==r?(a.set(t.key,r.mutation.getFieldMask()),Ji(r.mutation,t,r.mutation.getFieldMask(),y.now())):a.set(t.key,Wr.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>r.set(e,new Eo(t,a.get(e)??null))),r))}recalculateAndSaveOverlays(a,o){let u=Di(),h=new A((e,t)=>e-t),l=L();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(a,o).next(e=>{for(let n of e)n.keys().forEach(e=>{var t,r=o.get(e);null!==r&&(t=u.get(e)||Wr.empty(),t=n.applyToLocalView(r,t),u.set(e,t),r=(h.get(n.batchId)||L()).add(e),h=h.insert(n.batchId,r))})}).next(()=>{for(var i=[],s=h.getReverseIterator();s.hasNext();){let e=s.getNext(),t=e.key,r=e.value,n=Di();r.forEach(e=>{var t;l.has(e)||(null!==(t=Yi(o.get(e),u.get(e)))&&n.set(e,t),l=l.add(e))}),i.push(this.documentOverlayCache.saveOverlays(a,t,n))}return C.waitFor(i)}).next(()=>u)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,r,n){return i=t,x.isDocumentKey(i.path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):gi(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n);var i}getNextDocuments(s,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(s,t,a,o).next(r=>{var e=0<o-r.size?this.documentOverlayCache.getOverlaysForCollectionGroup(s,t,a.largestBatchId,o-r.size):C.resolve(Di());let n=-1,i=r;return e.next(e=>C.forEach(e,(t,e)=>(n<e.largestBatchId&&(n=e.largestBatchId),r.get(t)?C.resolve():this.remoteDocumentCache.getEntry(s,t).next(e=>{i=i.insert(t,e)}))).next(()=>this.populateOverlays(s,e,r)).next(()=>this.computeViews(s,i,e,L())).next(e=>({batchId:n,changes:Ai(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new x(t)).next(e=>{let t=Ci();return t=e.isFoundDocument()?t.insert(e.key,e):t})}getDocumentsMatchingCollectionGroupQuery(r,n,i,s){let a=n.collectionGroup,o=Ci();return this.indexManager.getCollectionParents(r,a).next(e=>C.forEach(e,e=>{t=n,e=e.child(a);var t,e=new li(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(r,e,i,s).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,i,r,n){let s;return this.documentOverlayCache.getOverlaysForCollection(t,i.path,r.largestBatchId).next(e=>(s=e,this.remoteDocumentCache.getDocumentsMatchingQuery(t,i,r,s,n))).next(r=>{s.forEach((e,t)=>{t=t.getKey();null===r.get(t)&&(r=r.insert(t,R.newInvalidDocument(t)))});let n=Ci();return r.forEach((e,t)=>{var r=s.get(e);void 0!==r&&Ji(r.mutation,t,Wr.empty(),y.now()),bi(i,t)&&(n=n.insert(e,t))}),n})}}class xo{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return C.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:V(t.createTime)}),C.resolve()}getNamedQuery(e,t){return C.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:t.name,query:ua(t.bundledQuery),readTime:V(t.readTime)}),C.resolve()}}class Co{constructor(){this.overlays=new A(x.comparator),this.qr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Di();return C.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(r,n,e){return e.forEach((e,t)=>{this.St(r,n,t)}),C.resolve()}removeOverlaysForBatchId(e,t,r){var n=this.qr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(r)),C.resolve()}getOverlaysForCollection(e,r,n){let i=Di(),s=r.length+1,t=new x(r.child("")),a=this.overlays.getIteratorFrom(t);for(;a.hasNext();){let e=a.getNext().value,t=e.getKey();if(!r.isPrefixOf(t.path))break;t.path.length===s&&e.largestBatchId>n&&i.set(e.getKey(),e)}return C.resolve(i)}getOverlaysForCollectionGroup(e,r,n,t){let i=new A((e,t)=>e-t);for(var s=this.overlays.getIterator();s.hasNext();){let t=s.getNext().value;if(t.getKey().getCollectionGroup()===r&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=Di(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}let a=Di(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=t)););return C.resolve(a)}St(e,t,r){var n,i=this.overlays.get(r.key);null!==i&&(n=this.qr.get(i.largestBatchId).delete(r.key),this.qr.set(i.largestBatchId,n)),this.overlays=this.overlays.insert(r.key,new us(t,r));let s=this.qr.get(t);void 0===s&&(s=L(),this.qr.set(t,s)),this.qr.set(t,s.add(r.key))}}class Ao{constructor(){this.sessionToken=N.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}}class Do{constructor(){this.Qr=new D(a.$r),this.Ur=new D(a.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){e=new a(e,t);this.Qr=this.Qr.add(e),this.Ur=this.Ur.add(e)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new a(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new x(new S([])),r=new a(t,e),n=new a(t,e+1),i=[];return this.Ur.forEachInRange([r,n],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){var t=new x(new S([])),r=new a(t,e),t=new a(t,e+1);let n=L();return this.Ur.forEachInRange([r,t],e=>{n=n.add(e.key)}),n}containsKey(e){var t=new a(e,0);return null!==(t=this.Qr.firstAfterOrEqual(t))&&e.isEqual(t.key)}}class a{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return x.comparator(e.key,t.key)||b(e.Yr,t.Yr)}static Kr(e,t){return b(e.Yr,t.Yr)||x.comparator(e.key,t.key)}}class No{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new D(a.$r)}checkEmpty(e){return C.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){var i,s=this.tr,t=(this.tr++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1],new as(s,t,r,n));this.mutationQueue.push(t);for(i of n)this.Zr=this.Zr.add(new a(i.key,s)),this.indexManager.addToCollectionParentIndex(e,i.key.path.popLast());return C.resolve(t)}lookupMutationBatch(e,t){return C.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){t=(t=this.ei(t+1))<0?0:t;return C.resolve(this.mutationQueue.length>t?this.mutationQueue[t]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(0===this.mutationQueue.length?_t:this.tr-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new a(t,0),n=new a(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,n],e=>{e=this.Xr(e.Yr);i.push(e)}),C.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new D(b);return t.forEach(e=>{var t=new a(e,0),e=new a(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,e],e=>{r=r.add(e.Yr)})}),C.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;x.isDocumentKey(i)||(i=i.child(""));t=new a(new x(i),0);let s=new D(b);return this.Zr.forEachWhile(e=>{var t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(s=s.add(e.Yr)),!0)},t),C.resolve(this.ti(s))}ti(e){let t=[];return e.forEach(e=>{e=this.Xr(e);null!==e&&t.push(e)}),t}removeMutationBatch(r,n){v(0===this.ni(n.batchId,"removed"),55003),this.mutationQueue.shift();let i=this.Zr;return C.forEach(n.mutations,e=>{var t=new a(e.key,n.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(r,e.key)}).next(()=>{this.Zr=i})}ir(e){}containsKey(e,t){var r=new a(t,0),r=this.Zr.firstAfterOrEqual(r);return C.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){e=this.ei(e);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class ko{constructor(e){this.ri=e,this.docs=new A(x.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){var r=t.key,n=(n=this.docs.get(r))?n.size:0,i=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:i}),this.size+=i-n,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){var r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():R.newInvalidDocument(t))}getEntries(e,t){let r=Si;return t.forEach(e=>{var t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():R.newInvalidDocument(e))}),C.resolve(r)}getDocumentsMatchingQuery(e,r,n,i){let s=Si,a=r.path,t=new x(a.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(t);for(;o.hasNext();){let{key:e,value:{document:t}}=o.getNext();if(!a.isPrefixOf(e.path))break;e.path.length>a.length+1||tt(Ze(t),n)<=0||(i.has(t.key)||bi(r,t))&&(s=s.insert(t.key,t.mutableCopy()))}return C.resolve(s)}getAllFromCollectionGroup(e,t,r,n){_(9500)}ii(e,t){return C.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Ro(this)}getSize(e){return C.resolve(this.size)}}class Ro extends mo{constructor(e){super(),this.Nr=e}applyChanges(r){let n=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?n.push(this.Nr.addEntry(r,t)):this.Nr.removeEntry(e)}),C.waitFor(n)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Mo{constructor(e){this.persistence=e,this.si=new Ei(e=>ii(e),si),this.lastRemoteSnapshotVersion=w.min(),this.highestTargetId=0,this.oi=0,this._i=new Do,this.targetCount=0,this.ai=to.ur()}forEachTarget(e,r){return this.si.forEach((e,t)=>r(t)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),C.resolve()}Pr(e){this.si.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.ai=new to(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.Pr(t),C.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),--this.targetCount,C.resolve()}removeTargets(r,n,i){let s=0,a=[];return this.si.forEach((e,t)=>{t.sequenceNumber<=n&&null===i.get(t.targetId)&&(this.si.delete(e),a.push(this.removeMatchingKeysForTargetId(r,t.targetId)),s++)}),C.waitFor(a).next(()=>s)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){t=this.si.get(t)||null;return C.resolve(t)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),C.resolve()}removeMatchingKeys(t,e,r){this._i.zr(e,r);let n=this.persistence.referenceDelegate,i=[];return n&&e.forEach(e=>{i.push(n.markPotentiallyOrphaned(t,e))}),C.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),C.resolve()}getMatchingKeysForTargetId(e,t){t=this._i.Hr(t);return C.resolve(t)}containsKey(e,t){return C.resolve(this._i.containsKey(t))}}class Oo{constructor(e,t){this.ui={},this.overlays={},this.ci=new wt(0),this.li=!1,this.li=!0,this.hi=new Ao,this.referenceDelegate=e(this),this.Pi=new Mo(this),this.indexManager=new Pa,this.remoteDocumentCache=(e=e=>this.referenceDelegate.Ti(e),new ko(e)),this.serializer=new ea(t),this.Ii=new xo(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Co,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new No(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){m("MemoryPersistence","Starting transaction:",e);let n=new Lo(this.ci.next());return this.referenceDelegate.Ei(),r(n).next(e=>this.referenceDelegate.di(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ai(t,r){return C.or(Object.values(this.ui).map(e=>()=>e.containsKey(t,r)))}}class Lo extends nt{constructor(e){super(),this.currentSequenceNumber=e}}class Po{constructor(e){this.persistence=e,this.Ri=new Do,this.Vi=null}static mi(e){return new Po(e)}get fi(){if(this.Vi)return this.Vi;throw _(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(r){let n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.fi,e=>{let t=x.fromPath(e);return this.gi(r,t).next(e=>{e||n.removeEntry(t,w.min())})}).next(()=>(this.Vi=null,n.apply(r)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return C.or([()=>C.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Vo{constructor(e,t){this.persistence=e,this.pi=new Ei(e=>o(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=co(this,t)}static mi(e,t){return new Vo(e,t)}Ei(){}di(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let r=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(t=>r.next(e=>t+e))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(r,n){return C.forEach(this.pi,(e,t)=>this.br(r,e,t).next(e=>e?C.resolve():n(t)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,r){let n=0,t=this.persistence.getRemoteDocumentCache(),i=t.newChangeBuffer();return t.ii(e,t=>this.br(e,t,r).next(e=>{e||(n++,i.removeEntry(t,w.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){t=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,t)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function n(e){switch(yn(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:var t=an(e);return t?16+n(t):16;case 5:return 2*e.stringValue.length;case 6:return Zr(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce((e,t)=>e+n(t),0);case 10:case 11:{t=e.mapValue;let r=0;return zr(t.fields,(e,t)=>{r+=e.length+n(t)}),r}default:throw _(13486,{value:e})}}(e.data.value)),t}br(e,t,r){return C.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{var e=this.pi.get(t);return C.resolve(void 0!==e&&r<e)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Fo{constructor(e){this.serializer=e}k(t,e,r,n){let s=new at("createOrUpgrade",e);var i;r<1&&1<=n&&(t.createObjectStore(At),(i=t).createObjectStore(Nt,{keyPath:"userId"}),i.createObjectStore(kt,{keyPath:Rt,autoIncrement:!0}).createIndex(Mt,Ot,{unique:!0}),i.createObjectStore(Ft),Uo(t),t.createObjectStore(Ct));let a=C.resolve();return r<3&&3<=n&&(0!==r&&((i=t).deleteObjectStore(Yt),i.deleteObjectStore($t),i.deleteObjectStore(tr),Uo(t)),a=a.next(()=>{return e=s.store(tr),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:w.min().toTimestamp(),targetCount:0},e.put(er,t);var e,t})),r<4&&4<=n&&(a=(a=0!==r?a.next(()=>{return n=t,(i=s).store(kt).J().next(e=>{n.deleteObjectStore(kt),n.createObjectStore(kt,{keyPath:Rt,autoIncrement:!0}).createIndex(Mt,Ot,{unique:!0});let t=i.store(kt),r=e.map(e=>t.put(e));return C.waitFor(r)});var n,i}):a).next(()=>{t.createObjectStore(fr,{keyPath:"clientId"})})),r<5&&5<=n&&(a=a.next(()=>this.yi(s))),r<6&&6<=n&&(a=a.next(()=>(t.createObjectStore(Kt),this.wi(s)))),r<7&&7<=n&&(a=a.next(()=>this.Si(s))),r<8&&8<=n&&(a=a.next(()=>this.bi(t,s))),r<9&&9<=n&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&10<=n&&(a=a.next(()=>this.Di(s))),r<11&&11<=n&&(a=a.next(()=>{t.createObjectStore(gr,{keyPath:"bundleId"}),t.createObjectStore(mr,{keyPath:"name"})})),r<12&&12<=n&&(a=a.next(()=>{var e;(e=t.createObjectStore(xr,{keyPath:Cr})).createIndex(Ar,Dr,{unique:!1}),e.createIndex(Nr,kr,{unique:!1})})),r<13&&13<=n&&(a=a.next(()=>{var e;(e=t.createObjectStore(Ut,{keyPath:Bt})).createIndex(qt,jt),e.createIndex(zt,Gt)}).next(()=>this.Ci(t,s)).next(()=>t.deleteObjectStore(Ct))),r<14&&14<=n&&(a=a.next(()=>this.Fi(t,s))),r<15&&15<=n&&(a=a.next(()=>{var e;(e=t).createObjectStore(pr,{keyPath:"indexId",autoIncrement:!0}).createIndex(yr,"collectionGroup",{unique:!1}),e.createObjectStore(vr,{keyPath:wr}).createIndex(_r,br,{unique:!1}),e.createObjectStore(Ir,{keyPath:Tr}).createIndex(Er,Sr,{unique:!1})})),r<16&&16<=n&&(a=a.next(()=>{e.objectStore(vr).clear()}).next(()=>{e.objectStore(Ir).clear()})),r<17&&17<=n&&(a=a.next(()=>{t.createObjectStore(Rr,{keyPath:"name"})})),a=r<18&&18<=n&&X()?a.next(()=>{e.objectStore(vr).clear()}).next(()=>{e.objectStore(Ir).clear()}):a}wi(t){let r=0;return t.store(Ct).ee((e,t)=>{r+=Wa(t)}).next(()=>{var e={byteSize:r};return t.store(Kt).put(Qt,e)})}yi(r){let e=r.store(Nt),n=r.store(kt);return e.J().next(e=>C.forEach(e,t=>{var e=IDBKeyRange.bound([t.userId,_t],[t.userId,t.lastAcknowledgedBatchId]);return n.J(Mt,e).next(e=>C.forEach(e,e=>{v(e.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:e.batchId});e=sa(this.serializer,e);return Ha(r,t.userId,e).next(()=>{})}))}))}Si(e){let a=e.store(Yt),t=e.store(Ct);return e.store(tr).get(er).next(i=>{let s=[];return t.ee((e,t)=>{let r=new S(e),n=[0,o(r)];s.push(a.get(n).next(e=>e?C.resolve():(e=r,a.put({targetId:0,path:o(e),sequenceNumber:i.highestListenSequenceNumber}))))}).next(()=>C.waitFor(s))})}bi(e,t){e.createObjectStore(rr,{keyPath:nr});let r=t.store(rr),n=new Va,i=e=>{var t;if(n.add(e))return t=e.lastSegment(),e=e.popLast(),r.put({collectionId:t,parent:o(e)})};return t.store(Ct).ee({X:!0},(e,t)=>{e=new S(e);return i(e.popLast())}).next(()=>t.store(Ft).ee({X:!0},([,e],t)=>{e=xt(e);return i(e.popLast())}))}Di(e){let r=e.store($t);return r.ee((e,t)=>{t=aa(t),t=oa(this.serializer,t);return r.put(t)})}Ci(e,i){let t=i.store(Ct),s=[];return t.ee((e,t)=>{var r=i.store(Ut),n={prefixPath:(n=((n=t).document?new x(S.fromString(n.document.name).popFirst(5)):n.noDocument?x.fromSegments(n.noDocument.path):n.unknownDocument?x.fromSegments(n.unknownDocument.path):_(36783)).path.toArray()).slice(0,n.length-2),collectionGroup:n[n.length-2],documentId:n[n.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};s.push(r.put(n))}).next(()=>C.waitFor(s))}Fi(e,i){let t=i.store(kt),s=yo(this.serializer),a=new Oo(Po.mi,this.serializer.yt);return t.J().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??L();sa(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),C.forEach(r,(e,t)=>{var t=new u(t),r=ma.wt(this.serializer,t),n=a.getIndexManager(t),t=Ya.wt(t,this.serializer,n,a.referenceDelegate);return new So(s,t,r,n).recalculateAndSaveOverlaysForDocumentKeys(new qr(i,wt.ce),e).next()})})}}function Uo(e){e.createObjectStore(Yt,{keyPath:Jt}).createIndex(Xt,Zt,{unique:!0}),e.createObjectStore($t,{keyPath:"targetId"}).createIndex(Ht,Wt,{unique:!0}),e.createObjectStore(tr)}let Bo="IndexedDbPersistence",qo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class jo{constructor(e,t,r,n,i,s,a,o,u,h,l=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=s,this.document=a,this.xi=u,this.Oi=h,this.Ni=l,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=e=>Promise.resolve(),!jo.v())throw new E(T.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new fo(this,n),this.$i=t+"main",this.serializer=new ea(o),this.Ui=new ot(this.$i,this.Ni,new Fo(this.serializer)),this.hi=new ya,this.Pi=new ro(this.referenceDelegate,this.serializer),this.remoteDocumentCache=yo(this.serializer),this.Ii=new da,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,!1===h&&d(Bo,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(this.isPrimary||this.allowTabSynchronization)return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e));throw new E(T.FAILED_PRECONDITION,qo)}).then(e=>{this.ci=new wt(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(t){return this.Qi=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ui.$(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Go(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(t).next(e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(t)).next(e=>this.isPrimary&&!e?this.Zi(t).next(()=>!1):!!e&&this.Xi(t).next(()=>!0))).catch(e=>{if(ct(e))return m(Bo,"Failed to extend owner lease: ",e),this.isPrimary;if(this.allowTabSynchronization)return m(Bo,"Releasing owner lease after error during lease refresh",e),!1;throw e}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return zo(e).get(Dt).next(e=>C.resolve(this.es(e)))}ts(e){return Go(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,18e5)){this.qi=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=r(e,fr);return n.J().next(e=>{let t=this.ss(e,18e5),r=e.filter(e=>-1===t.indexOf(e));return C.forEach(r,e=>n.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ki)for(var t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(t){return this.Oi?C.resolve(!0):zo(t).get(Dt).next(e=>{if(null!==e&&this.rs(e.leaseTimestampMs,5e3)&&!this.us(e.ownerId)){if(this.es(e)&&this.networkEnabled)return!0;if(!this.es(e)){if(e.allowTabSynchronization)return!1;throw new E(T.FAILED_PRECONDITION,qo)}}return!(!this.networkEnabled||!this.inForeground)||Go(t).J().next(e=>void 0===this.ss(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,e=this.networkEnabled===e.networkEnabled;if(t||r&&e)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&m(Bo,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[At,fr],e=>{let t=new qr(e,wt.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(e=>this.rs(e.updateTimeMs,t)&&!this.us(e.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Go(e).J().next(e=>this.ss(e,18e5).map(e=>e.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Ya.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Ba(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return ma.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(t,r,n){m(Bo,"Starting transaction:",t);var e="readonly"===r?"readonly":"readwrite",i=18===(i=this.Ni)?Br:17===i?Ur:16===i?Fr:15===i?Vr:14===i?Pr:13===i?Lr:12===i?Or:11===i?Mr:void _(60245);let s;return this.Ui.runTransaction(t,e,i,e=>(s=new qr(e,this.ci?this.ci.next():wt.ce),"readwrite-primary"===r?this.Hi(s).next(e=>!!e||this.Yi(s)).next(e=>{if(e)return n(s);throw d(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new E(T.FAILED_PRECONDITION,rt)}).next(e=>this.Xi(s).next(()=>e)):this.Is(s).next(()=>n(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}Is(e){return zo(e).get(Dt).next(e=>{if(null!==e&&this.rs(e.leaseTimestampMs,5e3)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new E(T.FAILED_PRECONDITION,qo)})}Xi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return zo(e).put(Dt,t)}static v(){return ot.v()}Zi(e){let t=zo(e);return t.get(Dt).next(e=>this.es(e)?(m(Bo,"Releasing primary lease."),t.delete(Dt)):C.resolve())}rs(e,t){var r=Date.now();return!(e<r-t||r<e&&(d(`Detected an update time that is in the future: ${e} > `+r),1))}Gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground="visible"===this.document.visibilityState)}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){"function"==typeof this.window?.addEventListener&&(this.Bi=()=>{this.cs();var e=/(?:Version|Mobile)\/1[456]/;J()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{var t=null!==this.Ki?.getItem(this._s(e));return m(Bo,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return d(Bo,"Failed to get zombied client id.",e),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){d("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch(e){}}_s(e){return`firestore_zombie_${this.persistenceKey}_`+e}}function zo(e){return r(e,At)}function Go(e){return r(e,fr)}function Ko(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class Qo{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=n}static As(e,t){let r=L(),n=L();for(var i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:n=n.add(i.doc.key)}return new Qo(e,t.fromCache,r,n)}}class $o{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Ho{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=J()?8:0<ut(W())?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(r,n,e,t){let i={result:null};return this.ys(r,n).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(r,n,t,e).next(e=>{i.result=e})}).next(()=>{if(!i.result){let t=new $o;return this.Ss(r,n,t).next(e=>{if(i.result=e,this.Vs)return this.bs(r,n,t,e.size)})}}).next(()=>i.result)}bs(e,t,r,n){return r.documentReadCount<this.fs?(pe()<=c.DEBUG&&m("QueryEngine","SDK will not create cache indexes for query:",_i(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),C.resolve()):(pe()<=c.DEBUG&&m("QueryEngine","Query:",_i(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.gs*n?(pe()<=c.DEBUG&&m("QueryEngine","The SDK decides to create cache indexes for query:",_i(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,pi(t))):C.resolve())}ys(i,s){if(fi(s))return C.resolve(null);let t=pi(s);return this.indexManager.getIndexType(i,t).next(e=>0===e?null:(null!==s.limit&&1===e&&(s=yi(s,null,"F"),t=pi(s)),this.indexManager.getDocumentsMatchingTarget(i,t).next(e=>{let n=L(...e);return this.ps.getDocuments(i,n).next(r=>this.indexManager.getMinOffset(i,t).next(e=>{var t=this.Ds(s,r);return this.Cs(s,t,n,e.readTime)?this.ys(i,yi(s,null,"F")):this.vs(i,t,s,e)}))})))}ws(t,r,n,i){return fi(r)||i.isEqual(w.min())?C.resolve(null):this.ps.getDocuments(t,n).next(e=>{e=this.Ds(r,e);return this.Cs(r,e,n,i)?C.resolve(null):(pe()<=c.DEBUG&&m("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),_i(r)),this.vs(t,e,r,Xe(i,-1)).next(e=>e))})}Ds(r,e){let n=new D(Ti(r));return e.forEach((e,t)=>{bi(r,t)&&(n=n.add(t))}),n}Cs(e,t,r,n){return null!==e.limit&&(r.size!==t.size||!!(r="F"===e.limitType?t.last():t.first())&&(r.hasPendingWrites||0<r.version.compareTo(n)))}Ss(e,t,r){return pe()<=c.DEBUG&&m("QueryEngine","Using full collection scan to execute query:",_i(t)),this.ps.getDocumentsMatchingQuery(e,t,et.min(),r)}vs(e,r,t,n){return this.ps.getDocumentsMatchingQuery(e,t,n).next(t=>(r.forEach(e=>{t=t.insert(e.key,e)}),t))}}let Wo="LocalStore",Yo=3e8;class Jo{constructor(e,t,r,n){this.persistence=e,this.Fs=t,this.serializer=n,this.Ms=new A(b),this.xs=new Ei(e=>ii(e),si),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new So(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}}function Xo(e,t,r,n){return new Jo(e,t,r,n)}async function Zo(e,t){let l=e;return l.persistence.runTransaction("Handle user change","readonly",u=>{let h;return l.mutationQueue.getAllMutationBatches(u).next(e=>(h=e,l.Bs(t),l.mutationQueue.getAllMutationBatches(u))).next(e=>{let t=[],r=[],n=L();for(var i of h){t.push(i.batchId);for(var s of i.mutations)n=n.add(s.key)}for(var a of e){r.push(a.batchId);for(var o of a.mutations)n=n.add(o.key)}return l.localDocuments.getDocuments(u,n).next(e=>({Ls:e,removedBatchIds:t,addedBatchIds:r}))})})}function eu(e){let t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function tu(e,s,t){let r=L(),a=L();return t.forEach(e=>r=r.add(e)),s.getEntries(e,r).next(n=>{let i=Si;return t.forEach((e,t)=>{var r=n.get(e);t.isFoundDocument()!==r.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(w.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!r.isValidDocument()||0<t.version.compareTo(r.version)||0===t.version.compareTo(r.version)&&r.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):m(Wo,"Ignoring outdated watch update for ",e,". Current version:",r.version," Watch version:",t.version)}),{ks:i,qs:a}})}function ru(e,n){let i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let r;return i.Pi.getTargetData(t,n).next(e=>e?(r=e,C.resolve(r)):i.Pi.allocateTargetId(t).next(e=>(r=new Zs(n,e,"TargetPurposeListen",t.currentSequenceNumber),i.Pi.addTargetData(t,r).next(()=>r))))}).then(e=>{var t=i.Ms.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Ms=i.Ms.insert(e.targetId,e),i.xs.set(n,e.targetId)),e})}async function nu(e,t,r){let n=e,i=n.Ms.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!ct(e))throw e;m(Wo,`Failed to update sequence numbers for target ${t}: `+e)}n.Ms=n.Ms.remove(t),n.xs.delete(i.target)}function iu(e,s,a){let o=e,u=w.min(),h=L();return o.persistence.runTransaction("Execute query","readwrite",t=>{return n=o,e=t,r=pi(s),(void 0!==(i=(n=n).xs.get(r))?C.resolve(n.Ms.get(i)):n.Pi.getTargetData(e,r)).next(e=>{if(e)return u=e.lastLimboFreeSnapshotVersion,o.Pi.getMatchingKeysForTargetId(t,e.targetId).next(e=>{h=e})}).next(()=>o.Fs.getDocumentsMatchingQuery(t,s,a?u:w.min(),a?h:L())).next(e=>(ou(o,Ii(s),e),{documents:e,Qs:h}));var e,r,n,i})}function su(e,t){let r=e,n=r.Pi,i=r.Ms.get(t);return i?Promise.resolve(i.target):r.persistence.runTransaction("Get target data","readonly",e=>n.At(e,t).next(e=>e?e.target:null))}function au(e,t){let r=e,n=r.Os.get(t)||w.min();return r.persistence.runTransaction("Get new document changes","readonly",e=>r.Ns.getAllFromCollectionGroup(e,t,Xe(n,-1),Number.MAX_SAFE_INTEGER)).then(e=>(ou(r,t,e),e))}function ou(e,t,r){let n=e.Os.get(t)||w.min();r.forEach((e,t)=>{0<t.readTime.compareTo(n)&&(n=t.readTime)}),e.Os.set(t,n)}let uu="firestore_clients";function hu(e,t){return uu+`_${e}_`+t}let lu="firestore_mutations";function cu(e,t,r){let n=lu+`_${e}_`+r;return t.isAuthenticated()&&(n+="_"+t.uid),n}let du="firestore_targets";function fu(e,t){return du+`_${e}_`+t}let gu="SharedClientState";class mu{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static Ws(e,t,r){var n=JSON.parse(r);let i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new E(n.error.code,n.error.message)),s?new mu(e,t,n.state,i):(d(gu,`Failed to parse mutation state for ID '${t}': `+r),null)}Gs(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class pu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){var r=JSON.parse(t);let n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new E(r.error.code,r.error.message)),i?new pu(e,r.state,n):(d(gu,`Failed to parse target state for ID '${e}': `+t),null)}Gs(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class yu{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){var r=JSON.parse(t);let n="object"==typeof r&&r.activeTargetIds instanceof Array,i=Ri;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=Tt(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new yu(e,i):(d(gu,`Failed to parse client data for instance '${e}': `+t),null)}}class vu{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new vu(t.clientId,t.onlineState):(d(gu,"Failed to parse online state: "+e),null)}}class wu{constructor(){this.activeTargetIds=Ri}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class _u{constructor(e,t,r,n,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new A(b),this.started=!1,this.Xs=[];e=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=hu(this.persistenceKey,this.Js),this.no="firestore_sequence_number_"+this.persistenceKey,this.Zs=this.Zs.insert(this.Js,new wu),this.ro=new RegExp(`^${uu}_${e}_([^_]*)$`),this.io=new RegExp(`^${lu}_${e}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${du}_${e}_(\\d+)$`),this.oo="firestore_online_state_"+this.persistenceKey,this._o="firestore_bundle_loaded_v2_"+this.persistenceKey,this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){var e,t;for(e of await this.syncEngine.Ts())e===this.Js||(t=this.getItem(hu(this.persistenceKey,e)))&&(t=yu.Ws(e,t))&&(this.Zs=this.Zs.insert(t.clientId,t));this.ao();var r,n=this.storage.getItem(this.oo);n&&(n=this.uo(n))&&this.co(n);for(r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(r){let n=!1;return this.Zs.forEach((e,t)=>{t.activeTargetIds.has(r)&&(n=!0)}),n}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";var n;return this.isActiveQueryTarget(e)&&(n=this.storage.getItem(fu(this.persistenceKey,e)))&&(n=pu.Ws(e,n))&&(r=n.state),t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(fu(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.Po(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return m(gu,"READ",e,t),t}setItem(e,t){m(gu,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){m(gu,"REMOVE",e),this.storage.removeItem(e)}Ys(e){let t=e;t.storageArea===this.storage&&(m(gu,"EVENT",t.key,t.newValue),t.key===this.eo?d("Received WebStorage notification for local change. Another client might have garbage-collected our state"):this.Mi.enqueueRetryable(async()=>{if(this.started){if(null!==t.key){if(this.ro.test(t.key))return null==t.newValue?(e=this.Ro(t.key),this.Vo(e,null)):(e=this.mo(t.key,t.newValue))?this.Vo(e.clientId,e):void 0;var e;if(this.io.test(t.key)){if(null!==t.newValue)if(e=this.fo(t.key,t.newValue))return this.po(e)}else if(this.so.test(t.key)){if(null!==t.newValue)if(e=this.yo(t.key,t.newValue))return this.wo(e)}else if(t.key===this.oo){if(null!==t.newValue)if(e=this.uo(t.newValue))return this.co(e)}else t.key===this.no?(e=(e=>{let t=wt.ce;if(null!=e)try{var r=JSON.parse(e);v("number"==typeof r,30636,{So:e}),t=r}catch(e){d(gu,"Failed to read sequence number from WebStorage",e)}return t})(t.newValue))!==wt.ce&&this.sequenceNumberHandler(e):t.key===this._o&&(e=this.bo(t.newValue),await Promise.all(e.map(e=>this.syncEngine.Do(e))))}}else this.Xs.push(t)}))}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){t=new mu(this.currentUser,e,t,r),r=cu(this.persistenceKey,this.currentUser,e);this.setItem(r,t.Gs())}Po(e){e=cu(this.persistenceKey,this.currentUser,e);this.removeItem(e)}Eo(e){e={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(e))}Io(e,t,r){var n=fu(this.persistenceKey,e),e=new pu(e,t,r);this.setItem(n,e.Gs())}Ao(e){e=JSON.stringify(Array.from(e));this.setItem(this._o,e)}Ro(e){e=this.ro.exec(e);return e?e[1]:null}mo(e,t){e=this.Ro(e);return yu.Ws(e,t)}fo(e,t){var e=this.io.exec(e),r=Number(e[1]),e=void 0!==e[2]?e[2]:null;return mu.Ws(new u(e),r,t)}yo(e,t){e=this.so.exec(e),e=Number(e[1]);return pu.Ws(e,t)}uo(e){return vu.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);m(gu,"Ignoring mutation for non-active user "+e.user.uid)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){let r=t?this.Zs.insert(e,t):this.Zs.remove(e),n=this.lo(this.Zs),i=this.lo(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Fo(s,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let r=Ri;return e.forEach((e,t)=>{r=r.unionWith(t.activeTargetIds)}),r}}class bu{constructor(){this.Mo=new wu,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new wu,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Iu{Oo(e){}shutdown(){}}let Tu="ConnectivityMonitor";class Eu{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){m(Tu,"Network connectivity changed: AVAILABLE");for(var e of this.qo)e(0)}ko(){m(Tu,"Network connectivity changed: UNAVAILABLE");for(var e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Su=null;function xu(){return null===Su?Su=268435456+Math.round(2147483648*Math.random()):Su++,"0x"+Su.toString(16)}let Cu="RestConnection",Au={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Du{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}let Nu="WebChannelConnection";class ku extends class{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/`+n,this.Wo=this.databaseId.database===hn?"project_id="+r:`project_id=${r}&database_id=`+n}Go(t,e,r,n,i){let s=xu(),a=this.zo(t,e.toUriEncodedString());m(Cu,`Sending RPC '${t}' ${s}:`,a,r);e={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(e,n,i);n=K(new URL(a).host);return this.Jo(t,a,e,r,n).then(e=>(m(Cu,`Received RPC '${t}' ${s}: `,e),e),e=>{throw ye(Cu,`RPC '${t}' ${s} failed with error: `,e,"url: ",a,"request:",r),e})}Ho(e,t,r,n,i,s){return this.Go(e,t,r,n,i)}jo(r,e,t){r["X-Goog-Api-Client"]="gl-js/ fire/"+ge,r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>r[t]=e),t&&t.headers.forEach((e,t)=>r[t]=e)}zo(e,t){e=Au[e];return this.Uo+`/v1/${t}:`+e}terminate(){}}{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(u,t,r,n,e){let h=xu();return new Promise((s,a)=>{let o=new ir;o.setWithCredentials(!0),o.listenOnce(ar.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case or.NO_ERROR:var e=o.getResponseJson();m(Nu,`XHR for RPC '${u}' ${h} received:`,JSON.stringify(e)),s(e);break;case or.TIMEOUT:m(Nu,`RPC '${u}' ${h} timed out`),a(new E(T.DEADLINE_EXCEEDED,"Request time out"));break;case or.HTTP_ERROR:var t=o.getStatus();if(m(Nu,`RPC '${u}' ${h} failed with status:`,t,"response text:",o.getResponseText()),0<t){let e=o.getResponseJson();var r,n=(e=Array.isArray(e)?e[0]:e)?.error;n&&n.status&&n.message?(i=n.status.toLowerCase().replace(/_/g,"-"),r=0<=Object.values(T).indexOf(i)?i:T.UNKNOWN,a(new E(r,n.message))):a(new E(T.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new E(T.UNAVAILABLE,"Connection failed."));break;default:_(9055,{l_:u,streamId:h,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{m(Nu,`RPC '${u}' ${h} completed.`)}var i});var e=JSON.stringify(n);m(Nu,`RPC '${u}' ${h} sending request:`,n),o.send(t,"POST",e,r,15)})}T_(i,e,t){let s=xu(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",i,"/channel"],n=cr(),a=lr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/`+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(o.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,e,t),o.encodeInitMessageHeaders=!0;e=r.join("");m(Nu,`Creating RPC '${i}' stream ${s}: `+e,o);let h=n.createWebChannel(e,o),l=(this.I_(h),!1),c=!1,d=new Du({Yo:e=>{c?m(Nu,`Not sending because RPC '${i}' stream ${s} is closed:`,e):(l||(m(Nu,`Opening RPC '${i}' stream ${s} transport.`),h.open(),l=!0),m(Nu,`RPC '${i}' stream ${s} sending:`,e),h.send(e))},Zo:()=>h.close()}),f=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return f(h,sr.EventType.OPEN,()=>{c||(m(Nu,`RPC '${i}' stream ${s} transport opened.`),d.o_())}),f(h,sr.EventType.CLOSE,()=>{c||(c=!0,m(Nu,`RPC '${i}' stream ${s} transport closed`),d.a_(),this.E_(h))}),f(h,sr.EventType.ERROR,e=>{c||(c=!0,ye(Nu,`RPC '${i}' stream ${s} transport errored. Name:`,e.name,"Message:",e.message),d.a_(new E(T.UNAVAILABLE,"The operation could not be completed")))}),f(h,sr.EventType.MESSAGE,e=>{if(!c){var e=e.data[0],n=(v(!!e,16349),e);if(n=n?.error||n[0]?.error){m(Nu,`RPC '${i}' stream ${s} received error:`,n);let t=n.status,e=(()=>{var e=g[t];if(void 0!==e)return cs(e)})(),r=n.message;void 0===e&&(e=T.INTERNAL,r="Unknown error status: "+t+" with message "+n.message),c=!0,d.a_(new E(e,r)),h.close()}else m(Nu,`RPC '${i}' stream ${s} received:`,e),d.u_(e)}}),f(a,hr.STAT_EVENT,e=>{e.stat===ur.PROXY?m(Nu,`RPC '${i}' stream ${s} detected buffering proxy`):e.stat===ur.NOPROXY&&m(Nu,`RPC '${i}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{d.__()},0),d}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(t){this.c_=this.c_.filter(e=>e===t)}}function Ru(){return"undefined"!=typeof window?window:null}function Mu(){return"undefined"!=typeof document?document:null}function Ou(e){return new Ns(e,!0)}class Lu{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=n,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();var t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);0<n&&m("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}let Pu="PersistentStream";class Vu{constructor(e,t,r,n,i,s,a,o){this.Mi=e,this.S_=r,this.b_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Lu(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===T.RESOURCE_EXHAUSTED?(d(t.toString()),d("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===T.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),r=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.D_===r&&this.G_(e,t)},t=>{e(()=>{var e=new E(T.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return m(Pu,"close with error: "+e),this.stream=null,this.close(4,e)}W_(t){return e=>{this.Mi.enqueueAndForget(()=>this.D_===t?e():(m(Pu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Fu extends Vu{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();var t=((e,t)=>{let r;if("targetChange"in t){t.targetChange;var n="NO_CHANGE"===(u=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===u?1:"REMOVE"===u?2:"CURRENT"===u?3:"RESET"===u?4:_(39313,{state:u}),i=t.targetChange.targetIds||[],s=(u=t.targetChange.resumeToken,e.useProto3Json?(v(void 0===u||"string"==typeof u,58123),N.fromBase64String(u||"")):(v(void 0===u||u instanceof Buffer||u instanceof Uint8Array,16193),N.fromUint8Array(u||new Uint8Array))),a=(a=t.targetChange.cause)&&(a=void 0===(u=a).code?T.UNKNOWN:cs(u.code),new E(a,u.message||""));r=new Is(n,i,s,a||null)}else if("documentChange"in t){t.documentChange;(n=t.documentChange).document,n.document.name,n.document.updateTime;var i=Fs(e,n.document.name),s=V(n.document.updateTime),a=n.document.createTime?V(n.document.createTime):w.min(),o=new Pn({mapValue:{fields:n.document.fields}}),i=R.newFoundDocument(i,s,a,o),s=n.targetIds||[],o=n.removedTargetIds||[];r=new _s(s,o,i.key,i)}else if("documentDelete"in t)t.documentDelete,(n=t.documentDelete).document,s=Fs(e,n.document),o=n.readTime?V(n.readTime):w.min(),i=R.newNoDocument(s,o),s=n.removedTargetIds||[],r=new _s([],s,i.key,i);else if("documentRemove"in t)t.documentRemove,(o=t.documentRemove).document,n=Fs(e,o.document),s=o.removedTargetIds||[],r=new _s([],s,n,null);else{if(!("filter"in t))return _(11601,{Rt:t});t.filter;var u=t.filter,{count:i=0,unchangedNames:o}=(u.targetId,u),s=new hs(i,o),n=u.targetId;r=new bs(n,s)}var u;return r})(this.serializer,e),r="targetChange"in e&&(!(r=e.targetChange).targetIds||!r.targetIds.length)&&r.readTime?V(r.readTime):w.min();return this.listener.H_(t,r)}Y_(e){var t,r,n,i={},s=(i.database=qs(this.serializer),i.addTarget=(t=this.serializer,(n=ai(n=(s=e).target)?{documents:$s(t,n)}:{query:Hs(t,n).ft}).targetId=s.targetId,0<s.resumeToken.approximateByteSize()?(n.resumeToken=Ms(t,s.resumeToken),null!==(r=ks(t,s.expectedCount))&&(n.expectedCount=r)):0<s.snapshotVersion.compareTo(w.min())&&(n.readTime=Rs(t,s.snapshotVersion.toTimestamp()),null!==(r=ks(t,s.expectedCount))&&(n.expectedCount=r)),n),this.serializer,null==(t=(e=>{switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return _(28987,{purpose:e})}})((t=e).purpose))?null:{"goog-listen-tags":t});s&&(i.labels=s),this.q_(i)}Z_(e){var t={};t.database=qs(this.serializer),t.removeTarget=e,this.q_(t)}}class Uu extends Vu{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get X_(){return 0<this.F_}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return v(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,v(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){v(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();t=e.writeResults,n=e.commitTime;var n,t=t&&0<t.length?(v(void 0!==n,14353),t.map(t=>{{var r=n;let e=t.updateTime?V(t.updateTime):V(r);return e.isEqual(w.min())&&(e=V(r)),new $i(e,t.transformResults||[])}})):[],e=V(e.commitTime);return this.listener.na(e,t)}ra(){var e={};e.database=qs(this.serializer),this.q_(e)}ea(e){e={streamToken:this.lastStreamToken,writes:e.map(e=>Ks(this.serializer,e))};this.q_(e)}}class Bu extends class{}{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new E(T.FAILED_PRECONDITION,"The client has already been terminated.")}Go(r,n,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.Go(r,Ls(n,i),s,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===T.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new E(T.UNKNOWN,e.toString())})}Ho(r,n,i,s,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.Ho(r,Ls(n,i),s,e,t,a)).catch(e=>{throw"FirebaseError"===e.name?(e.code===T.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new E(T.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class qu{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,1<=this.oa&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: "+e.toString()),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){e=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(d(e),this.aa=!1):m("OnlineStateTracker",e)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let ju="RemoteStore";class zu{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{r.enqueueAndForget(async()=>{Xu(this)&&(m(ju,"Restarting streams for network reachability change."),this.Ea.add(4),await Ku(this),this.Ra.set("Unknown"),this.Ea.delete(4),await Gu(this))})}),this.Ra=new qu(r,n)}}async function Gu(e){if(Xu(e))for(var t of e.da)await t(!0)}async function Ku(e){for(var t of e.da)await t(!1)}function Qu(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),Ju(e)?Yu(e):oh(e).O_()&&Hu(e,t))}function $u(e,t){var r=oh(e);e.Ia.delete(t),r.O_()&&Wu(e,t),0===e.Ia.size&&(r.O_()?r.L_():Xu(e)&&e.Ra.set("Unknown"))}function Hu(e,t){var r;e.Va.Ue(t.targetId),(0<t.resumeToken.approximateByteSize()||0<t.snapshotVersion.compareTo(w.min()))&&(r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size,t=t.withExpectedCount(r)),oh(e).Y_(t)}function Wu(e,t){e.Va.Ue(t),oh(e).Z_(t)}function Yu(t){t.Va=new Es({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),oh(t).start(),t.Ra.ua()}function Ju(e){return Xu(e)&&!oh(e).x_()&&0<e.Ia.size}function Xu(e){return 0===e.Ea.size}function Zu(e){e.Va=void 0}async function eh(e,t,r){if(!ct(t))throw t;e.Ea.add(1),await Ku(e),e.Ra.set("Offline"),r=r||(()=>eu(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{m(ju,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await Gu(e)})}function th(t,r){return r().catch(e=>eh(t,e,r))}async function rh(e){var t,r,n,i,s=e,a=uh(s);let o=0<s.Ta.length?s.Ta[s.Ta.length-1].batchId:_t;for(;Xu(i=s)&&i.Ta.length<10;)try{var u=await((e,t)=>{let r=e;return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=_t),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))})(s.localStore,o);if(null===u){0===s.Ta.length&&a.L_();break}o=u.batchId,r=u,n=void 0,(t=s).Ta.push(r),(n=uh(t)).O_()&&n.X_&&n.ea(r.mutations)}catch(e){await eh(s,e)}nh(s)&&ih(s)}function nh(e){return Xu(e)&&!uh(e).x_()&&0<e.Ta.length}function ih(e){uh(e).start()}async function sh(e,t){e.asyncQueue.verifyOperationInProgress(),m(ju,"RemoteStore received new credentials");var r=Xu(e);e.Ea.add(3),await Ku(e),r&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await Gu(e)}async function ah(e,t){t?(e.Ea.delete(2),await Gu(e)):(e.Ea.add(2),await Ku(e),e.Ra.set("Unknown"))}function oh(t){return t.ma||(t.ma=(n=t.datastore,e=t.asyncQueue,r={Xo:async function(e){e.Ra.set("Online")}.bind(null,t),t_:async function(r){r.Ia.forEach((e,t)=>{Hu(r,e)})}.bind(null,t),r_:async function(e,t){Zu(e),Ju(e)?(e.Ra.ha(t),Yu(e)):e.Ra.set("Unknown")}.bind(null,t),H_:async function(e,t,r){if(e.Ra.set("Online"),t instanceof Is&&2===t.state&&t.cause)try{var n,i=e,s=t.cause;for(n of t.targetIds)i.Ia.has(n)&&(await i.remoteSyncer.rejectListen(n,s),i.Ia.delete(n),i.Va.removeTarget(n))}catch(r){m(ju,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await eh(e,r)}else if(t instanceof _s?e.Va.Ze(t):t instanceof bs?e.Va.st(t):e.Va.tt(t),!r.isEqual(w.min()))try{var a=await eu(e.localStore);0<=r.compareTo(a)&&(u=r,(h=(o=e).Va.Tt(u)).targetChanges.forEach((e,t)=>{var r;0<e.resumeToken.approximateByteSize()&&(r=o.Ia.get(t))&&o.Ia.set(t,r.withResumeToken(e.resumeToken,u))}),h.targetMismatches.forEach((e,t)=>{var r=o.Ia.get(e);r&&(o.Ia.set(e,r.withResumeToken(N.EMPTY_BYTE_STRING,r.snapshotVersion)),Wu(o,e),r=new Zs(r.target,e,t,r.sequenceNumber),Hu(o,r))}),await o.remoteSyncer.applyRemoteEvent(h))}catch(t){m(ju,"Failed to raise snapshot:",t),await eh(e,t)}var o,u,h}.bind(null,t)},(n=n).sa(),new Fu(e,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)),t.da.push(async e=>{e?(t.ma.B_(),Ju(t)?Yu(t):t.Ra.set("Unknown")):(await t.ma.stop(),Zu(t))})),t.ma;var e,r,n}function uh(t){return t.fa||(t.fa=(n=t.datastore,e=t.asyncQueue,r={Xo:()=>Promise.resolve(),t_:async function(e){uh(e).ra()}.bind(null,t),r_:async function(e,t){if(t&&uh(e).X_){var r=e,n=t;if(ls(t=n.code)&&t!==T.ABORTED){let e=r.Ta.shift();uh(r).B_(),await th(r,()=>r.remoteSyncer.rejectFailedWrite(e.batchId,n)),await rh(r)}await 0}nh(e)&&ih(e)}.bind(null,t),ta:async function(e){var t,r=uh(e);for(t of e.Ta)r.ea(t.mutations)}.bind(null,t),na:async function(e,t,r){let n=e.Ta.shift(),i=os.from(n,t,r);await th(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await rh(e)}.bind(null,t)},(n=n).sa(),new Uu(e,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)),t.da.push(async e=>{e?(t.fa.B_(),await rh(t)):(await t.fa.stop(),0<t.Ta.length&&(m(ju,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa;var e,r,n}class hh{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new f,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){var s=Date.now()+r;return(s=new hh(e,t,s,n,i)).start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new E(T.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function lh(e,t){if(d("AsyncQueue",t+": "+e),ct(e))return new E(T.UNAVAILABLE,t+": "+e);throw e}class ch{static emptySet(e){return new ch(e.comparator)}constructor(r){this.comparator=r?(e,t)=>r(e,t)||x.comparator(e.key,t.key):(e,t)=>x.comparator(e.key,t.key),this.keyedMap=Ci(),this.sortedSet=new A(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){e=this.keyedMap.get(e);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(r){this.sortedSet.inorderTraversal((e,t)=>(r(e),!1))}add(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ch))return!1;if(this.size!==e.size)return!1;for(var r=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();r.hasNext();){let e=r.getNext().key,t=n.getNext().key;if(!e.isEqual(t))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){var r=new ch;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class dh{constructor(){this.ga=new A(x.comparator)}track(e){var t=e.doc.key,r=this.ga.get(t);!r||0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):_(63341,{Rt:e,pa:r})}ya(){let r=[];return this.ga.inorderTraversal((e,t)=>{r.push(t)}),r}}class fh{constructor(e,t,r,n,i,s,a,o,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new fh(e,t,ch.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&vi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class gh{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class mh{constructor(){this.queries=ph(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e,n=new E(T.ABORTED,"Firestore shutting down"),t=(e=this).queries;e.queries=ph(),t.forEach((e,t)=>{for(var r of t.Sa)r.onError(n)})}}function ph(){return new Ei(e=>wi(e),vi)}async function yh(e,t){let r=e,n=3;var i=t.query;let s=r.queries.get(i);s?!s.ba()&&t.Da()&&(n=2):(s=new gh,n=t.Da()?0:1);try{switch(n){case 0:s.wa=await r.onListen(i,!0);break;case 1:s.wa=await r.onListen(i,!1);break;case 2:await r.onFirstRemoteStoreListen(i)}}catch(e){var a=lh(e,`Initialization of query '${_i(t.query)}' failed`);return void t.onError(a)}r.queries.set(i,s),s.Sa.push(t),t.va(r.onlineState),s.wa&&t.Fa(s.wa)&&wh(r)}async function vh(e,t){var r=e,n=t.query;let i=3;var s,e=r.queries.get(n);switch(!e||0<=(s=e.Sa.indexOf(t))&&(e.Sa.splice(s,1),0===e.Sa.length?i=t.Da()?0:1:!e.ba()&&t.Da()&&(i=2)),i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function wh(e){e.Ca.forEach(e=>{e.next()})}ce={Ma:"default",Cache:"cache"};class _h{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(t){if(!this.options.includeMetadataChanges){let e=[];for(var r of t.docChanges)3!==r.type&&e.push(r);t=new fh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!e.fromCache||!this.Da()||(!this.options.qa||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){var t;return 0<e.docChanges.length||(t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites,!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges)}ka(e){e=fh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==ce.Cache}}class bh{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}class Ih{constructor(e){this.serializer=e}$s(e){return Fs(this.serializer,e)}Us(e){return e.metadata.exists?Gs(this.serializer,e.document,!1):R.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return V(e)}}class Th{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=Eh(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;var r;return e.Qa.namedQuery?this.Ka.push(e.Qa.namedQuery):e.Qa.documentMetadata?(this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t,r=S.fromString(e.Qa.documentMetadata.name),this.collectionGroups.add(r.get(r.length-2))):e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,r=new Ih(this.serializer);for(var n of e)if(n.metadata.queries){var i,s=r.$s(n.metadata.name);for(i of n.metadata.queries){var a=(t.get(i)||L()).add(s);t.set(i,a)}}return t}async ja(e){let t=await(async(e,r,t,n)=>{let i=e,s=L(),a=Si;for(var o of t){let e=r.$s(o.metadata.name),t=(o.document&&(s=s.add(e)),r.Us(o));t.setReadTime(r.Ks(o.metadata.readTime)),a=a.insert(e,t)}let u=i.Ns.newChangeBuffer({trackRemovals:!0}),h=await ru(i,(e=n,pi(di(S.fromString("__bundle__/docs/"+e)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>tu(t,u,a).next(e=>(u.apply(t),e)).next(e=>i.Pi.removeMatchingKeysForTargetId(t,h.targetId).next(()=>i.Pi.addMatchingKeys(t,s,h.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(t,e.ks,e.qs)).next(()=>e.ks)))})(e,new Ih(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(var n of this.Ka)await(async(e,r,n=L())=>{let i=await ru(e,pi(ua(r.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=V(r.readTime);return 0<=i.snapshotVersion.compareTo(t)?s.Ii.saveNamedQuery(e,r):(t=i.withResumeToken(N.EMPTY_BYTE_STRING,t),s.Ms=s.Ms.insert(t.targetId,t),s.Pi.updateTargetData(e,t).next(()=>s.Pi.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.Pi.addMatchingKeys(e,n,i.targetId)).next(()=>s.Ii.saveNamedQuery(e,r)))})})(e,n,r.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function Eh(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Sh{constructor(e){this.key=e}}class xh{constructor(e){this.key=e}}class Ch{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=L(),this.mutatedKeys=L(),this.eu=Ti(e),this.tu=new ch(this.eu)}get nu(){return this.Ya}ru(e,t){let a=t?t.iu:new dh,o=(t||this).tu,u=(t||this).mutatedKeys,h=o,l=!1,c="F"===this.query.limitType&&o.size===this.query.limit?o.last():null,d="L"===this.query.limitType&&o.size===this.query.limit?o.first():null;if(e.inorderTraversal((e,t)=>{var r=o.get(e),t=bi(this.query,t)?t:null,n=!!r&&this.mutatedKeys.has(r.key),i=!!t&&(t.hasLocalMutations||this.mutatedKeys.has(t.key)&&t.hasCommittedMutations);let s=!1;r&&t?r.data.isEqual(t.data)?n!==i&&(a.track({type:3,doc:t}),s=!0):!this.su(r,t)&&(a.track({type:2,doc:t}),s=!0,c&&0<this.eu(t,c)||d&&this.eu(t,d)<0)&&(l=!0):!r&&t?(a.track({type:0,doc:t}),s=!0):r&&!t&&(a.track({type:1,doc:r}),s=!0,c||d)&&(l=!0),s&&(u=t?(h=h.add(t),i?u.add(e):u.delete(e)):(h=h.delete(e),u.delete(e)))}),null!==this.query.limit)for(;h.size>this.query.limit;){var r="F"===this.query.limitType?h.last():h.first();h=h.delete(r.key),u=u.delete(r.key),a.track({type:1,doc:r})}return{tu:h,iu:a,Cs:l,mutatedKeys:u}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){var i=this.tu,s=(this.tu=e.tu,this.mutatedKeys=e.mutatedKeys,e.iu.ya()),t=(s.sort((e,t)=>{return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _(20277,{Rt:e})}})(r)-i(n)||this.eu(e.doc,t.doc);var r,n,i}),this.ou(r),n=n??!1,t&&!n?this._u():[]),n=0===this.Xa.size&&this.current&&!n?1:0,a=n!==this.Za;return this.Za=n,0!==s.length||a?{snapshot:new fh(this.query,e.tu,i,s,e.mutatedKeys,0==n,a,!1,!!r&&0<r.resumeToken.approximateByteSize()),au:t}:{au:t}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new dh,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let t=this.Xa,r=(this.Xa=L(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))}),[]);return t.forEach(e=>{this.Xa.has(e)||r.push(new xh(e))}),this.Xa.forEach(e=>{t.has(e)||r.push(new Sh(e))}),r}cu(e){this.Ya=e.Qs,this.Xa=L();e=this.ru(e.documents);return this.applyChanges(e,!0)}lu(){return fh.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}let Ah="SyncEngine";class Dh{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Nh{constructor(e){this.key=e,this.hu=!1}}class kh{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new Ei(e=>wi(e),vi),this.Iu=new Map,this.Eu=new Set,this.du=new A(x.comparator),this.Au=new Map,this.Ru=new Do,this.Vu={},this.mu=new Map,this.fu=to.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function Rh(e,t,r,n){var i=await ru(e.localStore,pi(t)),s=i.targetId,a=e.sharedClientState.addLocalQueryTarget(s,r);let o;return n&&(o=await Mh(e,t,s,"current"===a,i.resumeToken)),e.isPrimaryClient&&r&&Qu(e.remoteStore,i),o}async function Mh(r,e,t,n,i){r.pu=(e,s,t)=>(async(e,t,r)=>{let n=t.view.ru(s);n.Cs&&(n=await iu(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,n)));var i=r&&r.targetChanges.get(t.targetId),r=r&&null!=r.targetMismatches.get(t.targetId),i=t.view.applyChanges(n,e.isPrimaryClient,i,r);return Bh(e,t.targetId,i.au),i.snapshot})(r,e,t);var s=await iu(r.localStore,e,!0),a=new Ch(e,s.Qs),s=a.ru(s.documents),n=ws.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),s=a.applyChanges(s,r.isPrimaryClient,n),n=(Bh(r,t,s.au),new Dh(e,t,a));return r.Tu.set(e,n),r.Iu.has(t)?r.Iu.get(t).push(e):r.Iu.set(t,[e]),s.snapshot}async function Oh(e,t){let r=e;try{var n=await function(e,u){let h=e,l=u.snapshotVersion,c=h.Ms;return h.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{let e=h.Ns.newChangeBuffer({trackRemovals:!0}),o=(c=h.Ms,[]),t=(u.targetChanges.forEach((t,r)=>{var n,i,s=c.get(r);if(s){o.push(h.Pi.removeMatchingKeys(a,t.removedDocuments,r).next(()=>h.Pi.addMatchingKeys(a,t.addedDocuments,r)));let e=s.withSequenceNumber(a.currentSequenceNumber);null!==u.targetMismatches.get(r)?e=e.withResumeToken(N.EMPTY_BYTE_STRING,w.min()).withLastLimboFreeSnapshotVersion(w.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,l)),c=c.insert(r,e),s=s,n=e,i=t,(0===s.resumeToken.approximateByteSize()||n.snapshotVersion.toMicroseconds()-s.snapshotVersion.toMicroseconds()>=Yo||0<i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size)&&o.push(h.Pi.updateTargetData(a,e))}}),Si),r=L();var n;return u.documentUpdates.forEach(e=>{u.resolvedLimboDocuments.has(e)&&o.push(h.persistence.referenceDelegate.updateLimboDocument(a,e))}),o.push(tu(a,e,u.documentUpdates).next(e=>{t=e.ks,r=e.qs})),l.isEqual(w.min())||(n=h.Pi.getLastRemoteSnapshotVersion(a).next(e=>h.Pi.setTargetsMetadata(a,a.currentSequenceNumber,l)),o.push(n)),C.waitFor(o).next(()=>e.apply(a)).next(()=>h.localDocuments.getLocalViewOfDocuments(a,t,r)).next(()=>t)}).then(e=>(h.Ms=c,e))}(r.localStore,t);t.targetChanges.forEach((e,t)=>{t=r.Au.get(t);t&&(v(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),0<e.addedDocuments.size?t.hu=!0:0<e.modifiedDocuments.size?v(t.hu,14607):0<e.removedDocuments.size&&(v(t.hu,42227),t.hu=!1))}),await jh(r,n,t)}catch(e){await it(e)}}function Lh(e,i,t){if(e.isPrimaryClient&&0===t||!e.isPrimaryClient&&1===t){let r=[];e.Tu.forEach((e,t)=>{t=t.view.va(i);t.snapshot&&r.push(t.snapshot)});{t=e.eventManager;var s=i;t.onlineState=s;let n=!1;t.queries.forEach((e,t)=>{for(var r of t.Sa)r.va(s)&&(n=!0)}),n&&wh(t)}r.length&&e.Pu.H_(r),e.onlineState=i,e.isPrimaryClient&&e.sharedClientState.setOnlineState(i)}}function Ph(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function Vh(t,r,n){let i=t.Vu[t.currentUser.toKey()];if(i){let e=i.get(r);e&&(n?e.reject(n):e.resolve(),i=i.remove(r)),t.Vu[t.currentUser.toKey()]=i}}function Fh(t,e,r=null){t.sharedClientState.removeLocalQueryTarget(e);for(var n of t.Iu.get(e))t.Tu.delete(n),r&&t.Pu.yu(n,r);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(e=>{t.Ru.containsKey(e)||Uh(t,e)})}function Uh(e,t){e.Eu.delete(t.path.canonicalString());var r=e.du.get(t);null!==r&&($u(e.remoteStore,r),e.du=e.du.remove(t),e.Au.delete(r),qh(e))}function Bh(e,t,r){for(var n of r)n instanceof Sh?(e.Ru.addReference(n.key,t),i=e,a=n,s=void 0,s=a.key,a=s.path.canonicalString(),i.du.get(s)||i.Eu.has(a)||(m(Ah,"New document in limbo: "+s),i.Eu.add(a),qh(i))):n instanceof xh?(m(Ah,"Document no longer in limbo: "+n.key),e.Ru.removeReference(n.key,t),e.Ru.containsKey(n.key)||Uh(e,n.key)):_(19791,{wu:n});var i,s,a}function qh(e){for(;0<e.Eu.size&&e.du.size<e.maxConcurrentLimboResolutions;){var t=e.Eu.values().next().value,t=(e.Eu.delete(t),new x(S.fromString(t))),r=e.fu.next();e.Au.set(r,new Nh(t)),e.du=e.du.insert(t,r),Qu(e.remoteStore,new Zs(pi(di(t.path)),r,"TargetPurposeLimboResolution",wt.ce))}}async function jh(e,t,n){let i=e,s=[],a=[],o=[];if(!i.Tu.isEmpty()){i.Tu.forEach((e,r)=>{o.push(i.pu(r,t,n).then(e=>{var t;(e||n)&&i.isPrimaryClient&&(t=e?!e.fromCache:n?.targetChanges.get(r.targetId)?.current,i.sharedClientState.updateQueryState(r.targetId,t?"current":"not-current")),e&&(s.push(e),t=Qo.As(r.targetId,e),a.push(t))}))}),await Promise.all(o),i.Pu.H_(s);{var r,u=i.localStore,h=a;let n=u;try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>C.forEach(h,t=>C.forEach(t.Es,e=>n.persistence.referenceDelegate.addReference(r,t.targetId,e)).next(()=>C.forEach(t.ds,e=>n.persistence.referenceDelegate.removeReference(r,t.targetId,e)))))}catch(u){if(!ct(u))throw u;m(Wo,"Failed to update sequence numbers: "+u)}for(r of h){var l=r.targetId;if(!r.fromCache){let e=n.Ms.get(l),t=e.snapshotVersion,r=e.withLastLimboFreeSnapshotVersion(t);n.Ms=n.Ms.insert(l,r)}}}}}async function zh(e,t){var r,n,i=e,s=[],a=[];for(n of t){let e,t=i.Iu.get(n);if(t&&0!==t.length){e=await ru(i.localStore,pi(t[0]));for(var o of t){var o=i.Tu.get(o),u=(0,r=await iu((u=i).localStore,(o=o).query,!0),r=o.view.cu(r),u.isPrimaryClient&&Bh(u,o.targetId,r.au),await r);u.snapshot&&a.push(u.snapshot)}}else{var h=await su(i.localStore,n);e=await ru(i.localStore,h),await Mh(i,Gh(h),n,!1,e.resumeToken)}s.push(e)}return i.Pu.H_(a),s}function Gh(e){return ci(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Kh(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=Oh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,r){let n=e,t=n.Au.get(r);if(t&&t.hu)return L().add(t.key);{let e=L(),t=n.Iu.get(r);if(t)for(var i of t){i=n.Tu.get(i);e=e.unionWith(i.view.nu)}return e}}.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=async function(e,n,t){let i=e,r=(i.sharedClientState.updateQueryState(n,"rejected",t),i.Au.get(n)),s=r&&r.key;if(s){let e=new A(x.comparator),t=(e=e.insert(s,R.newNoDocument(s,w.min())),L().add(s)),r=new vs(w.min(),new Map,new A(b),e,t);await Oh(i,r),i.du=i.du.remove(s),i.Au.delete(n),qh(i)}else await nu(i.localStore,n,!1).then(()=>Fh(i,n,t)).catch(it)}.bind(null,e),e.Pu.H_=function(e,t){var r,n=e;let i=!1;for(r of t){let e=r.query,t=n.queries.get(e);if(t){for(var s of t.Sa)s.Fa(r)&&(i=!0);t.wa=r}}i&&wh(n)}.bind(null,e.eventManager),e.Pu.yu=function(e,t,r){var n=e.queries.get(t);if(n)for(var i of n.Sa)i.onError(r);e.queries.delete(t)}.bind(null,e.eventManager),e}function Qh(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=async function(e,t){var r=e,n=t.batch.batchId;try{var i=await function(e,n){let i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let t=n.batch.keys(),r=i.Ns.newChangeBuffer({trackRemovals:!0});return((e,t,n,i)=>{let s=n.batch,r=s.keys(),a=C.resolve();return r.forEach(r=>{a=a.next(()=>i.getEntry(t,r)).next(e=>{var t=n.docVersions.get(r);v(null!==t,48541),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument())&&(e.setReadTime(n.commitVersion),i.addEntry(e))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))})(i,e,n,r).next(()=>r.apply(e)).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,t,n.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,(t=>{let r=L();for(let e=0;e<t.mutationResults.length;++e)0<t.mutationResults[e].transformResults.length&&(r=r.add(t.batch.mutations[e].key));return r})(n))).next(()=>i.localDocuments.getDocuments(e,t))})}(r.localStore,t);Vh(r,n,null),Ph(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await jh(r,i)}catch(e){await it(e)}}.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=async function(e,t,r){try{var n=await((e,n)=>{let i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let r;return i.mutationQueue.lookupMutationBatch(t,n).next(e=>(v(null!==e,37113),r=e.keys(),i.mutationQueue.removeMutationBatch(t,e))).next(()=>i.mutationQueue.performConsistencyCheck(t)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(t,r,n)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r)).next(()=>i.localDocuments.getDocuments(t,r))})})(e.localStore,t);Vh(e,t,r),Ph(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await jh(e,n)}catch(r){await it(r)}}.bind(null,e),e}class $h{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ou(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Xo(this.persistence,new Ho,e.initialUser,this.serializer)}Cu(e){return new Oo(Po.mi,this.serializer)}Du(e){return new bu}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}$h.provider={build:()=>new $h};class Hh extends $h{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){v(this.persistence.referenceDelegate instanceof Vo,46915);var r=this.persistence.referenceDelegate.garbageCollector;return new ho(r,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?$a.withCacheSize(this.cacheSizeBytes):$a.DEFAULT;return new Oo(e=>Vo.mi(e,t),this.serializer)}}class Wh extends $h{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Qh(this.xu.syncEngine),await rh(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return Xo(this.persistence,new Ho,e.initialUser,this.serializer)}Fu(e,t){var r=this.persistence.referenceDelegate.garbageCollector;return new ho(r,e.asyncQueue,t)}Mu(e,t){t=new vt(t,this.persistence);return new yt(e.asyncQueue,t)}Cu(e){var t=Ko(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?$a.withCacheSize(this.cacheSizeBytes):$a.DEFAULT;return new jo(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Ru(),Mu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new bu}}class Yh extends Wh{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);e=this.xu.syncEngine;this.sharedClientState instanceof _u&&(this.sharedClientState.syncEngine={Co:async function(e,t,r,n){var i=await((e,r)=>{let n=e,i=n.mutationQueue;return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.er(t,r).next(e=>e?n.localDocuments.getDocuments(t,e):C.resolve(null)))})(e.localStore,t);null!==i?("pending"===r?await rh(e.remoteStore):"acknowledged"===r||"rejected"===r?(Vh(e,t,n||null),Ph(e,t),e.localStore.mutationQueue.ir(t)):_(6720,"Unknown batchState",{Su:r}),await jh(e,i)):m(Ah,"Cannot apply mutation batch with id: "+t)}.bind(null,e),vo:async function(e,t,r,n){var i=e;if(i.gu)m(Ah,"Ignoring unexpected query state notification.");else{var s=i.Iu.get(t);if(s&&0<s.length)switch(r){case"current":case"not-current":await jh(i,await au(i.localStore,Ii(s[0])),vs.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,N.EMPTY_BYTE_STRING));break;case"rejected":await nu(i.localStore,t,!0),Fh(i,t,n);break;default:_(64155,r)}}}.bind(null,e),Fo:async function(e,t,r){let n=Kh(e);if(n.gu){for(var i of t){var s;n.Iu.has(i)&&n.sharedClientState.isActiveQueryTarget(i)?m(Ah,"Adding an already active target "+i):(i=await su(n.localStore,i),s=await ru(n.localStore,i),await Mh(n,Gh(i),s.targetId,!1,s.resumeToken),Qu(n.remoteStore,s))}for(let e of r)n.Iu.has(e)&&await nu(n.localStore,e,!1).then(()=>{$u(n.remoteStore,e),Fh(n,e)}).catch(it)}}.bind(null,e),Ts:function(e){return e.localStore.persistence.Ts()}.bind(null,e),Do:async function(e,t){let r=e;return au(r.localStore,t).then(e=>jh(r,e))}.bind(null,e)},await this.sharedClientState.start()),await this.persistence.Ji(async e=>{{var t=e;let i=this.xu.syncEngine;if(Kh(i),Qh(i),!0===t&&!0!==i.gu){let e=i.sharedClientState.getAllActiveQueryTargets(),t=await zh(i,e.toArray());i.gu=!0,await ah(i.remoteStore,!0);for(var r of t)Qu(i.remoteStore,r)}else if(!1===t&&!1!==i.gu){let r=[],n=Promise.resolve();i.Iu.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(Fh(i,t),nu(i.localStore,t,!0))),$u(i.remoteStore,t)}),await n,await zh(i,r);{let r=t=i;r.Au.forEach((e,t)=>{$u(r.remoteStore,t)}),r.Ru.Jr(),r.Au=new Map,r.du=new A(x.comparator)}i.gu=!1,await ah(i.remoteStore,!1)}}await 0,this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){var t,r=Ru();if(_u.v(r))return t=Ko(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),new _u(r,e.asyncQueue,t,e.clientId,e.initialUser);throw new E(T.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.")}}class Jh{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Lh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=async function(e,t){var r,n;e.currentUser.isEqual(t)||(m(Ah,"User change. New user:",t.toKey()),n=await Zo(e.localStore,t),e.currentUser=t,(r=e).mu.forEach(e=>{e.forEach(e=>{e.reject(new E(T.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.mu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await jh(e,n.Ls))}.bind(null,this.syncEngine),await ah(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new mh}createDatastore(e){var t=Ou(e.databaseInfo.databaseId),r=(n=e.databaseInfo,new ku(n)),n=e.authCredentials;return e=e.appCheckCredentials,r=r,t=t,new Bu(n,e,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,e=e.asyncQueue,n=e=>Lh(this.syncEngine,e,0),i=new(Eu.v()?Eu:Iu),new zu(t,r,e,n,i);var t,r,n,i}createSyncEngine(e,t){return a=this.localStore,r=this.remoteStore,n=this.eventManager,i=this.sharedClientState,s=e.initialUser,e=e.maxConcurrentLimboResolutions,a=new kh(a,r,n,i,s,e),t&&(a.gu=!0),a;var r,n,i,s,a}async terminate(){var e=this.remoteStore;m(ju,"RemoteStore shutting down."),e.Ea.add(5),await Ku(e),e.Aa.shutdown(),await!e.Ra.set("Unknown"),this.datastore?.terminate(),this.eventManager?.terminate()}}function Xh(t,r=10240){let n=0;return{async read(){var e;return n<t.byteLength?(e={value:t.slice(n,n+r),done:!1},n+=r,e):{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}Jh.provider={build:()=>new Jh};class Zh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):d("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class el{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new f,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.$a()?this.metadata.resolve(e.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             `+JSON.stringify(e?.Qa)))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){var e,t,r=await this.qu();return null===r?null:(t=this.Lu.decode(r),e=Number(t),isNaN(e)&&this.Qu(`length string (${t}) is not valid number`),t=await this.$u(e),new bh(JSON.parse(t),r.length+e))}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););var e,t;return 0===this.buffer.length?null:((e=this.Uu())<0&&this.Qu("Reached the end of bundle when a length string is expected."),t=this.buffer.slice(0,e),this.buffer=this.buffer.slice(e),t)}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");var t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error("Invalid bundle format: "+e)}async Ku(){var e,t=await this.Bu.read();return t.done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),t.done}}class tl{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw this.lastTransactionError=new E(T.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;e=await(async(e,t)=>{let u=e,r={documents:t.map(e=>Vs(u.serializer,e))},n=await u.Ho("BatchGetDocuments",u.serializer.databaseId,S.emptyPath(),r,t.length),h=new Map,i=(n.forEach(e=>{var t,r,n,i,s,a,t=u.serializer,o="found"in e?(r=t,v(!!(n=e).found,43571),n.found.name,n.found.updateTime,i=Fs(r,n.found.name),s=V(n.found.updateTime),o=n.found.createTime?V(n.found.createTime):w.min(),a=new Pn({mapValue:{fields:n.found.fields}}),R.newFoundDocument(i,s,o,a)):"missing"in e?(r=t,v(!!(n=e).missing,3894),v(!!n.readTime,22933),i=Fs(r,n.missing),s=V(n.readTime),R.newNoDocument(i,s)):_(7234,{result:e});h.set(o.key.toString(),o)}),[]);return t.forEach(e=>{var t=h.get(e.toString());v(!!t,55234,{key:e}),i.push(t)}),i})(this.datastore,e);return e.forEach(e=>this.recordVersion(e)),e}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new is(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{t=x.fromPath(t);this.mutations.push(new ss(t,this.precondition(t)))});{var r=this.datastore,n=this.mutations;let t=r,e={writes:n.map(e=>Ks(t.serializer,e))};await t.Go("Commit",t.serializer.databaseId,S.emptyPath(),e)}await 0,this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw _(50498,{Gu:e.constructor.name});t=w.min()}var r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new E(T.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(w.min())?P.exists(!1):P.updateTime(t):P.none()}preconditionForUpdate(e){var t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return P.exists(!0);if(t.isEqual(w.min()))throw new E(T.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return P.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class rl{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.zu=r.maxAttempts,this.M_=new Lu(this.asyncQueue,"transaction_retry")}ju(){--this.zu,this.Ju()}Ju(){this.M_.p_(async()=>{let t=new tl(this.datastore),e=this.Hu(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.Yu(e)}))}).catch(e=>{this.Yu(e)})})}Hu(e){try{var t=this.updateFunction(e);return!bt(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Yu(e){0<this.zu&&this.Zu(e)?(--this.zu,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){return"FirebaseError"===e?.name&&("aborted"===(e=e.code)||"failed-precondition"===e||"already-exists"===e||!ls(e))}}let nl="FirestoreClient";class il{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=u.UNAUTHENTICATED,this.clientId=Ae.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{m(nl,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(m(nl,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let r=new f;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),r.resolve()}catch(e){var t=lh(e,"Failed to shutdown persistence");r.reject(t)}}),r.promise}}async function sl(e,t){e.asyncQueue.verifyOperationInProgress(),m(nl,"Initializing OfflineComponentProvider");var r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await Zo(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function al(e,r){e.asyncQueue.verifyOperationInProgress();var t=await ol(e);m(nl,"Initializing OnlineComponentProvider"),await r.initialize(t,e.configuration),e.setCredentialChangeListener(e=>sh(r.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>sh(r.remoteStore,t)),e._onlineComponents=r}async function ol(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){m(nl,"Using user provided OfflineComponentProvider");try{await sl(t,t._uninitializedComponentsProvider._offline)}catch(e){var r=e;if(!("FirebaseError"===(n=r).name?n.code===T.FAILED_PRECONDITION||n.code===T.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw r;ye("Error using user provided cache. Falling back to memory cache: "+r),await sl(t,new $h)}}else m(nl,"Using default OfflineComponentProvider"),await sl(t,new Hh(void 0));var n;return t._offlineComponents}async function ul(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(m(nl,"Using user provided OnlineComponentProvider"),await al(e,e._uninitializedComponentsProvider._online)):(m(nl,"Using default OnlineComponentProvider"),await al(e,new Jh))),e._onlineComponents}function hl(e){return ol(e).then(e=>e.persistence)}function ll(e){return ol(e).then(e=>e.localStore)}function cl(e){return ul(e).then(e=>e.remoteStore)}function dl(e){return ul(e).then(e=>e.syncEngine)}async function fl(e){var e=await ul(e),t=e.eventManager;return t.onListen=async function(e,t,r=!0){var e=Kh(e),n=e.Tu.get(t);return n?(e.sharedClientState.addLocalQueryTarget(n.targetId),n.view.lu()):await Rh(e,t,r,!0)}.bind(null,e.syncEngine),t.onUnlisten=async function(e,t,r){let n=e,i=n.Tu.get(t),s=n.Iu.get(i.targetId);1<s.length?(n.Iu.set(i.targetId,s.filter(e=>!vi(e,t))),n.Tu.delete(t)):n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await nu(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&$u(n.remoteStore,i.targetId),Fh(n,i.targetId)}).catch(it)):(Fh(n,i.targetId),await nu(n.localStore,i.targetId,!0))}.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=async function(e,t){await Rh(Kh(e),t,!0,!1)}.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=async function(e,t){var t=e.Tu.get(t),r=e.Iu.get(t.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(t.targetId),$u(e.remoteStore,t.targetId))}.bind(null,e.syncEngine),t}function gl(e,t,h={}){let l=new f;return e.asyncQueue.enqueueAndForget(async()=>{{var i=await fl(e),s=e.asyncQueue,a=t,o=h,u=l;let r=new Zh({next:e=>{r.Nu(),s.enqueueAndForget(()=>vh(i,n));var t=e.docs.has(a);!t&&e.fromCache?u.reject(new E(T.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&o&&"server"===o.source?u.reject(new E(T.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(e)},error:e=>u.reject(e)}),n=new _h(di(a.path),r,{includeMetadataChanges:!0,qa:!0});return yh(i,n)}}),l.promise}function ml(o,u,h={}){let l=new f;return o.asyncQueue.enqueueAndForget(async()=>{{var n=await fl(o),i=o.asyncQueue,e=u,s=h,a=l;let t=new Zh({next:e=>{t.Nu(),i.enqueueAndForget(()=>vh(n,r)),e.fromCache&&"server"===s.source?a.reject(new E(T.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):a.resolve(e)},error:e=>a.reject(e)}),r=new _h(e,t,{includeMetadataChanges:!0,qa:!0});return yh(n,r)}}),l.promise}function pl(i,e,t,s){e=Ou(e),t=(e=>{if(e instanceof Uint8Array)return Xh(e,void 0);if(e instanceof ArrayBuffer)return Xh(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})("string"==typeof t?ds().encode(t):t);let a=new el(t,e);i.asyncQueue.enqueueAndForget(async()=>{{var e=await dl(i),r=a,n=s;let t=e;return void(async(t,r,n)=>{try{var i=await r.getMetadata();if(await((e,t)=>{let r=e,n=V(t.createTime);return r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.Ii.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(n))})(t.localStore,i))return await r.close(),n._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);n._updateProgress(Eh(i));var s=new Th(i,r.serializer);let e=await r.bu();for(;e;){var a=await s.Ga(e);a&&n._updateProgress(a),e=await r.bu()}var o=await s.ja(t.localStore);return await jh(t,o.Ha,void 0),await((e,t)=>{let r=e;return r.persistence.runTransaction("Save bundle","readwrite",e=>r.Ii.saveBundleMetadata(e,t))})(t.localStore,i),n._completeWith(o.progress),Promise.resolve(o.Ja)}catch(t){return ye(Ah,"Loading bundle failed with "+t),n._failWith(t),Promise.resolve(new Set)}})(t,r,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})}})}function yl(e){var t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let vl=new Map,wl="firestore.googleapis.com";class _l{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new E(T.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=wl,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new E(T.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Ue("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yl(e.experimentalLongPollingOptions??{});var t=this.experimentalLongPollingOptions;if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new E(T.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new E(T.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(30<t.timeoutSeconds)throw new E(T.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,r}}class bl{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new _l({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(this._app)return this._app;throw new E(T.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available")}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new E(T.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new _l(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=(e=>{if(!e)return new be;switch(e.type){case"firstParty":return new Se(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new E(T.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(e=vl.get(this))&&(m("ComponentProvider","Removing Datastore"),vl.delete(this),e.terminate()),Promise.resolve();var e}}class Il{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Il(this.firestore,e,this._query)}}class F{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Tl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new F(this.firestore,e,this._key)}toJSON(){return{type:F._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Ke(t,F._jsonSchema))return new F(e,r||null,new x(S.fromString(t.referencePath)))}}F._jsonSchemaVersion="firestore/documentReference/1.0",F._jsonSchema={type:e("string",F._jsonSchemaVersion),referencePath:e("string")};class Tl extends Il{constructor(e,t,r){super(e,t,di(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){var e=this._path.popLast();return e.isEmpty()?null:new F(this.firestore,null,new x(e))}withConverter(e){return new Tl(this.firestore,e,this._path)}}function El(e,t,...r){var n;if(e=I(e),Fe("collection","path",t),e instanceof bl)return qe(n=S.fromString(t,...r)),new Tl(e,null,n);if(e instanceof F||e instanceof Tl)return qe(n=e._path.child(S.fromString(t,...r))),new Tl(e.firestore,null,n);throw new E(T.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore")}function Sl(e,t,...r){var n;if(e=I(e),Fe("doc","path",t=1===arguments.length?Ae.newId():t),e instanceof bl)return Be(n=S.fromString(t,...r)),new F(e,null,new x(n));if(e instanceof F||e instanceof Tl)return Be(n=e._path.child(S.fromString(t,...r))),new F(e.firestore,e instanceof Tl?e.converter:null,new x(n));throw new E(T.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore")}function xl(e,t){return e=I(e),t=I(t),(e instanceof F||e instanceof Tl)&&(t instanceof F||t instanceof Tl)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Cl(e,t){return e=I(e),t=I(t),e instanceof Il&&t instanceof Il&&e.firestore===t.firestore&&vi(e._query,t._query)&&e.converter===t.converter}let Al="AsyncQueue";class Dl{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Lu(this,"async_queue_retry"),this._c=()=>{var e=Mu();e&&m(Al,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;e=Mu();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){this.ec||(this.ec=!0,this.sc=e||!1,(e=Mu())&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._c))}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new f;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ct(e))throw e;m(Al,"Operation failed with retryable error: "+e)}0<this.Xu.length&&this.M_.p_(()=>this.lc())}}cc(e){var t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,d("INTERNAL UNHANDLED ERROR: ",Nl(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t}enqueueAfterDelay(e,t,r){this.uc(),-1<this.oc.indexOf(e)&&(t=0);e=hh.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(e),e}uc(){this.nc&&_(47125,{Pc:Nl(this.nc)})}verifyOperationInProgress(){}async Tc(){for(var e;await(e=this.ac),e!==this.ac;);}Ic(e){for(var t of this.tc)if(t.timerId===e)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(var e of this.tc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){e=this.tc.indexOf(e);this.tc.splice(e,1)}}function Nl(e){let t=e.message||"";return t=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:t}function kl(e){var t=e,e=["next","error","complete"];if("object"==typeof t&&null!==t){var r,n=t;for(r of e)if(r in n&&"function"==typeof n[r])return 1}}class Rl{constructor(){this._progressObserver={},this._taskCompletionResolver=new f,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class U extends bl{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new Dl,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){var e;this._firestoreClient&&(e=this._firestoreClient.terminate(),this._queue=new Dl(e),this._firestoreClient=void 0,await e)}}function Ml(e){if(e._terminated)throw new E(T.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||Ol(e),e._firestoreClient}function Ol(e){var t,r,n,i=e._freezeSettings(),s=(n=e._databaseId,s=e._app?.options.appId||"",t=e._persistenceKey,r=i,new un(n,s,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,yl(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator));e._componentsProvider||i.localCache?._offlineComponentProvider&&i.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new il(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&(i=(n=e._componentsProvider)?._online.build(),{_offline:n?._offline.build(i),_online:i}))}function Ll(e,t,r){if((e=p(e,U))._firestoreClient||e._terminated)throw new E(T.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new E(T.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:r},Ol(e)}class Pl{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Pl(N.fromBase64String(e))}catch(e){throw new E(T.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Pl(N.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Pl._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ke(e,Pl._jsonSchema))return Pl.fromBase64String(e.bytes)}}Pl._jsonSchemaVersion="firestore/bytes/1.0",Pl._jsonSchema={type:e("string",Pl._jsonSchemaVersion),bytes:e("string")};class Vl{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new E(T.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new l(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Fl{constructor(e){this._methodName=e}}class Ul{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new E(T.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new E(T.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return b(this._lat,e._lat)||b(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ul._jsonSchemaVersion}}static fromJSON(e){if(Ke(e,Ul._jsonSchema))return new Ul(e.latitude,e.longitude)}}Ul._jsonSchemaVersion="firestore/geoPoint/1.0",Ul._jsonSchema={type:e("string",Ul._jsonSchemaVersion),latitude:e("number"),longitude:e("number")};class Bl{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){var t=this._values,r=e._values;if(t.length!==r.length)return!1;for(let e=0;e<t.length;++e)if(t[e]!==r[e])return!1;return!0}toJSON(){return{type:Bl._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ke(e,Bl._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Bl(e.vectorValues);throw new E(T.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Bl._jsonSchemaVersion="firestore/vectorValue/1.0",Bl._jsonSchema={type:e("string",Bl._jsonSchemaVersion),vectorValues:e("object")};let ql=/^__.*__$/;class jl{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new es(e,this.data,this.fieldMask,t,this.fieldTransforms):new Zi(e,this.data,t,this.fieldTransforms)}}class zl{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new es(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Gl(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw _(40011,{Ac:e})}}class Kl{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Kl({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var t=this.path?.child(e);return(t=this.Vc({path:t,fc:!1})).gc(e),t}yc(e){e=this.path?.child(e);return(e=this.Vc({path:e,fc:!1})).Rc(),e}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return cc(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(Gl(this.Ac)&&ql.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Ql{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ou(e)}Cc(e,t,r,n=!1){return new Kl({Ac:e,methodName:t,Dc:r,path:l.emptyPath(),fc:!1,bc:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function $l(e){var t=e._freezeSettings(),r=Ou(e._databaseId);return new Ql(e._databaseId,!!t.ignoreUndefinedProperties,r)}function Hl(e,t,r,n,i,s={}){var a=e.Cc(s.merge||s.mergeFields?2:0,t,r,i),e=(oc("Data must be an object, but it was:",a,n),sc(n,a));let o,u;if(s.merge)o=new Wr(a.fieldMask),u=a.fieldTransforms;else if(s.mergeFields){let e=[];for(var h of s.mergeFields){h=uc(t,h,r);if(!a.contains(h))throw new E(T.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);dc(e,h)||e.push(h)}o=new Wr(e),u=a.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,u=a.fieldTransforms;return new jl(new Pn(e),o,u)}class Wl extends Fl{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(this._methodName+"() can only appear at the top level of your update data"):e.Sc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Wl}}function Yl(e,t,r){return new Kl({Ac:3,Dc:t.settings.Dc,methodName:e._methodName,fc:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class Jl extends Fl{_toFieldTransform(e){return new Qi(e.path,new Fi)}isEqual(e){return e instanceof Jl}}class Xl extends Fl{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=Yl(this,e,!0),r=this.vc.map(e=>ic(e,t)),n=new Ui(r);return new Qi(e.path,n)}isEqual(e){return e instanceof Xl&&re(this.vc,e.vc)}}class Zl extends Fl{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=Yl(this,e,!0),r=this.vc.map(e=>ic(e,t)),n=new qi(r);return new Qi(e.path,n)}isEqual(e){return e instanceof Zl&&re(this.vc,e.vc)}}class ec extends Fl{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){var t=new zi(e.serializer,Li(e.serializer,this.Fc));return new Qi(e.path,t)}isEqual(e){return e instanceof ec&&this.Fc===e.Fc}}function tc(e,n,i,t){let s=e.Cc(1,n,i),a=(oc("Data must be an object, but it was:",s,t),[]),o=Pn.empty();zr(t,(e,t)=>{var e=lc(n,e,i),r=(t=I(t),s.yc(e));t instanceof Wl?a.push(e):null!=(t=ic(t,r))&&(a.push(e),o.set(e,t))});e=new Wr(a);return new zl(o,e,s.fieldTransforms)}function rc(e,t,r,n,i,s){var a=e.Cc(1,t,r),o=[uc(t,n,r)],u=[i];if(s.length%2!=0)throw new E(T.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(uc(t,s[e])),u.push(s[e+1]);var h,l,c,d=[],f=Pn.empty();for(let e=o.length-1;0<=e;--e)dc(d,o[e])||(h=o[e],c=I(u[e]),l=a.yc(h),c instanceof Wl?d.push(h):null!=(c=ic(c,l))&&(d.push(h),f.set(h,c)));e=new Wr(d);return new zl(f,e,a.fieldTransforms)}function nc(e,t,r,n=!1){return ic(r,e.Cc(n?4:3,t))}function ic(e,r){if(ac(e=I(e)))return oc("Unsupported field value:",r,e),sc(e,r);if(e instanceof Fl){var t=e;if(!Gl((o=r).Ac))throw o.Sc(t._methodName+"() can only be used with update() and set()");if(o.path)return(u=t._toFieldTransform(o))&&o.fieldTransforms.push(u),null;throw o.Sc(t._methodName+"() is not currently supported inside arrays")}if(void 0===e&&r.ignoreUndefinedProperties)return null;if(r.path&&r.fieldMask.push(r.path),e instanceof Array){if(r.settings.fc&&4!==r.Ac)throw r.Sc("Nested arrays are not supported");{var n,i=r,s=[];let t=0;for(n of e){let e=ic(n,i.wc(t));null==e&&(e={nullValue:"NULL_VALUE"}),s.push(e),t++}return{arrayValue:{values:s}}}}var a,o=r;if(null===(t=I(t=e)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Li(o.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date)return h=y.fromDate(t),{timestampValue:Rs(o.serializer,h)};if(t instanceof y)return h=new y(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Rs(o.serializer,h)};if(t instanceof Ul)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Pl)return{bytesValue:Ms(o.serializer,t._byteString)};if(t instanceof F){var u,h=o.databaseId;if((u=t.firestore._databaseId).isEqual(h))return{referenceValue:Os(t.firestore._databaseId||o.databaseId,t._key.path)};throw o.Sc(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${h.projectId}/`+h.database)}if(t instanceof Bl)return e=t,a=o,{mapValue:{fields:{[cn]:{stringValue:gn},[mn]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw a.Sc("VectorValues must only contain numeric values.");return Mi(a.serializer,e)})}}}}};throw o.Sc("Unsupported field value: "+ze(t))}function sc(e,r){let n={};return Gr(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):zr(e,(e,t)=>{t=ic(t,r.mc(e));null!=t&&(n[e]=t)}),{mapValue:{fields:n}}}function ac(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof y||e instanceof Ul||e instanceof Pl||e instanceof F||e instanceof Fl||e instanceof Bl)}function oc(e,t,r){if(!ac(r)||!je(r))throw"an object"===(r=ze(r))?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}function uc(e,t,r){if((t=I(t))instanceof Vl)return t._internalPath;if("string"==typeof t)return lc(e,t);throw cc("Field path arguments must be of type string or ",e,!1,void 0,r)}let hc=new RegExp("[~\\*/\\[\\]]");function lc(t,r,n){if(0<=r.search(hc))throw cc(`Invalid field path (${r}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Vl(...r.split("."))._internalPath}catch(e){throw cc(`Invalid field path (${r}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function cc(e,t,r,n,i){var s=n&&!n.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`,u=(r&&(o+=" (via `toFirestore()`)"),o+=". ","");return(s||a)&&(u+=" (found",s&&(u+=" in field "+n),a&&(u+=" in document "+i),u+=")"),new E(T.INVALID_ARGUMENT,o+e+u)}function dc(e,t){return e.some(e=>e.isEqual(t))}class fc{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new F(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){var e;if(this._document)return this._converter?(e=new gc(this._firestore,this._userDataWriter,this._key,this._document,null),this._converter.fromFirestore(e)):this._userDataWriter.convertValue(this._document.data.value)}get(e){if(this._document){e=this._document.data.field(mc("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e)}}}class gc extends fc{data(){return super.data()}}function mc(e,t){return"string"==typeof t?lc(e,t):(t instanceof Vl?t:t._delegate)._internalPath}function pc(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new E(T.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class yc{}class vc extends yc{}function wc(e,t,...r){let n=[];t instanceof yc&&n.push(t);var i,r=(t=n=n.concat(r)).filter(e=>!1).length,t=t.filter(e=>e instanceof _c).length;if(1<r||0<r&&0<t)throw new E(T.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.");for(i of n)e=i._apply(e);return e}class _c extends vc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new _c(e,t,r)}_apply(e){var t=this._parse(e),r=e._query,n=t;if(null!==(r=((e,t)=>{for(var r of e)for(var n of r.getFlattenedFilters())if(0<=t.indexOf(n.op))return n.op;return null})(r.filters,(()=>{switch(n.op){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})())))throw r===n.op?new E(T.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${n.op.toString()}' filter.`):new E(T.INVALID_ARGUMENT,`Invalid query. You cannot use '${n.op.toString()}' filters with '${r.toString()}' filters.`);return new Il(e.firestore,e.converter,(r=e._query,e=t,e=r.filters.concat([t]),new li(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)))}_parse(e){var r=$l(e.firestore);{var n=e._query,i=e.firestore._databaseId,s=(e=this._field,this._op),a=this._value;let t;if(e.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new E(T.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Cc(a,s);let e=[];for(var o of a)e.push(xc(i,n,o));t={arrayValue:{values:e}}}else t=xc(i,n,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Cc(a,s),t=nc(r,"where",a,"in"===s||"not-in"===s);return M.create(e,s,t)}}}(class{[yc](){}});class bc extends vc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new bc(e,t)}_apply(e){var t=((e,t,r)=>{if(null!==e.startAt)throw new E(T.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new E(T.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Bn(t,r)})(e._query,this._field,this._direction);return new Il(e.firestore,e.converter,(t=(e=e._query).explicitOrderBy.concat([t]),new li(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class Ic extends vc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Ic(e,t,r)}_apply(e){return new Il(e.firestore,e.converter,yi(e._query,this._limit,this._limitType))}}class Tc extends vc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Tc(e,t,r)}_apply(e){var t=Sc(e,this.type,this._docOrFields,this._inclusive);return new Il(e.firestore,e.converter,(e=e._query,t=t,new li(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)))}}class Ec extends vc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ec(e,t,r)}_apply(e){var t=Sc(e,this.type,this._docOrFields,this._inclusive);return new Il(e.firestore,e.converter,(e=e._query,t=t,new li(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)))}}function Sc(e,t,r,n){if(r[0]=I(r[0]),r[0]instanceof fc){var i=e._query,s=e.firestore._databaseId,a=t,o=r[0]._document,u=n;if(!o)throw new E(T.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);var h,l=[];for(h of mi(i))if(h.field.isKeyField())l.push(En(s,o.key));else{var c,d=o.data.field(h.field);if(sn(d))throw new E(T.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===d)throw c=h.field.canonicalString(),new E(T.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${c}' (used as the orderBy) does not exist.`);l.push(d)}return new Vn(l,u)}var i=$l(e.firestore),f=e._query,g=e.firestore._databaseId,m=i,p=t,y=r,a=n,v=f.explicitOrderBy;if(y.length>v.length)throw new E(T.INVALID_ARGUMENT,`Too many arguments provided to ${p}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);var w=[];for(let e=0;e<y.length;e++){var _=y[e];if(v[e].field.isKeyField()){if("string"!=typeof _)throw new E(T.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${p}(), but got a `+typeof _);if(!gi(f)&&-1!==_.indexOf("/"))throw new E(T.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${p}() must be a plain document ID, but '${_}' contains a slash.`);var b=f.path.child(S.fromString(_));if(!x.isDocumentKey(b))throw new E(T.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${p}() must result in a valid document path, but '${b}' is not because it contains an odd number of segments.`);b=new x(b);w.push(En(g,b))}else{b=nc(m,p,_);w.push(b)}}return new Vn(w,a)}function xc(e,t,r){if("string"==typeof(r=I(r))){if(""===r)throw new E(T.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gi(t)&&-1!==r.indexOf("/"))throw new E(T.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);t=t.path.child(S.fromString(r));if(x.isDocumentKey(t))return En(e,new x(t));throw new E(T.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${t}' is not because it has an odd number of segments (${t.length}).`)}if(r instanceof F)return En(e,r._key);throw new E(T.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ze(r)}.`)}function Cc(e,t){if(!Array.isArray(e)||0===e.length)throw new E(T.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}class Ac{convertValue(e,t="none"){switch(yn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return k(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Zr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw _(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,r="none"){let n={};return zr(e,(e,t)=>{n[e]=this.convertValue(t,r)}),n}convertVectorValue(e){e=e.fields?.[mn].arrayValue?.values?.map(e=>k(e.doubleValue));return new Bl(e)}convertGeoPoint(e){return new Ul(k(e.latitude),k(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var r=an(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(on(e));default:return null}}convertTimestamp(e){e=Xr(e);return new y(e.seconds,e.nanos)}convertDocumentKey(e,t){v(Xs(r=S.fromString(e)),9688,{name:e});var e=new ln(r.get(1),r.get(3)),r=new x(r.popFirst(5));return e.isEqual(t)||d(`Document ${r} contains a document reference within a different database (${e.projectId}/${e.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}function Dc(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class Nc extends Ac{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pl(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new F(this.firestore,null,e)}}class kc{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Rc extends fc{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){var t;if(this._document)return this._converter?(t=new Mc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null),this._converter.fromFirestore(t,e)):this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}get(e,t={}){if(this._document){e=this._document.data.field(mc("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new E(T.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");var e=this._document,t={};return t.type=Rc._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED")),t}}Rc._jsonSchemaVersion="firestore/documentSnapshot/1.0",Rc._jsonSchema={type:e("string",Rc._jsonSchemaVersion),bundleSource:e("string","DocumentSnapshot"),bundleName:e("string"),bundle:e("string")};class Mc extends Rc{data(e={}){return super.data(e)}}class Oc{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new kc(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,r){this._snapshot.docs.forEach(e=>{t.call(r,new Mc(this._firestore,this._userDataWriter,e.key,e,new kc(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){e=!!e.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new E(T.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=((s,t)=>{if(s._snapshot.oldDocs.isEmpty()){let r=0;return s._snapshot.docChanges.map(e=>{var t=new Mc(s._firestore,s._userDataWriter,e.doc.key,e.doc,new kc(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:r++}})}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new Mc(s._firestore,s._userDataWriter,e.doc.key,e.doc,new kc(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let r=-1,n=-1;return 0!==e.type&&(r=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),n=i.indexOf(e.doc.key)),{type:(e=>{switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _(61501,{type:e})}})(e.type),doc:t,oldIndex:r,newIndex:n}})}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new E(T.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");var e={};e.type=Oc._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ae.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,"NOT SUPPORTED"),e}}function Lc(e,t){return e instanceof Rc&&t instanceof Rc?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Oc&&t instanceof Oc&&e._firestore===t._firestore&&Cl(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}Oc._jsonSchemaVersion="firestore/querySnapshot/1.0",Oc._jsonSchema={type:e("string",Oc._jsonSchemaVersion),bundleSource:e("string","QuerySnapshot"),bundleName:e("string"),bundle:e("string")};class Pc extends Ac{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pl(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new F(this.firestore,null,e)}}function Vc(e,t,r){e=p(e,F);var n=p(e.firestore,U),t=Dc(e.converter,t,r);return Bc(n,[Hl($l(n),"setDoc",e._key,t,null!==e.converter,r).toMutation(e._key,P.none())])}function Fc(e,t,r,...n){e=p(e,F);var i=p(e.firestore,U),s=$l(i);return Bc(i,[("string"==typeof(t=I(t))||t instanceof Vl?rc(s,"updateDoc",e._key,t,r,n):tc(s,"updateDoc",e._key,t)).toMutation(e._key,P.exists(!0))])}function Uc(n,...i){n=I(n);let e={includeMetadataChanges:!1,source:"default"},s=0,r={includeMetadataChanges:(e="object"!=typeof i[s]||kl(i[s])?e:i[s++]).includeMetadataChanges,source:e.source};if(kl(i[s])){let e=i[s];i[s]=e.next?.bind(e),i[s+1]=e.error?.bind(e),i[s+2]=e.complete?.bind(e)}let a,o,u;if(n instanceof F)o=p(n.firestore,U),u=di(n._key.path),a={next:e=>{i[s]&&i[s](qc(o,n,e))},error:i[s+1],complete:i[s+2]};else{let t=p(n,Il),r=(o=p(t.firestore,U),u=t._query,new Pc(o));a={next:e=>{i[s]&&i[s](new Oc(o,r,t,e))},error:i[s+1],complete:i[s+2]},pc(n._query)}{var h=Ml(o),l=u,c=r,d=a;let e=new Zh(d),t=new _h(l,e,c);return h.asyncQueue.enqueueAndForget(async()=>yh(await fl(h),t)),()=>{e.Nu(),h.asyncQueue.enqueueAndForget(async()=>vh(await fl(h),t))}}}function Bc(t,r){{var n=Ml(t),i=r;let e=new f;return n.asyncQueue.enqueueAndForget(async()=>async function(e,t,r){var n=Qh(e);try{var i=await((e,s)=>{let a=e,o=y.now(),n=s.reduce((e,t)=>e.add(t.key),L()),u,h;return a.persistence.runTransaction("Locally write mutations","readwrite",i=>{let t=Si,r=L();return a.Ns.getEntries(i,n).next(e=>{(t=e).forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>a.localDocuments.getOverlayedDocuments(i,t)).next(e=>{u=e;var t,r=[];for(t of s){var n=((e,t)=>{let r=null;for(var n of e.fieldTransforms){var i=t.data.field(n.field),i=Vi(n.transform,i||null);null!=i&&(r=null===r?Pn.empty():r).set(n.field,i)}return r||null})(t,u.get(t.key).overlayedDocument);null!=n&&r.push(new es(t.key,n,function i(e){let s=[];return zr(e.fields,(e,t)=>{var r=new l([e]);if(Dn(t)){e=i(t.mapValue).fields;if(0===e.length)s.push(r);else for(var n of e)s.push(r.child(n))}else s.push(r)}),new Wr(s)}(n.value.mapValue),P.exists(!0)))}return a.mutationQueue.addMutationBatch(i,o,r,s)}).next(e=>{var t=(h=e).applyToLocalDocumentSet(u,r);return a.documentOverlayCache.saveOverlays(i,e.batchId,t)})}).then(()=>({batchId:h.batchId,changes:Ai(u)}))})(n.localStore,t);n.sharedClientState.addPendingMutation(i.batchId);{var s=n,a=i.batchId,o=r;let e=s.Vu[s.currentUser.toKey()];e=(e=e||new A(b)).insert(a,o),s.Vu[s.currentUser.toKey()]=e}await jh(n,i.changes),await rh(n.remoteStore)}catch(e){t=lh(e,"Failed to persist write");r.reject(t)}}(await dl(n),i,e)),e.promise}}function qc(e,t,r){var n=r.docs.get(t._key),i=new Pc(e);return new Rc(e,i,t._key,n,new kc(r.hasPendingWrites,r.fromCache),t.converter)}let jc={maxAttempts:5};class zc{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=$l(e)}set(e,t,r){this._verifyNotCommitted();e=Gc(e,this._firestore),t=Dc(e.converter,t,r),t=Hl(this._dataReader,"WriteBatch.set",e._key,t,null!==e.converter,r);return this._mutations.push(t.toMutation(e._key,P.none())),this}update(e,t,r,...n){this._verifyNotCommitted();e=Gc(e,this._firestore),r="string"==typeof(t=I(t))||t instanceof Vl?rc(this._dataReader,"WriteBatch.update",e._key,t,r,n):tc(this._dataReader,"WriteBatch.update",e._key,t);return this._mutations.push(r.toMutation(e._key,P.exists(!0))),this}delete(e){this._verifyNotCommitted();e=Gc(e,this._firestore);return this._mutations=this._mutations.concat(new is(e._key,P.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new E(T.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Gc(e,t){if((e=I(e)).firestore!==t)throw new E(T.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Kc extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=$l(e)}get(e){let t=Gc(e,this._firestore),r=new Nc(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return _(24041);e=e[0];if(e.isFoundDocument())return new fc(this._firestore,r,e.key,e,t.converter);if(e.isNoDocument())return new fc(this._firestore,r,t._key,null,t.converter);throw _(18433,{doc:e})})}set(e,t,r){e=Gc(e,this._firestore),t=Dc(e.converter,t,r),t=Hl(this._dataReader,"Transaction.set",e._key,t,null!==e.converter,r);return this._transaction.set(e._key,t),this}update(e,t,r,...n){e=Gc(e,this._firestore),r="string"==typeof(t=I(t))||t instanceof Vl?rc(this._dataReader,"Transaction.update",e._key,t,r,n):tc(this._dataReader,"Transaction.update",e._key,t);return this._transaction.update(e._key,r),this}delete(e){e=Gc(e,this._firestore);return this._transaction.delete(e._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Gc(e,this._firestore),r=new Pc(this._firestore);return super.get(e).then(e=>new Rc(this._firestore,r,t._key,e._document,new kc(!1,!1),t.converter))}}function Qc(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new E("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function $c(){if("undefined"==typeof Uint8Array)throw new E("unimplemented","Uint8Arrays are not available in this environment.")}function Hc(){if("undefined"==typeof atob)throw new E("unimplemented","Blobs are unavailable in Firestore in this environment.")}t=vd.SDK_VERSION,ge=t,vd._registerComponent(new ie("firestore",(e,{instanceIdentifier:t,options:r})=>{var n=e.getProvider("app").getImmediate(),n=new U(new Te(e.getProvider("auth-internal")),new Ce(n,e.getProvider("app-check-internal")),((e,t)=>{if(Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))return new ln(e.options.projectId,t);throw new E(T.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.')})(n,t),n);return r={useFetchStreams:!0,...r},n._setSettings(r),n},"PUBLIC").setMultipleInstances(!0)),vd.registerVersion(fe,"4.9.2",void 0),vd.registerVersion(fe,"4.9.2","esm2020");class Wc{constructor(e){this._delegate=e}static fromBase64String(e){return Hc(),new Wc(Pl.fromBase64String(e))}static fromUint8Array(e){return $c(),new Wc(Pl.fromUint8Array(e))}toBase64(){return Hc(),this._delegate.toBase64()}toUint8Array(){return $c(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Yc(e){if("object"==typeof e&&null!==e){var t,r=e;for(t of["next","error","complete"])if(t in r&&"function"==typeof r[t])return 1}}class Jc{enableIndexedDbPersistence(e,r){{e=e._delegate;var n={forceOwnership:r};ye("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();return Ll(e,Jh.provider,{build:e=>new Wh(e,t.cacheSizeBytes,n.forceOwnership)}),Promise.resolve()}}enableMultiTabIndexedDbPersistence(e){return(async e=>{ye("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();Ll(e,Jh.provider,{build:e=>new Yh(e,t.cacheSizeBytes)})})(e._delegate)}clearIndexedDbPersistence(e){{var n=e._delegate;if(n._initialized&&!n._terminated)throw new E(T.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let r=new f;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{e=Ko(n._databaseId,n._persistenceKey),await(ot.v()?(t=e+"main",void await ot.delete(t)):Promise.resolve()),r.resolve()}catch(e){r.reject(e)}var e,t}),r.promise}}}class Xc{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof ln||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||ye("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e={...t,...e}).merge,this._delegate._setSettings(e)}useEmulator(r,e,n={}){var[r,e,n,i={}]=[this._delegate,r,e,n],t=(r=p(r,bl),K(e)),s=r._getSettings(),a={...s,emulatorOptions:r._getEmulatorOptions()},o=e+":"+n;if(t&&((async()=>(await fetch("https://"+o,{credentials:"include"})).ok)(),H("Firestore",!0)),s.host!==wl&&s.host!==o&&ye("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),!re(e={...s,host:o,ssl:t,emulatorOptions:i},a)&&(r._setSettings(e),i.mockUserToken)){let e,t;if("string"==typeof i.mockUserToken)e=i.mockUserToken,t=u.MOCK_USER;else{e=((e,t)=>{if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var t=t||"demo-project",r=e.iat||0,n=e.sub||e.user_id;if(n)return t={iss:"https://securetoken.google.com/"+t,aud:t,iat:r,exp:r+3600,auth_time:r,sub:n,user_id:n,firebase:{sign_in_provider:"custom",identities:{}},...e},[B(JSON.stringify({alg:"none",type:"JWT"})),B(JSON.stringify(t)),""].join(".");throw new Error("mockUserToken must contain 'sub' or 'user_id' field!")})(i.mockUserToken,r._app?.options.projectId);n=i.mockUserToken.sub||i.mockUserToken.user_id;if(!n)throw new E(T.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new u(n)}r._authCredentials=new Ie(new _e(e,t))}}enableNetwork(){return e=this._delegate,(r=Ml(e=p(e,U))).asyncQueue.enqueue(async()=>{var e=await hl(r),t=await cl(r);return e.setNetworkEnabled(!0),(e=t).Ea.delete(0),Gu(e)});var e,r}disableNetwork(){return(r=Ml(p(this._delegate,U))).asyncQueue.enqueue(async()=>{var e=await hl(r),t=await cl(r);return e.setNetworkEnabled(!1),(async()=>{var e=t;e.Ea.add(0),await Ku(e),e.Ra.set("Offline")})()});var r}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Ue("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){{var t=Ml(p(this._delegate,U));let e=new f;return t.asyncQueue.enqueueAndForget(async()=>async function(e,t){let r=e;Xu(r.remoteStore)||m(Ah,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{var n,i=await(()=>{let t=r.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))})();i===_t?t.resolve():((n=r.mu.get(i)||[]).push(t),r.mu.set(i,n))}catch(e){i=lh(e,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}}(await dl(t),e)),e.promise}}onSnapshotsInSync(e){t=this._delegate;{var n=Ml(p(t,U));t=kl(e)?e:{next:e};let r=new Zh(t);return n.asyncQueue.enqueueAndForget(async()=>{var e=await fl(n),t=r;e.Ca.add(t),t.next()}),()=>{r.Nu(),n.asyncQueue.enqueueAndForget(async()=>{var e=await fl(n),t=r;e.Ca.delete(t)})}}var t}get app(){if(this._appCompat)return this._appCompat;throw new E("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available")}collection(e){try{return new dd(this,El(this._delegate,e))}catch(e){throw id(e,"collection()","Firestore.collection()")}}doc(e){try{return new nd(this,Sl(this._delegate,e))}catch(e){throw id(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new hd(this,((e,t)=>{if(e=p(e,bl),Fe("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new E(T.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Il(e,null,(e=t,new li(S.emptyPath(),e)))})(this._delegate,e))}catch(e){throw id(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){var r=this._delegate,n=e=>t(new ed(this,e)),e=void 0;if(r=p(r,U),(e={...jc,...e}).maxAttempts<1)throw new E(T.INVALID_ARGUMENT,"Max attempts must be at least 1");{var i=Ml(r),s=e=>n(new Kc(r,e)),a=e;let t=new f;return i.asyncQueue.enqueueAndForget(async()=>{var e=await ul(i).then(e=>e.datastore);new rl(i.asyncQueue,e,a,s,t).ju()}),t.promise}}batch(){return Ml(this._delegate),new td(new zc(this._delegate,e=>Bc(this._delegate,e)))}loadBundle(e){return r=Ml(t=p(this._delegate,U)),n=new Rl,pl(r,t._databaseId,e,n),n;var t,r,n}namedQuery(e){return t=this._delegate,n=Ml(t=p(t,U)),i=e,n.asyncQueue.enqueue(async()=>{{var e=await ll(n),r=i;let t=e;return t.persistence.runTransaction("Get named query","readonly",e=>t.Ii.getNamedQuery(e,r))}}).then(e=>e?new Il(t,null,e.query):null).then(e=>e?new hd(this,e):null);var n,i,t}}class Zc extends Ac{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wc(new Pl(e))}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return nd.forKey(e,this.firestore,null)}}class ed{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Zc(e)}get(e){let t=fd(e);return this._delegate.get(t).then(e=>new od(this._firestore,new Rc(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,r){e=fd(e);return r?(Qc("Transaction.set",r),this._delegate.set(e,t,r)):this._delegate.set(e,t),this}update(e,t,r,...n){var i=fd(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...n),this}delete(e){e=fd(e);return this._delegate.delete(e),this}}class td{constructor(e){this._delegate=e}set(e,t,r){e=fd(e);return r?(Qc("WriteBatch.set",r),this._delegate.set(e,t,r)):this._delegate.set(e,t),this}update(e,t,r,...n){var i=fd(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...n),this}delete(e){e=fd(e);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class rd{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){e=new Mc(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ud(this._firestore,e),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){var r=rd.INSTANCES;let n=r.get(e),i=(n||(n=new WeakMap,r.set(e,n)),n.get(t));return i||(i=new rd(e,new Zc(e),t),n.set(t,i)),i}}rd.INSTANCES=new WeakMap;class nd{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Zc(e)}static forPath(e,t,r){if(e.length%2!=0)throw new E("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new nd(t,new F(t._delegate,r,new x(e)))}static forKey(e,t,r){return new nd(t,new F(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new dd(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new dd(this.firestore,El(this._delegate,e))}catch(e){throw id(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=I(e))instanceof F&&xl(this._delegate,e)}set(e,t){t=Qc("DocumentReference.set",t);try{return t?Vc(this._delegate,e,t):Vc(this._delegate,e)}catch(e){throw id(e,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Fc(this._delegate,e):Fc(this._delegate,e,t,...r)}catch(e){throw id(e,"updateDoc()","DocumentReference.update()")}}delete(){return Bc(p((e=this._delegate).firestore,U),[new is(e._key,P.none())]);var e}onSnapshot(...e){var t=sd(e),e=ad(e,e=>new od(this.firestore,new Rc(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return Uc(this._delegate,t,e)}get(e){let t;return(t=("cache"===e?.source?t=>{t=p(t,F);let r=p(t.firestore,U),e=Ml(r),n=new Pc(r);return function(e,t){let r=new f;return e.asyncQueue.enqueueAndForget(async()=>(async(e,t,r)=>{try{var n=await(t=>{let r=e;return r.persistence.runTransaction("read document","readonly",e=>r.localDocuments.getDocument(e,t))})(t);n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new E(T.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){n=lh(e,`Failed to get document '${t} from cache`),r.reject(n)}})(await ll(e),t,r)),r.promise}(e,t._key).then(e=>new Rc(r,n,t._key,e,new kc(null!==e&&e.hasLocalMutations,!0),t.converter))}:"server"===e?.source?t=>{t=p(t,F);let r=p(t.firestore,U);return gl(Ml(r),t._key,{source:"server"}).then(e=>qc(r,t,e))}:t=>{t=p(t,F);let r=p(t.firestore,U);return gl(Ml(r),t._key).then(e=>qc(r,t,e))})(this._delegate)).then(e=>new od(this.firestore,new Rc(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new nd(this.firestore,e?this._delegate.withConverter(rd.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function id(e,t,r){return e.message=e.message.replace(t,r),e}function sd(e){for(var t of e)if("object"==typeof t&&!Yc(t))return t;return{}}function ad(e,t){let r;return{next:e=>{r.next&&r.next(t(e))},error:(r=Yc(e[0])?e[0]:Yc(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error?.bind(r),complete:r.complete?.bind(r)}}class od{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new nd(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Lc(this._delegate,e._delegate)}}class ud extends od{data(e){var t=this._delegate.data(e);return this._delegate._converter||(e="Document in a QueryDocumentSnapshot should exist",void 0!==t)||_(57014,e),t}}class hd{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Zc(e)}where(e,t,r){try{return new hd(this.firestore,wc(this._delegate,(n=r,i=t,s=mc("where",e),_c._create(s,i,n))))}catch(e){throw id(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,i,s}orderBy(e,t){try{return new hd(this.firestore,wc(this._delegate,([r,n="asc"]=[e,t],i=n,s=mc("orderBy",r),bc._create(s,i))))}catch(e){throw id(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,n,i,s}limit(e){try{return new hd(this.firestore,wc(this._delegate,(Ge("limit",t=e),Ic._create("limit",t,"F"))))}catch(e){throw id(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new hd(this.firestore,wc(this._delegate,(Ge("limitToLast",t=e),Ic._create("limitToLast",t,"L"))))}catch(e){throw id(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new hd(this.firestore,wc(this._delegate,([...t]=[...e],Tc._create("startAt",t,!0))))}catch(e){throw id(e,"startAt()","Query.startAt()")}var t}startAfter(...e){try{return new hd(this.firestore,wc(this._delegate,([...t]=[...e],Tc._create("startAfter",t,!1))))}catch(e){throw id(e,"startAfter()","Query.startAfter()")}var t}endBefore(...e){try{return new hd(this.firestore,wc(this._delegate,([...t]=[...e],Ec._create("endBefore",t,!1))))}catch(e){throw id(e,"endBefore()","Query.endBefore()")}var t}endAt(...e){try{return new hd(this.firestore,wc(this._delegate,([...t]=[...e],Ec._create("endAt",t,!0))))}catch(e){throw id(e,"endAt()","Query.endAt()")}var t}isEqual(e){return Cl(this._delegate,e._delegate)}get(e){let t;return(t=("cache"===e?.source?t=>{t=p(t,Il);let r=p(t.firestore,U),e=Ml(r),n=new Pc(r);return function(e,t){let r=new f;return e.asyncQueue.enqueueAndForget(async()=>(async(e,t,r)=>{try{var n=await iu(e,t,!0),i=new Ch(t,n.Qs),s=i.ru(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(e){n=lh(e,`Failed to execute query '${t} against cache`),r.reject(n)}})(await ll(e),t,r)),r.promise}(e,t._query).then(e=>new Oc(r,n,t,e))}:"server"===e?.source?t=>{t=p(t,Il);let r=p(t.firestore,U),e=Ml(r),n=new Pc(r);return ml(e,t._query,{source:"server"}).then(e=>new Oc(r,n,t,e))}:t=>{t=p(t,Il);let r=p(t.firestore,U),e=Ml(r),n=new Pc(r);return pc(t._query),ml(e,t._query).then(e=>new Oc(r,n,t,e))})(this._delegate)).then(e=>new cd(this.firestore,new Oc(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=sd(e),e=ad(e,e=>new cd(this.firestore,new Oc(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return Uc(this._delegate,t,e)}withConverter(e){return new hd(this.firestore,e?this._delegate.withConverter(rd.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class ld{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ud(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class cd{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new hd(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ud(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new ld(this._firestore,e))}forEach(t,r){this._delegate.forEach(e=>{t.call(r,new ud(this._firestore,e))})}isEqual(e){return Lc(this._delegate,e._delegate)}}class dd extends hd{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new nd(this.firestore,e):null}doc(e){try{return void 0===e?new nd(this.firestore,Sl(this._delegate)):new nd(this.firestore,Sl(this._delegate,e))}catch(e){throw id(e,"doc()","CollectionReference.doc()")}}add(e){return((e,t)=>{let r=p(e.firestore,U),n=Sl(e),i=Dc(e.converter,t);return Bc(r,[Hl($l(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,P.exists(!1))]).then(()=>n)})(this._delegate,e).then(e=>new nd(this.firestore,e))}isEqual(e){return xl(this._delegate,e._delegate)}withConverter(e){return new dd(this.firestore,e?this._delegate.withConverter(rd.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function fd(e){return p(e,F)}var de={Firestore:Xc,GeoPoint:Ul,Timestamp:y,Blob:Wc,Transaction:ed,WriteBatch:td,DocumentReference:nd,DocumentSnapshot:od,Query:hd,QueryDocumentSnapshot:ud,QuerySnapshot:cd,CollectionReference:dd,FieldPath:class md{constructor(...e){this._delegate=new Vl(...e)}static documentId(){return new md(l.keyField().canonicalString())}isEqual(e){return(e=I(e))instanceof Vl&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class pd{static serverTimestamp(){var e=new Jl("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new pd(e)}static delete(){var e=new Wl("deleteField");return e._methodName="FieldValue.delete",new pd(e)}static arrayUnion(...e){return[...e]=[...e],(e=new Xl("arrayUnion",e))._methodName="FieldValue.arrayUnion",new pd(e)}static arrayRemove(...e){return[...e]=[...e],(e=new Zl("arrayRemove",e))._methodName="FieldValue.arrayRemove",new pd(e)}static increment(e){return(e=new ec("increment",e))._methodName="FieldValue.increment",new pd(e)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){me.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1},t=i.default,gd=(e,t)=>new Xc(e,t,new Jc);t.INTERNAL.registerComponent(new ie("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("firestore").getImmediate();return gd(t,e)},"PUBLIC").setServiceProps({...de})),t.registerVersion("@firebase/firestore-compat","0.4.2")}.apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore-compat.js - be sure to load firebase-app.js first.")}});
